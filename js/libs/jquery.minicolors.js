if(jQuery)(function(e){e.extend(e.fn,{miniColors:function(t,n){var r=function(t,n,r){var i=m(t.val());if(!i)i="FFFFFF";var s=E(i);var f=e('<a class="miniColors-trigger" style="background-color: #'+i+'" href="#"></a>');f.insertAfter(t);t.addClass("miniColors").attr("maxlength",7).attr("autocomplete","off");t.data("trigger",f);t.data("hsb",s);if(n.change)t.data("change",n.change);if(n.hide)t.data("hide",n.hide);if(n.move)t.data("move",n.move);if(n.readonly)t.attr("readonly",true);if(n.disabled)o(t);f.bind("click.miniColors",function(e){e.preventDefault();t.trigger("focus")});t.bind("focus.miniColors",function(e){u(t)});t.bind("blur.miniColors",function(e){var n=m(t.val());t.val(n?"#"+n:"")});t.bind("keydown.miniColors",function(e){if(e.keyCode===9)a(t)});t.bind("keyup.miniColors",function(e){var n=t.val().replace(/[^A-F0-9#]/ig,"");t.val(n);if(!p(t)){t.data("trigger").css("backgroundColor","#FFF")}});t.bind("paste.miniColors",function(e){setTimeout(function(){t.trigger("keyup")},5)})};var i=function(t){a();t=e(t);t.data("trigger").remove();t.removeAttr("autocomplete");t.removeData("trigger");t.removeData("selector");t.removeData("hsb");t.removeData("huePicker");t.removeData("colorPicker");t.removeData("mousebutton");t.removeData("moving");t.unbind("click.miniColors");t.unbind("focus.miniColors");t.unbind("blur.miniColors");t.unbind("keyup.miniColors");t.unbind("keydown.miniColors");t.unbind("paste.miniColors")};var s=function(e){e.attr("disabled",false);e.data("trigger").css("opacity",1)};var o=function(e){e.attr("disabled",true);e.data("trigger").css("opacity",.5);a(e)};var u=function(t){if(t.attr("disabled"))return false;a();var n=e('<div class="miniColors-selector"></div>');n.append('<div class="miniColors-colors" style="background-color: #FFF;"><div class="miniColors-colorPicker"></div></div>');n.append('<div class="miniColors-hues"><div class="miniColors-huePicker"></div></div>');n.css({top:t.is(":visible")?t.offset().top+t.outerHeight():t.data("trigger").offset().top+t.data("trigger").outerHeight(),left:t.is(":visible")?t.offset().left:t.data("trigger").offset().left-87,display:"none"}).addClass(t.attr("class"));var r=t.data("hsb");n.find(".miniColors-colors").css("backgroundColor","#"+S({h:r.h,s:100,b:100}));var i=t.data("colorPosition");if(!i)i=d(r);n.find(".miniColors-colorPicker").css("top",i.y+"px").css("left",i.x+"px");var s=t.data("huePosition");if(!s)s=v(r);n.find(".miniColors-huePicker").css("top",s.y+"px");t.data("selector",n);t.data("huePicker",n.find(".miniColors-huePicker"));t.data("colorPicker",n.find(".miniColors-colorPicker"));t.data("mousebutton",0);var o=e("<div class='miniColors-overlay no-select'/>").css({position:"absolute",left:0,top:0,width:"100%",height:"100%","z-index":1e4}).appendTo("BODY").mousedown(function(){a(t);o.remove()});e("BODY").append(n);n.fadeIn(100);n.bind("selectstart",function(){return false});n.bind("mousedown.miniColors",function(n){t.data("mousebutton",1);if(e(n.target).hasClass("miniColors-colors")){n.preventDefault();t.data("moving","colors");f(t,n)}if(e(n.target).hasClass("miniColors-hues")){n.preventDefault();t.data("moving","hues");l(t,n)}if(t.data("move")){t.data("move").call(t,t.val())}});n.bind("mouseup.miniColors",function(e){t.data("mousebutton",0);t.removeData("moving")});n.bind("mousemove.miniColors",function(e){if(t.data("mousebutton")===1){if(t.data("moving")==="colors")f(t,e);if(t.data("moving")==="hues")l(t,e);if(t.data("move")){t.data("move").call(t,t.val())}}})};var a=function(t){if(t){if(t.data("hide")){t.data("hide").call(t,t.val())}}if(!t)t=".miniColors";e(t).each(function(){var t=e(this).data("selector");e(this).removeData("selector");e(t).fadeOut(100,function(){e(this).remove()})})};var f=function(t,n){var r=t.data("colorPicker");r.hide();var i={x:n.clientX-t.data("selector").find(".miniColors-colors").offset().left+e(document).scrollLeft()-5,y:n.clientY-t.data("selector").find(".miniColors-colors").offset().top+e(document).scrollTop()-5};if(i.x<=-5)i.x=-5;if(i.x>=144)i.x=144;if(i.y<=-5)i.y=-5;if(i.y>=144)i.y=144;t.data("colorPosition",i);r.css("left",i.x).css("top",i.y).show();var s=Math.round((i.x+5)*.67);if(s<0)s=0;if(s>100)s=100;var o=100-Math.round((i.y+5)*.67);if(o<0)o=0;if(o>100)o=100;var u=t.data("hsb");u.s=s;u.b=o;c(t,u,true)};var l=function(t,n){var r=t.data("huePicker");r.hide();var i={y:n.clientY-t.data("selector").find(".miniColors-colors").offset().top+e(document).scrollTop()-1};if(i.y<=-1)i.y=-1;if(i.y>=149)i.y=149;t.data("huePosition",i);r.css("top",i.y).show();var s=Math.round((150-i.y-1)*2.4);if(s<0)s=0;if(s>360)s=360;var o=t.data("hsb");o.h=s;c(t,o,true)};var c=function(e,t,n){e.data("hsb",t);var r=S(t);if(n)e.val("#"+r);e.data("trigger").css("backgroundColor","#"+r);if(e.data("selector"))e.data("selector").find(".miniColors-colors").css("backgroundColor","#"+S({h:t.h,s:100,b:100}));if(e.data("change")){e.data("change").call(e,"#"+r,g(t))}};var p=function(t){var n=m(t.val());if(!n)return false;var r=E(n);var i=t.data("hsb");if(r.h===i.h&&r.s===i.s&&r.b===i.b)return true;var s=d(r);var o=e(t.data("colorPicker"));o.css("top",s.y+"px").css("left",s.x+"px");var u=v(r);var a=e(t.data("huePicker"));a.css("top",u.y+"px");c(t,r,false);return true};var d=function(e){var t=Math.ceil(e.s/.67);if(t<0)t=0;if(t>150)t=150;var n=150-Math.ceil(e.b/.67);if(n<0)n=0;if(n>150)n=150;return{x:t-5,y:n-5}};var v=function(e){var t=150-e.h/2.4;if(t<0)h=0;if(t>150)h=150;return{y:t-1}};var m=function(e){e=e.replace(/[^A-Fa-f0-9]/,"");if(e.length==3){e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]}return e.length===6?e:null};var g=function(e){var t={};var n=Math.round(e.h);var r=Math.round(e.s*255/100);var i=Math.round(e.b*255/100);if(r==0){t.r=t.g=t.b=i}else{var s=i;var o=(255-r)*i/255;var u=(s-o)*(n%60)/60;if(n==360)n=0;if(n<60){t.r=s;t.b=o;t.g=o+u}else if(n<120){t.g=s;t.b=o;t.r=s-u}else if(n<180){t.g=s;t.r=o;t.b=o+u}else if(n<240){t.b=s;t.r=o;t.g=s-u}else if(n<300){t.b=s;t.g=o;t.r=o+u}else if(n<360){t.r=s;t.g=o;t.b=s-u}else{t.r=0;t.g=0;t.b=0}}return{r:Math.round(t.r),g:Math.round(t.g),b:Math.round(t.b)}};var y=function(t){var n=[t.r.toString(16),t.g.toString(16),t.b.toString(16)];e.each(n,function(e,t){if(t.length==1)n[e]="0"+t});return n.join("")};var b=function(e){var e=parseInt(e.indexOf("#")>-1?e.substring(1):e,16);return{r:e>>16,g:(e&65280)>>8,b:e&255}};var w=function(e){var t={h:0,s:0,b:0};var n=Math.min(e.r,e.g,e.b);var r=Math.max(e.r,e.g,e.b);var i=r-n;t.b=r;t.s=r!=0?255*i/r:0;if(t.s!=0){if(e.r==r){t.h=(e.g-e.b)/i}else if(e.g==r){t.h=2+(e.b-e.r)/i}else{t.h=4+(e.r-e.g)/i}}else{t.h=-1}t.h*=60;if(t.h<0){t.h+=360}t.s*=100/255;t.b*=100/255;return t};var E=function(e){var t=w(b(e));if(t.s===0)t.h=360;return t};var S=function(e){return y(g(e))};switch(t){case"readonly":e(this).each(function(){e(this).attr("readonly",n)});return e(this);break;case"disabled":e(this).each(function(){if(n){o(e(this))}else{s(e(this))}});return e(this);case"value":e(this).each(function(){e(this).val(n).trigger("keyup")});return e(this);break;case"destroy":e(this).each(function(){i(e(this))});return e(this);default:if(!t)t={};e(this).each(function(){if(e(this)[0].tagName.toLowerCase()!=="input")return;if(e(this).data("trigger"))return;r(e(this),t,n)});return e(this)}}})})(jQuery)