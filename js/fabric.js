var fabric=fabric||{version:"1.1.6"};if(typeof exports!=="undefined"){exports.fabric=fabric}if(typeof document!=="undefined"&&typeof window!=="undefined"){fabric.document=document;fabric.window=window}else{fabric.document=require("jsdom").jsdom("<!DOCTYPE html><html><head></head><body></body></html>");fabric.window=fabric.document.createWindow()}fabric.isTouchSupported="ontouchstart"in fabric.document.documentElement;fabric.isLikelyNode=typeof Buffer!=="undefined"&&typeof window==="undefined";var Cufon=function(){function r(e){var t=this.face=e.face;this.glyphs=e.glyphs;this.w=e.w;this.baseSize=parseInt(t["units-per-em"],10);this.family=t["font-family"].toLowerCase();this.weight=t["font-weight"];this.style=t["font-style"]||"normal";this.viewBox=function(){var e=t.bbox.split(/\s+/);var n={minX:parseInt(e[0],10),minY:parseInt(e[1],10),maxX:parseInt(e[2],10),maxY:parseInt(e[3],10)};n.width=n.maxX-n.minX,n.height=n.maxY-n.minY;n.toString=function(){return[this.minX,this.minY,this.width,this.height].join(" ")};return n}();this.ascent=-parseInt(t.ascent,10);this.descent=-parseInt(t.descent,10);this.height=-this.ascent+this.descent}function i(){var e={},t={oblique:"italic",italic:"oblique"};this.add=function(t){(e[t.style]||(e[t.style]={}))[t.weight]=t};this.get=function(n,r){var i=e[n]||e[t[n]]||e.normal||e.italic||e.oblique;if(!i)return null;r={normal:400,bold:700}[r]||parseInt(r,10);if(i[r])return i[r];var s={1:1,99:0}[r%100],o=[],u,a;if(s===undefined)s=r>400;if(r==500)r=400;for(var f in i){f=parseInt(f,10);if(!u||f<u)u=f;if(!a||f>a)a=f;o.push(f)}if(r<u)r=u;if(r>a)r=a;o.sort(function(e,t){return(s?e>r&&t>r?e<t:e>t:e<r&&t<r?e>t:e<t)?-1:1});return i[o[0]]}}function s(){function t(e,t){if(e.contains)return e.contains(t);return e.compareDocumentPosition(t)&16}function n(e){var n=e.relatedTarget;if(!n||t(this,n))return;i(this)}function r(e){i(this)}function i(t){setTimeout(function(){e.replace(t,g.get(t).options,true)},10)}this.attach=function(e){if(e.onmouseenter===undefined){a(e,"mouseover",n);a(e,"mouseout",n)}else{a(e,"mouseenter",r);a(e,"mouseleave",r)}}}function o(){function n(e){return e.cufid||(e.cufid=++t)}var e={},t=0;this.get=function(t){var r=n(t);return e[r]||(e[r]={})}}function u(e){var t={},r={};this.get=function(n){return t[n]!=undefined?t[n]:e[n]};this.getSize=function(e,t){return r[e]||(r[e]=new n.Size(this.get(e),t))};this.extend=function(e){for(var n in e)t[n]=e[n];return this}}function a(e,t,n){if(e.addEventListener){e.addEventListener(t,n,false)}else if(e.attachEvent){e.attachEvent("on"+t,function(){return n.call(e,fabric.window.event)})}}function f(e,t){var n=g.get(e);if(n.options)return e;if(t.hover&&t.hoverables[e.nodeName.toLowerCase()]){y.attach(e)}n.options=t;return e}function l(e){var t={};return function(n){if(!t.hasOwnProperty(n))t[n]=e.apply(null,arguments);return t[n]}}function c(e,t){if(!t)t=n.getStyle(e);var r=n.quotedList(t.get("fontFamily").toLowerCase()),i;for(var s=0,o=r.length;s<o;++s){i=r[s];if(E[i])return E[i].get(t.get("fontStyle"),t.get("fontWeight"))}return null}function h(e){return fabric.document.getElementsByTagName(e)}function p(){var e={},t;for(var n=0,r=arguments.length;n<r;++n){for(t in arguments[n])e[t]=arguments[n][t]}return e}function d(e,t,r,i,s,o){var u=i.separate;if(u=="none")return w[i.engine].apply(null,arguments);var a=fabric.document.createDocumentFragment(),f;var l=t.split(x[u]),c=u=="words";if(c&&m){if(/^\s/.test(t))l.unshift("");if(/\s$/.test(t))l.push("")}for(var h=0,p=l.length;h<p;++h){f=w[i.engine](e,c?n.textAlign(l[h],r,h,p):l[h],r,i,s,o,h<p-1);if(f)a.appendChild(f)}return a}function v(e,t){var r,i,s,o;for(var u=f(e,t).firstChild;u;u=s){s=u.nextSibling;o=false;if(u.nodeType==1){if(!u.firstChild)continue;if(!/cufon/.test(u.className)){arguments.callee(u,t);continue}else o=true}if(!i)i=n.getStyle(e).extend(t);if(!r)r=c(e,i);if(!r)continue;if(o){w[t.engine](r,null,i,t,u,e);continue}var a=u.data;if(typeof G_vmlCanvasManager!="undefined"){a=a.replace(/\r/g,"\n")}if(a==="")continue;var l=d(r,a,i,t,u,e);if(l)u.parentNode.replaceChild(l,u);else u.parentNode.removeChild(u)}}var e=function(){return e.replace.apply(null,arguments)};var t=e.DOM={ready:function(){var e=false,t={loaded:1,complete:1};var n=[],r=function(){if(e)return;e=true;for(var t;t=n.shift();t());};if(fabric.document.addEventListener){fabric.document.addEventListener("DOMContentLoaded",r,false);fabric.window.addEventListener("pageshow",r,false)}if(!fabric.window.opera&&fabric.document.readyState)(function(){t[fabric.document.readyState]?r():setTimeout(arguments.callee,10)})();if(fabric.document.readyState&&fabric.document.createStyleSheet)(function(){try{fabric.document.body.doScroll("left");r()}catch(e){setTimeout(arguments.callee,1)}})();a(fabric.window,"load",r);return function(t){if(!arguments.length)r();else e?t():n.push(t)}}()};var n=e.CSS={Size:function(e,t){this.value=parseFloat(e);this.unit=String(e).match(/[a-z%]*$/)[0]||"px";this.convert=function(e){return e/t*this.value};this.convertFrom=function(e){return e/this.value*t};this.toString=function(){return this.value+this.unit}},getStyle:function(e){return new u(e.style)},quotedList:l(function(e){var t=[],n=/\s*((["'])([\s\S]*?[^\\])\2|[^,]+)\s*/g,r;while(r=n.exec(e))t.push(r[3]||r[1]);return t}),ready:function(){var e=false;var n=[],r=function(){e=true;for(var t;t=n.shift();t());};var i=Object.prototype.propertyIsEnumerable?h("style"):{length:0};var s=h("link");t.ready(function(){var e=0,t;for(var n=0,o=s.length;t=s[n],n<o;++n){if(!t.disabled&&t.rel.toLowerCase()=="stylesheet")++e}if(fabric.document.styleSheets.length>=i.length+e)r();else setTimeout(arguments.callee,10)});return function(t){if(e)t();else n.push(t)}}(),supports:function(e,t){var n=fabric.document.createElement("span").style;if(n[e]===undefined)return false;n[e]=t;return n[e]===t},textAlign:function(e,t,n,r){if(t.get("textAlign")=="right"){if(n>0)e=" "+e}else if(n<r-1)e+=" ";return e},textDecoration:function(e,t){if(!t)t=this.getStyle(e);var n={underline:null,overline:null,"line-through":null};for(var r=e;r.parentNode&&r.parentNode.nodeType==1;){var i=true;for(var s in n){if(n[s])continue;if(t.get("textDecoration").indexOf(s)!=-1)n[s]=t.get("color");i=false}if(i)break;t=this.getStyle(r=r.parentNode)}return n},textShadow:l(function(e){if(e=="none")return null;var t=[],n={},r,i=0;var s=/(#[a-f0-9]+|[a-z]+\(.*?\)|[a-z]+)|(-?[\d.]+[a-z%]*)|,/ig;while(r=s.exec(e)){if(r[0]==","){t.push(n);n={},i=0}else if(r[1]){n.color=r[1]}else{n[["offX","offY","blur"][i++]]=r[2]}}t.push(n);return t}),color:l(function(e){var t={};t.color=e.replace(/^rgba\((.*?),\s*([\d.]+)\)/,function(e,n,r){t.opacity=parseFloat(r);return"rgb("+n+")"});return t}),textTransform:function(e,t){return e[{uppercase:"toUpperCase",lowercase:"toLowerCase"}[t.get("textTransform")]||"toString"]()}};var m=" ".split(/\s+/).length==0;var g=new o;var y=new s;var b=[];var w={},E={},S={engine:null,hover:false,hoverables:{a:true},printable:true,selector:fabric.window.Sizzle||fabric.window.jQuery&&function(e){return jQuery(e)}||fabric.window.dojo&&dojo.query||fabric.window.$$&&function(e){return $$(e)}||fabric.window.$&&function(e){return $(e)}||fabric.document.querySelectorAll&&function(e){return fabric.document.querySelectorAll(e)}||h,separate:"words",textShadow:"none"};var x={words:/\s+/,characters:""};e.now=function(){t.ready();return e};e.refresh=function(){var t=b.splice(0,b.length);for(var n=0,r=t.length;n<r;++n){e.replace.apply(null,t[n])}return e};e.registerEngine=function(t,n){if(!n)return e;w[t]=n;return e.set("engine",t)};e.registerFont=function(t){var n=new r(t),s=n.family;if(!E[s])E[s]=new i;E[s].add(n);return e.set("fontFamily",'"'+s+'"')};e.replace=function(t,r,i){r=p(S,r);if(!r.engine)return e;if(typeof r.textShadow=="string"&&r.textShadow)r.textShadow=n.textShadow(r.textShadow);if(!i)b.push(arguments);if(t.nodeType||typeof t=="string")t=[t];n.ready(function(){for(var n=0,i=t.length;n<i;++n){var s=t[n];if(typeof s=="string")e.replace(r.selector(s),r,true);else v(s,r)}});return e};e.replaceElement=function(e,t){t=p(S,t);if(typeof t.textShadow=="string"&&t.textShadow)t.textShadow=n.textShadow(t.textShadow);return v(e,t)};e.engines=w;e.fonts=E;e.getOptions=function(){return p(S)};e.set=function(t,n){S[t]=n;return e};return e}();Cufon.registerEngine("canvas",function(){function s(e,t){var n=0,r=0;var i=[],s=/([mrvxe])([^a-z]*)/g,o;e:for(var u=0;o=s.exec(e);++u){var a=o[2].split(",");switch(o[1]){case"v":i[u]={m:"bezierCurveTo",a:[n+~~a[0],r+~~a[1],n+~~a[2],r+~~a[3],n+=~~a[4],r+=~~a[5]]};break;case"r":i[u]={m:"lineTo",a:[n+=~~a[0],r+=~~a[1]]};break;case"m":i[u]={m:"moveTo",a:[n=~~a[0],r=~~a[1]]};break;case"x":i[u]={m:"closePath",a:[]};break;case"e":break e}t[i[u].m].apply(t,i[u].a)}return i}function o(e,t){for(var n=0,r=e.length;n<r;++n){var i=e[n];t[i.m].apply(t,i.a)}}var e=Cufon.CSS.supports("display","inline-block");var t=!e&&(fabric.document.compatMode=="BackCompat"||/frameset|transitional/i.test(fabric.document.doctype.publicId));var n=fabric.document.createElement("style");n.type="text/css";var r=fabric.document.createTextNode(".cufon-canvas{text-indent:0}"+"@media screen,projection{"+".cufon-canvas{display:inline;display:inline-block;position:relative;vertical-align:middle"+(t?"":";font-size:1px;line-height:1px")+"}.cufon-canvas .cufon-alt{display:-moz-inline-box;display:inline-block;width:0;height:0;overflow:hidden}"+(e?".cufon-canvas canvas{position:relative}":".cufon-canvas canvas{position:absolute}")+"}"+"@media print{"+".cufon-canvas{padding:0 !important}"+".cufon-canvas canvas{display:none}"+".cufon-canvas .cufon-alt{display:inline}"+"}");try{n.appendChild(r)}catch(i){n.setAttribute("type","text/css");n.styleSheet.cssText=r.data}fabric.document.getElementsByTagName("head")[0].appendChild(n);return function(t,n,r,i,u,a){function $(e,t){W.strokeStyle=t;W.beginPath();W.moveTo(0,e);W.lineTo(N,e);W.stroke()}function Q(){W.save();var e=0,n=0,r=[{left:0}];if(i.backgroundColor){W.save();W.fillStyle=i.backgroundColor;W.translate(0,t.ascent);W.fillRect(0,0,N+10,(-t.ascent+t.descent)*L);W.restore()}if(i.textAlign==="right"){W.translate(M[n],0);r[0].left=M[n]*X}else if(i.textAlign==="center"){W.translate(M[n]/2,0);r[0].left=M[n]/2*X}for(var s=0,o=T.length;s<o;++s){if(T[s]==="\n"){n++;var u=-t.ascent-t.ascent/5*i.lineHeight;var a=r[r.length-1];var f={left:0};a.width=e*X;a.height=(-t.ascent+t.descent)*X;if(i.textAlign==="right"){W.translate(-N,u);W.translate(M[n],0);f.left=M[n]*X}else if(i.textAlign==="center"){W.translate(-e-M[n-1]/2,u);W.translate(M[n]/2,0);f.left=M[n]/2*X}else{W.translate(-e,u)}r.push(f);e=0;continue}var l=t.glyphs[T[s]]||t.missingGlyph;if(!l)continue;var c=Number(l.w||t.w)+h;if(i.textBackgroundColor){W.save();W.fillStyle=i.textBackgroundColor;W.translate(0,t.ascent);W.fillRect(0,0,c+10,-t.ascent+t.descent);W.restore()}W.translate(c,0);e+=c;if(s==o-1){r[r.length-1].width=e*X;r[r.length-1].height=(-t.ascent+t.descent)*X}}W.restore();Cufon.textOptions.boundaries=r}function G(e){W.fillStyle=e||Cufon.textOptions.color||r.get("color");var n=0,u=0;if(i.textAlign==="right"){W.translate(M[u],0)}else if(i.textAlign==="center"){W.translate(M[u]/2,0)}for(var a=0,f=T.length;a<f;++a){if(T[a]==="\n"){u++;var l=-t.ascent-t.ascent/5*i.lineHeight;if(i.textAlign==="right"){W.translate(-N,l);W.translate(M[u],0)}else if(i.textAlign==="center"){W.translate(-n-M[u-1]/2,l);W.translate(M[u]/2,0)}else{W.translate(-n,l)}n=0;continue}var c=t.glyphs[T[a]]||t.missingGlyph;if(!c)continue;var p=Number(c.w||t.w)+h;if(J){W.save();W.strokeStyle=W.fillStyle;W.lineWidth+=W.lineWidth;W.beginPath();if(J.underline){W.moveTo(0,-t.face["underline-position"]+.5);W.lineTo(p,-t.face["underline-position"]+.5)}if(J.overline){W.moveTo(0,t.ascent+.5);W.lineTo(p,t.ascent+.5)}if(J["line-through"]){W.moveTo(0,-t.descent+.5);W.lineTo(p,-t.descent+.5)}W.stroke();W.restore()}if(K){W.save();W.transform(1,0,-.25,1,0,0)}W.beginPath();if(c.d){if(c.code)o(c.code,W);else c.code=s("m"+c.d,W)}W.fill();if(i.strokeStyle){W.closePath();W.save();W.lineWidth=i.strokeWidth;W.strokeStyle=i.strokeStyle;W.stroke();W.restore()}if(K){W.restore()}W.translate(p,0);n+=p}}var f=n===null;var l=t.viewBox;var c=r.getSize("fontSize",t.baseSize);var h=r.get("letterSpacing");h=h=="normal"?0:c.convertFrom(parseInt(h,10));var p=0,d=0,v=0,m=0;var g=i.textShadow,y=[];Cufon.textOptions.shadowOffsets=[];Cufon.textOptions.shadows=null;if(g){Cufon.textOptions.shadows=g;for(var b=0,w=g.length;b<w;++b){var E=g[b];var S=c.convertFrom(parseFloat(E.offX));var x=c.convertFrom(parseFloat(E.offY));y[b]=[S,x]}}var T=Cufon.CSS.textTransform(f?u.alt:n,r).split("");var N=0,C=null;var k=0,L=1,A=[];for(var b=0,w=T.length;b<w;++b){if(T[b]==="\n"){L++;if(N>k){k=N}A.push(N);N=0;continue}var O=t.glyphs[T[b]]||t.missingGlyph;if(!O)continue;N+=C=Number(O.w||t.w)+h}A.push(N);N=Math.max(k,N);var M=[];for(var b=A.length;b--;){M[b]=N-A[b]}if(C===null)return null;d+=l.width-C;m+=l.minX;var _,D;if(f){_=u;D=u.firstChild}else{_=fabric.document.createElement("span");_.className="cufon cufon-canvas";_.alt=n;D=fabric.document.createElement("canvas");_.appendChild(D);if(i.printable){var P=fabric.document.createElement("span");P.className="cufon-alt";P.appendChild(fabric.document.createTextNode(n));_.appendChild(P)}}var H=_.style;var B=D.style||{};var j=c.convert(l.height-p+v);var F=Math.ceil(j);var I=F/j;D.width=Math.ceil(c.convert(N+d-m)*I);D.height=F;p+=l.minY;B.top=Math.round(c.convert(p-t.ascent))+"px";B.left=Math.round(c.convert(m))+"px";var q=Math.ceil(c.convert(N*I));var R=q+"px";var U=c.convert(t.height);var z=(i.lineHeight-1)*c.convert(-t.ascent/5)*(L-1);Cufon.textOptions.width=q;Cufon.textOptions.height=U*L+z;Cufon.textOptions.lines=L;Cufon.textOptions.totalLineHeight=z;if(e){H.width=R;H.height=U+"px"}else{H.paddingLeft=R;H.paddingBottom=U-1+"px"}var W=Cufon.textOptions.context||D.getContext("2d"),X=F/l.height;Cufon.textOptions.fontAscent=t.ascent*X;Cufon.textOptions.boundaries=null;for(var V=Cufon.textOptions.shadowOffsets,b=y.length;b--;){V[b]=[y[b][0]*X,y[b][1]*X]}W.save();W.scale(X,X);W.translate(-m-1/X*D.width/2+(Cufon.fonts[t.family].offsetLeft||0),-p-Cufon.textOptions.height/X/2+(Cufon.fonts[t.family].offsetTop||0));W.lineWidth=t.face["underline-thickness"];W.save();var J=Cufon.getTextDecoration(i),K=i.fontStyle==="italic";W.save();Q();if(g){for(var b=0,w=g.length;b<w;++b){var E=g[b];W.save();W.translate.apply(W,y[b]);G(E.color);W.restore()}}G();W.restore();W.restore();W.restore();return _}}());Cufon.registerEngine("vml",function(){function n(e,t){return r(e,/(?:em|ex|%)$/i.test(t)?"1em":t)}function r(e,t){if(/px$/i.test(t))return parseFloat(t);var n=e.style.left,r=e.runtimeStyle.left;e.runtimeStyle.left=e.currentStyle.left;e.style.left=t;var i=e.style.pixelLeft;e.style.left=n;e.runtimeStyle.left=r;return i}if(!fabric.document.namespaces)return;var e=fabric.document.createElement("canvas");if(e&&e.getContext&&e.getContext.apply)return;if(fabric.document.namespaces.cvml==null){fabric.document.namespaces.add("cvml","urn:schemas-microsoft-com:vml")}var t=fabric.document.createElement("cvml:shape");t.style.behavior="url(#default#VML)";if(!t.coordsize)return;t=null;fabric.document.write('<style type="text/css">'+".cufon-vml-canvas{text-indent:0}"+"@media screen{"+"cvml\\:shape,cvml\\:shadow{behavior:url(#default#VML);display:block;antialias:true;position:absolute}"+".cufon-vml-canvas{position:absolute;text-align:left}"+".cufon-vml{display:inline-block;position:relative;vertical-align:middle}"+".cufon-vml .cufon-alt{position:absolute;left:-10000in;font-size:1px}"+"a .cufon-vml{cursor:pointer}"+"}"+"@media print{"+".cufon-vml *{display:none}"+".cufon-vml .cufon-alt{display:inline}"+"}"+"</style>");return function(e,t,i,s,o,u,a){var f=t===null;if(f)t=o.alt;var l=e.viewBox;var c=i.computedFontSize||(i.computedFontSize=new Cufon.CSS.Size(n(u,i.get("fontSize"))+"px",e.baseSize));var h=i.computedLSpacing;if(h==undefined){h=i.get("letterSpacing");i.computedLSpacing=h=h=="normal"?0:~~c.convertFrom(r(u,h))}var p,d;if(f){p=o;d=o.firstChild}else{p=fabric.document.createElement("span");p.className="cufon cufon-vml";p.alt=t;d=fabric.document.createElement("span");d.className="cufon-vml-canvas";p.appendChild(d);if(s.printable){var v=fabric.document.createElement("span");v.className="cufon-alt";v.appendChild(fabric.document.createTextNode(t));p.appendChild(v)}if(!a)p.appendChild(fabric.document.createElement("cvml:shape"))}var m=p.style;var g=d.style;var y=c.convert(l.height),b=Math.ceil(y);var w=b/y;var E=l.minX,S=l.minY;g.height=b;g.top=Math.round(c.convert(S-e.ascent));g.left=Math.round(c.convert(E));m.height=c.convert(e.height)+"px";var x=Cufon.getTextDecoration(s);var T=i.get("color");var N=Cufon.CSS.textTransform(t,i).split("");var C=0,k=0,L=null;var A,O,M=s.textShadow;for(var _=0,D=0,P=N.length;_<P;++_){A=e.glyphs[N[_]]||e.missingGlyph;if(A)C+=L=~~(A.w||e.w)+h}if(L===null)return null;var H=-E+C+(l.width-L);var B=c.convert(H*w),j=Math.round(B);var F=H+","+l.height,I;var q="r"+F+"nsnf";for(_=0;_<P;++_){A=e.glyphs[N[_]]||e.missingGlyph;if(!A)continue;if(f){O=d.childNodes[D];if(O.firstChild)O.removeChild(O.firstChild)}else{O=fabric.document.createElement("cvml:shape");d.appendChild(O)}O.stroked="f";O.coordsize=F;O.coordorigin=I=E-k+","+S;O.path=(A.d?"m"+A.d+"xe":"")+"m"+I+q;O.fillcolor=T;var R=O.style;R.width=j;R.height=b;if(M){var U=M[0],z=M[1];var W=Cufon.CSS.color(U.color),X;var V=fabric.document.createElement("cvml:shadow");V.on="t";V.color=W.color;V.offset=U.offX+","+U.offY;if(z){X=Cufon.CSS.color(z.color);V.type="double";V.color2=X.color;V.offset2=z.offX+","+z.offY}V.opacity=W.opacity||X&&X.opacity||1;O.appendChild(V)}k+=~~(A.w||e.w)+h;++D}m.width=Math.max(Math.ceil(c.convert(C*w)),0);return p}}());Cufon.getTextDecoration=function(e){return{underline:e.textDecoration==="underline",overline:e.textDecoration==="overline","line-through":e.textDecoration==="line-through"}};if(typeof exports!="undefined"){exports.Cufon=Cufon}var JSON;if(!JSON){JSON={}}(function(){"use strict";function f(e){return e<10?"0"+e:e}function quote(e){escapable.lastIndex=0;return escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return typeof t==="string"?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var n,r,i,s,o=gap,u,a=t[e];if(a&&typeof a==="object"&&typeof a.toJSON==="function"){a=a.toJSON(e)}if(typeof rep==="function"){a=rep.call(t,e,a)}switch(typeof a){case"string":return quote(a);case"number":return isFinite(a)?String(a):"null";case"boolean":case"null":return String(a);case"object":if(!a){return"null"}gap+=indent;u=[];if(Object.prototype.toString.apply(a)==="[object Array]"){s=a.length;for(n=0;n<s;n+=1){u[n]=str(n,a)||"null"}i=u.length===0?"[]":gap?"[\n"+gap+u.join(",\n"+gap)+"\n"+o+"]":"["+u.join(",")+"]";gap=o;return i}if(rep&&typeof rep==="object"){s=rep.length;for(n=0;n<s;n+=1){if(typeof rep[n]==="string"){r=rep[n];i=str(r,a);if(i){u.push(quote(r)+(gap?": ":":")+i)}}}}else{for(r in a){if(Object.prototype.hasOwnProperty.call(a,r)){i=str(r,a);if(i){u.push(quote(r)+(gap?": ":":")+i)}}}}i=u.length===0?"{}":gap?"{\n"+gap+u.join(",\n"+gap)+"\n"+o+"}":"{"+u.join(",")+"}";gap=o;return i}}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(e){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(e){return this.valueOf()}}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;if(typeof JSON.stringify!=="function"){JSON.stringify=function(e,t,n){var r;gap="";indent="";if(typeof n==="number"){for(r=0;r<n;r+=1){indent+=" "}}else if(typeof n==="string"){indent=n}rep=t;if(t&&typeof t!=="function"&&(typeof t!=="object"||typeof t.length!=="number")){throw new Error("JSON.stringify")}return str("",{"":e})}}if(typeof JSON.parse!=="function"){JSON.parse=function(text,reviver){function walk(e,t){var n,r,i=e[t];if(i&&typeof i==="object"){for(n in i){if(Object.prototype.hasOwnProperty.call(i,n)){r=walk(i,n);if(r!==undefined){i[n]=r}else{delete i[n]}}}}return reviver.call(e,t,i)}var j;text=String(text);cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof reviver==="function"?walk({"":j},""):j}throw new SyntaxError("JSON.parse")}}})();fabric.log=function(){};fabric.warn=function(){};if(typeof console!=="undefined"){if(typeof console.log!=="undefined"&&console.log.apply){fabric.log=function(){return console.log.apply(console,arguments)}}if(typeof console.warn!=="undefined"&&console.warn.apply){fabric.warn=function(){return console.warn.apply(console,arguments)}}}fabric.Observable={observe:function(e,t){if(!this.__eventListeners){this.__eventListeners={}}if(arguments.length===1){for(var n in e){this.on(n,e[n])}}else{if(!this.__eventListeners[e]){this.__eventListeners[e]=[]}this.__eventListeners[e].push(t)}},stopObserving:function(e,t){if(!this.__eventListeners){this.__eventListeners={}}if(this.__eventListeners[e]){if(t){fabric.util.removeFromArray(this.__eventListeners[e],t)}else{this.__eventListeners[e].length=0}}},fire:function(e,t){if(!this.__eventListeners){this.__eventListeners={}}var n=this.__eventListeners[e];if(!n)return;for(var r=0,i=n.length;r<i;r++){n[r](t||{})}}};fabric.Observable.on=fabric.Observable.observe;fabric.Observable.off=fabric.Observable.stopObserving;fabric.Observable.trigger=fabric.Observable.fire;fabric.Collection={add:function(){this._objects.push.apply(this._objects,arguments);for(var e=arguments.length;e--;){this._onObjectAdded(arguments[e])}this.renderOnAddition&&this.renderAll();return this},insertAt:function(e,t,n){var r=this.getObjects();if(n){r[t]=e}else{r.splice(t,0,e)}this._onObjectAdded(e);this.renderOnAddition&&this.renderAll();return this},remove:function(e){var t=this.getObjects();var n=t.indexOf(e);if(n!==-1){t.splice(n,1);this._onObjectRemoved(e)}this.renderAll&&this.renderAll();return e},forEachObject:function(e,t){var n=this.getObjects(),r=n.length;while(r--){e.call(t,n[r],r,n)}return this},item:function(e){return this.getObjects()[e]},isEmpty:function(){return this.getObjects().length===0},size:function(){return this.getObjects().length},contains:function(e){return this.getObjects().indexOf(e)>-1},complexity:function(){return this.getObjects().reduce(function(e,t){e+=t.complexity?t.complexity():0;return e},0)},toGrayscale:function(){return this.forEachObject(function(e){e.toGrayscale()})}};(function(){function n(e,t){var n=e.indexOf(t);if(n!==-1){e.splice(n,1)}return e}function r(e,t){return Math.floor(Math.random()*(t-e+1))+e}function s(e){return e*i}function o(e){return e/i}function u(e,t,n){var r=Math.sin(n),i=Math.cos(n);e.subtractEquals(t);var s=e.x*i-e.y*r;var o=e.x*r+e.y*i;return(new fabric.Point(s,o)).addEquals(t)}function a(e,t){return parseFloat(Number(e).toFixed(t))}function f(){return false}function l(e){e||(e={});var t=+(new Date),n=e.duration||500,r=t+n,i,s=e.onChange||function(){},o=e.abort||function(){return false},u=e.easing||function(e,t,n,r){return-n*Math.cos(e/r*(Math.PI/2))+n+t},a="startValue"in e?e.startValue:0,f="endValue"in e?e.endValue:100,l=e.byValue||f-a;e.onStart&&e.onStart();(function c(){i=+(new Date);var f=i>r?n:i-t;s(u(f,a,l,n));if(i>r||o()){e.onComplete&&e.onComplete();return}h(c)})()}function p(e,t,n){if(e){var r=new Image;r.onload=function(){t&&t.call(n,r);r=r.onload=null};r.src=e}else{t&&t.call(n,e)}}function d(e,t){function n(e){return fabric[fabric.util.string.camelize(fabric.util.string.capitalize(e))]}function r(){if(++s===o){if(t){t(i)}}}var i=[],s=0,o=e.length;e.forEach(function(e,t){if(!e.type){return}var s=n(e.type);if(s.async){s.fromObject(e,function(e,n){if(!n){i[t]=e}r()})}else{i[t]=s.fromObject(e);r()}})}function v(e,t,n){var r;if(e.length>1){var i=e.some(function(e){return e.type==="text"});if(i){r=new fabric.Group([],t);e.reverse().forEach(function(e){if(e.cx){e.left=e.cx}if(e.cy){e.top=e.cy}r.addWithUpdate(e)})}else{r=new fabric.PathGroup(e,t)}}else{r=e[0]}if(typeof n!=="undefined"){r.setSourcePath(n)}return r}function m(e,t,n){if(n&&Object.prototype.toString.call(n)==="[object Array]"){for(var r=0,i=n.length;r<i;r++){t[n[r]]=e[n[r]]}}}function g(n,r,i,s,o,u){var a=s-r,f=o-i,l=e(a*a+f*f),c=t(f,a),h=u.length,p=0,d=true;n.save();n.translate(r,i);n.moveTo(0,0);n.rotate(c);r=0;while(l>r){r+=u[p++%h];if(r>l){r=l}n[d?"lineTo":"moveTo"](r,0);d=!d}n.restore()}function y(e){e||(e=fabric.document.createElement("canvas"));if(!e.getContext&&typeof G_vmlCanvasManager!=="undefined"){G_vmlCanvasManager.initElement(e)}return e}function b(e){var t=e.prototype;for(var n=t.stateProperties.length;n--;){var r=t.stateProperties[n],i=r.charAt(0).toUpperCase()+r.slice(1),s="set"+i,o="get"+i;if(!t[o]){t[o]=function(e){return new Function('return this.get("'+e+'")')}(r)}if(!t[s]){t[s]=function(e){return new Function("value",'return this.set("'+e+'", value)')}(r)}}}function w(e,t){t.save();t.beginPath();e.clipTo(t);t.clip()}var e=Math.sqrt,t=Math.atan2;fabric.util={};var i=Math.PI/180;var c=fabric.window.requestAnimationFrame||fabric.window.webkitRequestAnimationFrame||fabric.window.mozRequestAnimationFrame||fabric.window.oRequestAnimationFrame||fabric.window.msRequestAnimationFrame||function(e){fabric.window.setTimeout(e,1e3/60)};var h=function(){return c.apply(fabric.window,arguments)};fabric.util.removeFromArray=n;fabric.util.degreesToRadians=s;fabric.util.radiansToDegrees=o;fabric.util.rotatePoint=u;fabric.util.toFixed=a;fabric.util.getRandomInt=r;fabric.util.falseFunction=f;fabric.util.animate=l;fabric.util.requestAnimFrame=h;fabric.util.loadImage=p;fabric.util.enlivenObjects=d;fabric.util.groupSVGElements=v;fabric.util.populateWithProperties=m;fabric.util.drawDashedLine=g;fabric.util.createCanvasElement=y;fabric.util.createAccessors=b;fabric.util.clipContext=w})();(function(){function t(t,n){var r=e.call(arguments,2),i=[];for(var s=0,o=t.length;s<o;s++){i[s]=r.length?t[s][n].apply(t[s],r):t[s][n].call(t[s])}return i}function n(e,t){if(!e||e.length===0)return undefined;var n=e.length-1,r=t?e[n][t]:e[n];if(t){while(n--){if(e[n][t]>=r){r=e[n][t]}}}else{while(n--){if(e[n]>=r){r=e[n]}}}return r}function r(e,t){if(!e||e.length===0)return undefined;var n=e.length-1,r=t?e[n][t]:e[n];if(t){while(n--){if(e[n][t]<r){r=e[n][t]}}}else{while(n--){if(e[n]<r){r=e[n]}}}return r}var e=Array.prototype.slice;if(!Array.prototype.indexOf){Array.prototype.indexOf=function(e){if(this===void 0||this===null){throw new TypeError}var t=Object(this),n=t.length>>>0;if(n===0){return-1}var r=0;if(arguments.length>0){r=Number(arguments[1]);if(r!==r){r=0}else if(r!==0&&r!==Number.POSITIVE_INFINITY&&r!==Number.NEGATIVE_INFINITY){r=(r>0||-1)*Math.floor(Math.abs(r))}}if(r>=n){return-1}var i=r>=0?r:Math.max(n-Math.abs(r),0);for(;i<n;i++){if(i in t&&t[i]===e){return i}}return-1}}if(!Array.prototype.forEach){Array.prototype.forEach=function(e,t){for(var n=0,r=this.length>>>0;n<r;n++){if(n in this){e.call(t,this[n],n,this)}}}}if(!Array.prototype.map){Array.prototype.map=function(e,t){var n=[];for(var r=0,i=this.length>>>0;r<i;r++){if(r in this){n[r]=e.call(t,this[r],r,this)}}return n}}if(!Array.prototype.every){Array.prototype.every=function(e,t){for(var n=0,r=this.length>>>0;n<r;n++){if(n in this&&!e.call(t,this[n],n,this)){return false}}return true}}if(!Array.prototype.some){Array.prototype.some=function(e,t){for(var n=0,r=this.length>>>0;n<r;n++){if(n in this&&e.call(t,this[n],n,this)){return true}}return false}}if(!Array.prototype.filter){Array.prototype.filter=function(e,t){var n=[],r;for(var i=0,s=this.length>>>0;i<s;i++){if(i in this){r=this[i];if(e.call(t,r,i,this)){n.push(r)}}}return n}}if(!Array.prototype.reduce){Array.prototype.reduce=function(e){var t=this.length>>>0,n=0,r;if(arguments.length>1){r=arguments[1]}else{do{if(n in this){r=this[n++];break}if(++n>=t){throw new TypeError}}while(true)}for(;n<t;n++){if(n in this){r=e.call(null,r,this[n],n,this)}}return r}}fabric.util.array={invoke:t,min:r,max:n}})();(function(){function e(e,t){for(var n in t){e[n]=t[n]}return e}function t(t){return e({},t)}fabric.util.object={extend:e,clone:t}})();(function(){function e(e){return e.replace(/-+(.)?/g,function(e,t){return t?t.toUpperCase():""})}function t(e){return e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()}function n(e){return e.replace(/&/g,"&").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}if(!String.prototype.trim){String.prototype.trim=function(){return this.replace(/^[\s\xA0]+/,"").replace(/[\s\xA0]+$/,"")}}fabric.util.string={camelize:e,capitalize:t,escapeXml:n}})();(function(){var e=Array.prototype.slice,t=Function.prototype.apply,n=function(){};if(!Function.prototype.bind){Function.prototype.bind=function(r){var i=this,s=e.call(arguments,1),o;if(s.length){o=function(){return t.call(i,this instanceof n?this:r,s.concat(e.call(arguments)))}}else{o=function(){return t.call(i,this instanceof n?this:r,arguments)}}n.prototype=this.prototype;o.prototype=new n;return o}}})();(function(){function i(){}function s(t){var n=this.constructor.superclass.prototype[t];return arguments.length>1?n.apply(this,e.call(arguments,1)):n.call(this)}function o(){function u(){this.initialize.apply(this,arguments)}var n=null,o=e.call(arguments,0);if(typeof o[0]==="function"){n=o.shift()}u.superclass=n;u.subclasses=[];if(n){i.prototype=n.prototype;u.prototype=new i;n.subclasses.push(u)}for(var a=0,f=o.length;a<f;a++){r(u,o[a],n)}if(!u.prototype.initialize){u.prototype.initialize=t}u.prototype.constructor=u;u.prototype.callSuper=s;return u}var e=Array.prototype.slice,t=function(){};var n=function(){for(var e in{toString:1}){if(e==="toString")return false}return true}();var r=function(e,t,r){for(var i in t){if(i in e.prototype&&typeof e.prototype[i]==="function"&&(t[i]+"").indexOf("callSuper")>-1){e.prototype[i]=function(e){return function(){var n=this.constructor.superclass;this.constructor.superclass=r;var i=t[e].apply(this,arguments);this.constructor.superclass=n;if(e!=="initialize"){return i}}}(i)}else{e.prototype[i]=t[i]}if(n){if(t.toString!==Object.prototype.toString){e.prototype.toString=t.toString}if(t.valueOf!==Object.prototype.valueOf){e.prototype.valueOf=t.valueOf}}}};fabric.util.createClass=o})();(function(){function e(e){var t=Array.prototype.slice.call(arguments,1),n,r,i=t.length;for(r=0;r<i;r++){n=typeof e[t[r]];if(!/^(?:function|object|unknown)$/.test(n))return false}return true}function i(e,t){return{handler:t,wrappedHandler:s(e,t)}}function s(e,t){return function(r){t.call(n(e),r||fabric.window.event)}}function o(e,t){return function(n){if(l[e]&&l[e][t]){var r=l[e][t];for(var i=0,s=r.length;i<s;i++){r[i].call(this,n||fabric.window.event)}}}}function p(e,t){e||(e=fabric.window.event);var n=e.target||(typeof e.srcElement!=="unknown"?e.srcElement:null),r=fabric.document.body||{scrollLeft:0,scrollTop:0},i=fabric.document.documentElement,s=n,o=0,u=0,a;while(n&&n.parentNode&&!a){n=n.parentNode;if(n!==fabric.document&&fabric.util.getElementPosition(n)==="fixed")a=n;if(n!==fabric.document&&s!==t&&fabric.util.getElementPosition(n)==="absolute"){o=0;u=0}else if(n===fabric.document&&s!==t){o=r.scrollLeft||i.scrollLeft||0;u=r.scrollTop||i.scrollTop||0}else{o+=n.scrollLeft||0;u+=n.scrollTop||0}}return{x:d(e)+o,y:v(e)+u}}var t=function(){var e=0;return function(t){return t.__uniqueID||(t.__uniqueID="uniqueID__"+e++)}}();var n,r;(function(){var e={};n=function(t){return e[t]};r=function(t,n){e[t]=n}})();var u=e(fabric.document.documentElement,"addEventListener","removeEventListener")&&e(fabric.window,"addEventListener","removeEventListener"),a=e(fabric.document.documentElement,"attachEvent","detachEvent")&&e(fabric.window,"attachEvent","detachEvent"),f={},l={},c,h;if(u){c=function(e,t,n){e.addEventListener(t,n,false)};h=function(e,t,n){e.removeEventListener(t,n,false)}}else if(a){c=function(e,n,s){var o=t(e);r(o,e);if(!f[o]){f[o]={}}if(!f[o][n]){f[o][n]=[]}var u=i(o,s);f[o][n].push(u);e.attachEvent("on"+n,u.wrappedHandler)};h=function(e,n,r){var i=t(e),s;if(f[i]&&f[i][n]){for(var o=0,u=f[i][n].length;o<u;o++){s=f[i][n][o];if(s&&s.handler===r){e.detachEvent("on"+n,s.wrappedHandler);f[i][n][o]=null}}}}}else{c=function(e,n,r){var i=t(e);if(!l[i]){l[i]={}}if(!l[i][n]){l[i][n]=[];var s=e["on"+n];if(s){l[i][n].push(s)}e["on"+n]=o(i,n)}l[i][n].push(r)};h=function(e,n,r){var i=t(e);if(l[i]&&l[i][n]){var s=l[i][n];for(var o=0,u=s.length;o<u;o++){if(s[o]===r){s.splice(o,1)}}}}}fabric.util.addListener=c;fabric.util.removeListener=h;var d=function(e){return typeof e.clientX!=="unknown"?e.clientX:0};var v=function(e){return typeof e.clientY!=="unknown"?e.clientY:0};if(fabric.isTouchSupported){d=function(e){if(e.type!=="touchend"){return e.touches&&e.touches[0]?e.touches[0].pageX-(e.touches[0].pageX-e.touches[0].clientX)||e.clientX:e.clientX}return e.changedTouches&&e.changedTouches[0]?e.changedTouches[0].pageX-(e.changedTouches[0].pageX-e.changedTouches[0].clientX)||e.clientX:e.clientX};v=function(e){if(e.type!=="touchend"){return e.touches&&e.touches[0]?e.touches[0].pageY-(e.touches[0].pageY-e.touches[0].clientY)||e.clientY:e.clientY}return e.changedTouches&&e.changedTouches[0]?e.changedTouches[0].pageY-(e.changedTouches[0].pageY-e.changedTouches[0].clientY)||e.clientY:e.clientY}}fabric.util.getPointer=p;fabric.util.object.extend(fabric.util,fabric.Observable)})();(function(){function e(e,t){var n=e.style;if(!n){return e}if(typeof t==="string"){e.style.cssText+=";"+t;return t.indexOf("opacity")>-1?s(e,t.match(/opacity:\s*(\d?\.?\d*)/)[1]):e}for(var r in t){if(r==="opacity"){s(e,t[r])}else{var i=r==="float"||r==="cssFloat"?typeof n.styleFloat==="undefined"?"cssFloat":"styleFloat":r;n[i]=t[r]}}return e}var t=fabric.document.createElement("div"),n=typeof t.style.opacity==="string",r=typeof t.style.filter==="string",i=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,s=function(e){return e};if(n){s=function(e,t){e.style.opacity=t;return e}}else if(r){s=function(e,t){var n=e.style;if(e.currentStyle&&!e.currentStyle.hasLayout){n.zoom=1}if(i.test(n.filter)){t=t>=.9999?"":"alpha(opacity="+t*100+")";n.filter=n.filter.replace(i,t)}else{n.filter+=" alpha(opacity="+t*100+")"}return e}}fabric.util.setStyle=e})();(function(){function t(e){return typeof e==="string"?fabric.document.getElementById(e):e}function s(e,t){var n=fabric.document.createElement(e);for(var r in t){if(r==="class"){n.className=t[r]}else if(r==="for"){n.htmlFor=t[r]}else{n.setAttribute(r,t[r])}}return n}function o(e,t){if((" "+e.className+" ").indexOf(" "+t+" ")===-1){e.className+=(e.className?" ":"")+t}}function u(e,t,n){if(typeof t==="string"){t=s(t,n)}if(e.parentNode){e.parentNode.replaceChild(t,e)}t.appendChild(e);return t}function a(e){var t=0,n=0;do{t+=e.offsetTop||0;n+=e.offsetLeft||0;e=e.offsetParent}while(e);return{left:n,top:t}}var e=Array.prototype.slice;var n=function(t){return e.call(t,0)};var r;try{r=n(fabric.document.childNodes)instanceof Array}catch(i){}if(!r){n=function(e){var t=new Array(e.length),n=e.length;while(n--){t[n]=e[n]}return t}}var f;if(fabric.document.defaultView&&fabric.document.defaultView.getComputedStyle){f=function(e){return fabric.document.defaultView.getComputedStyle(e,null).position}}else{f=function(e){var t=e.style.position;if(!t&&e.currentStyle)t=e.currentStyle.position;return t}}(function(){function n(e){if(typeof e.onselectstart!=="undefined"){e.onselectstart=fabric.util.falseFunction}if(t){e.style[t]="none"}else if(typeof e.unselectable==="string"){e.unselectable="on"}return e}function r(e){if(typeof e.onselectstart!=="undefined"){e.onselectstart=null}if(t){e.style[t]=""}else if(typeof e.unselectable==="string"){e.unselectable=""}return e}var e=fabric.document.documentElement.style;var t="userSelect"in e?"userSelect":"MozUserSelect"in e?"MozUserSelect":"WebkitUserSelect"in e?"WebkitUserSelect":"KhtmlUserSelect"in e?"KhtmlUserSelect":"";fabric.util.makeElementUnselectable=n;fabric.util.makeElementSelectable=r})();(function(){function e(e,t){var n=fabric.document.getElementsByTagName("head")[0],r=fabric.document.createElement("script"),i=true;r.type="text/javascript";r.setAttribute("runat","server");r.onload=r.onreadystatechange=function(e){if(i){if(typeof this.readyState==="string"&&this.readyState!=="loaded"&&this.readyState!=="complete")return;i=false;t(e||fabric.window.event);r=r.onload=r.onreadystatechange=null}};r.src=e;n.appendChild(r)}fabric.util.getScript=e})();fabric.util.getById=t;fabric.util.toArray=n;fabric.util.makeElement=s;fabric.util.addClass=o;fabric.util.wrapElement=u;fabric.util.getElementOffset=a;fabric.util.getElementPosition=f})();(function(){function e(e,t){return e+(/\?/.test(e)?"&":"?")+t}function n(){}function r(r,i){i||(i={});var s=i.method?i.method.toUpperCase():"GET",o=i.onComplete||function(){},u=t(),a;u.onreadystatechange=function(){if(u.readyState===4){o(u);u.onreadystatechange=n}};if(s==="GET"){a=null;if(typeof i.parameters==="string"){r=e(r,i.parameters)}}u.open(s,r,true);if(s==="POST"||s==="PUT"){u.setRequestHeader("Content-Type","application/x-www-form-urlencoded")}u.send(a);return u}var t=function(){var e=[function(){return new ActiveXObject("Microsoft.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP.3.0")},function(){return new XMLHttpRequest}];for(var t=e.length;t--;){try{var n=e[t]();if(n){return e[t]}}catch(r){}}}();fabric.util.request=r})();(function(){function e(e,t,n,r){return n*(e/=r)*e+t}function t(e,t,n,r){return-n*(e/=r)*(e-2)+t}function n(e,t,n,r){e/=r/2;if(e<1)return n/2*e*e+t;return-n/2*(--e*(e-2)-1)+t}function r(e,t,n,r){return n*(e/=r)*e*e+t}function i(e,t,n,r){return n*((e=e/r-1)*e*e+1)+t}function s(e,t,n,r){e/=r/2;if(e<1)return n/2*e*e*e+t;return n/2*((e-=2)*e*e+2)+t}function o(e,t,n,r){return n*(e/=r)*e*e*e+t}function u(e,t,n,r){return-n*((e=e/r-1)*e*e*e-1)+t}function a(e,t,n,r){e/=r/2;if(e<1)return n/2*e*e*e*e+t;return-n/2*((e-=2)*e*e*e-2)+t}function f(e,t,n,r){return n*(e/=r)*e*e*e*e+t}function l(e,t,n,r){return n*((e=e/r-1)*e*e*e*e+1)+t}function c(e,t,n,r){e/=r/2;if(e<1)return n/2*e*e*e*e*e+t;return n/2*((e-=2)*e*e*e*e+2)+t}function h(e,t,n,r){return-n*Math.cos(e/r*(Math.PI/2))+n+t}function p(e,t,n,r){return n*Math.sin(e/r*(Math.PI/2))+t}function d(e,t,n,r){return-n/2*(Math.cos(Math.PI*e/r)-1)+t}function v(e,t,n,r){return e===0?t:n*Math.pow(2,10*(e/r-1))+t}function m(e,t,n,r){return e===r?t+n:n*(-Math.pow(2,-10*e/r)+1)+t}function g(e,t,n,r){if(e===0)return t;if(e===r)return t+n;e/=r/2;if(e<1)return n/2*Math.pow(2,10*(e-1))+t;return n/2*(-Math.pow(2,-10*--e)+2)+t}function y(e,t,n,r){return-n*(Math.sqrt(1-(e/=r)*e)-1)+t}function b(e,t,n,r){return n*Math.sqrt(1-(e=e/r-1)*e)+t}function w(e,t,n,r){e/=r/2;if(e<1)return-n/2*(Math.sqrt(1-e*e)-1)+t;return n/2*(Math.sqrt(1-(e-=2)*e)+1)+t}function E(e,t,n,r){var i=1.70158;var s=0;var o=n;if(e===0)return t;e/=r;if(e===1)return t+n;if(!s)s=r*.3;if(o<Math.abs(n)){o=n;i=s/4}else i=s/(2*Math.PI)*Math.asin(n/o);return-(o*Math.pow(2,10*(e-=1))*Math.sin((e*r-i)*2*Math.PI/s))+t}function S(e,t,n,r){var i=1.70158;var s=0;var o=n;if(e===0)return t;e/=r;if(e===1)return t+n;if(!s)s=r*.3;if(o<Math.abs(n)){o=n;i=s/4}else i=s/(2*Math.PI)*Math.asin(n/o);return o*Math.pow(2,-10*e)*Math.sin((e*r-i)*2*Math.PI/s)+n+t}function x(e,t,n,r){var i=1.70158;var s=0;var o=n;if(e===0)return t;e/=r/2;if(e===2)return t+n;if(!s)s=r*.3*1.5;if(o<Math.abs(n)){o=n;i=s/4}else i=s/(2*Math.PI)*Math.asin(n/o);if(e<1)return-.5*o*Math.pow(2,10*(e-=1))*Math.sin((e*r-i)*2*Math.PI/s)+t;return o*Math.pow(2,-10*(e-=1))*Math.sin((e*r-i)*2*Math.PI/s)*.5+n+t}function T(e,t,n,r,i){if(i===undefined)i=1.70158;return n*(e/=r)*e*((i+1)*e-i)+t}function N(e,t,n,r,i){if(i===undefined)i=1.70158;return n*((e=e/r-1)*e*((i+1)*e+i)+1)+t}function C(e,t,n,r,i){if(i===undefined)i=1.70158;e/=r/2;if(e<1)return n/2*e*e*(((i*=1.525)+1)*e-i)+t;return n/2*((e-=2)*e*(((i*=1.525)+1)*e+i)+2)+t}function k(e,t,n,r){return n-L(r-e,0,n,r)+t}function L(e,t,n,r){if((e/=r)<1/2.75){return n*7.5625*e*e+t}else if(e<2/2.75){return n*(7.5625*(e-=1.5/2.75)*e+.75)+t}else if(e<2.5/2.75){return n*(7.5625*(e-=2.25/2.75)*e+.9375)+t}else{return n*(7.5625*(e-=2.625/2.75)*e+.984375)+t}}function A(e,t,n,r){if(e<r/2)return k(e*2,0,n,r)*.5+t;return L(e*2-r,0,n,r)*.5+n*.5+t}fabric.util.ease={easeInQuad:e,easeOutQuad:t,easeInOutQuad:n,easeInCubic:r,easeOutCubic:i,easeInOutCubic:s,easeInQuart:o,easeOutQuart:u,easeInOutQuart:a,easeInQuint:f,easeOutQuint:l,easeInOutQuint:c,easeInSine:h,easeOutSine:p,easeInOutSine:d,easeInExpo:v,easeOutExpo:m,easeInOutExpo:g,easeInCirc:y,easeOutCirc:b,easeInOutCirc:w,easeInElastic:E,easeOutElastic:S,easeInOutElastic:x,easeInBack:T,easeOutBack:N,easeInOutBack:C,easeInBounce:k,easeOutBounce:L,easeInOutBounce:A}})();(function(e){"use strict";function o(e){if(e in s){return s[e]}return e}function u(e,r){if(!e){return}var i,s,u={};if(e.parentNode&&/^g$/i.test(e.parentNode.nodeName)){u=t.parseAttributes(e.parentNode,r)}var a=r.reduce(function(n,r){i=e.getAttribute(r);s=parseFloat(i);if(i){if((r==="fill"||r==="stroke")&&i==="none"){i=""}if(r==="fill-rule"){i=i==="evenodd"?"destination-over":i}if(r==="transform"){i=t.parseTransformAttribute(i)}r=o(r);n[r]=isNaN(s)?i:s}return n},{});a=n(a,n(p(e),t.parseStyleAttribute(e)));return n(u,a)}function a(e){if(!e)return null;e=e.trim();var t=e.indexOf(",")>-1;e=e.split(/\s+/);var n=[],r,i;if(t){r=0;i=e.length;for(;r<i;r++){var s=e[r].split(",");n.push({x:parseFloat(s[0]),y:parseFloat(s[1])})}}else{r=0;i=e.length;for(;r<i;r+=2){n.push({x:parseFloat(e[r]),y:parseFloat(e[r+1])})}}if(n.length%2!==0){}return n}function f(e){var t={},n=e.getAttribute("style");if(!n)return t;if(typeof n==="string"){n=n.replace(/;$/,"").split(";").forEach(function(e){var n=e.split(":");var r=n[1].trim();var i=parseFloat(r);t[o(n[0].trim().toLowerCase())]=isNaN(i)?r:i})}else{for(var r in n){if(typeof n[r]==="undefined")continue;var i=parseFloat(n[r]);t[o(r.toLowerCase())]=isNaN(i)?n[r]:i}}return t}function l(e){for(var n=e.length;n--;){var r=e[n].get("fill");if(/^url\(/.test(r)){var i=r.slice(5,r.length-1);if(t.gradientDefs[i]){e[n].set("fill",t.Gradient.fromElement(t.gradientDefs[i],e[n]))}}}}function c(e,n,i,s){function a(){if(--u===0){o=o.filter(function(e){return e!=null});l(o);n(o)}}var o=new Array(e.length),u=e.length;for(var f=0,c,h=e.length;f<h;f++){c=e[f];var p=t[r(c.tagName)];if(p&&p.fromElement){try{if(p.async){p.fromElement(c,function(e,t){return function(n){s&&s(t,n);o.splice(e,0,n);a()}}(f,c),i)}else{var d=p.fromElement(c,i);s&&s(c,d);o.splice(f,0,d);a()}}catch(v){t.log(v)}}else{a()}}}function h(e){var t=e.getElementsByTagName("style"),n={},r;for(var i=0,s=t.length;i<s;i++){var o=t[0].textContent;o=o.replace(/\/\*[\s\S]*?\*\//g,"");r=o.match(/[^{]*\{[\s\S]*?\}/g);r=r.map(function(e){return e.trim()});r.forEach(function(e){var t=e.match(/([\s\S]*?)\s*\{([^}]*)\}/);e=t[1];var r=t[2].trim(),i=r.replace(/;$/,"").split(/\s*;\s*/);if(!n[e]){n[e]={}}for(var s=0,o=i.length;s<o;s++){var u=i[s].split(/\s*:\s*/),a=u[0],f=u[1];n[e][a]=f}})}return n}function p(e){var n=e.nodeName,r=e.getAttribute("class"),i=e.getAttribute("id"),s={};for(var o in t.cssRules){var u=r&&(new RegExp("^\\."+r)).test(o)||i&&(new RegExp("^#"+i)).test(o)||(new RegExp("^"+n)).test(o);if(u){for(var a in t.cssRules[o]){s[a]=t.cssRules[o][a]}}}return s}function v(e,n,r){function i(i){var s=i.responseXML;if(!s.documentElement&&t.window.ActiveXObject&&i.responseText){s=new ActiveXObject("Microsoft.XMLDOM");s.async="false";s.loadXML(i.responseText.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,""))}if(!s.documentElement)return;t.parseSVGDocument(s.documentElement,function(r,i){d.set(e,{objects:t.util.array.invoke(r,"toObject"),options:i});n(r,i)},r)}e=e.replace(/^\n\s*/,"").trim();d.has(e,function(r){if(r){d.get(e,function(e){var t=m(e);n(t.objects,t.options)})}else{new t.util.request(e,{method:"get",onComplete:i})}})}function m(e){var n=e.objects,i=e.options;n=n.map(function(e){return t[r(e.type)].fromObject(e)});return{objects:n,options:i}}function g(e,n,r){e=e.trim();var i;if(typeof DOMParser!=="undefined"){var s=new DOMParser;if(s&&s.parseFromString){i=s.parseFromString(e,"text/xml")}}else if(t.window.ActiveXObject){i=new ActiveXObject("Microsoft.XMLDOM");i.async="false";i.loadXML(e.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,""))}t.parseSVGDocument(i.documentElement,function(e,t){n(e,t)},r)}function y(e){var t="";for(var n=0,r=e.length;n<r;n++){if(e[n].type!=="text"||!e[n].path)continue;t+=["@font-face {","font-family: ",e[n].fontFamily,"; ","src: url('",e[n].path,"')","}"].join("")}if(t){t=['<style type="text/css">',"<![CDATA[",t,"]]>","</style>"].join("")}return t}function b(e){var t="";if(e.backgroundColor&&e.backgroundColor.source){t=['<pattern x="0" y="0" id="backgroundColorPattern" ','width="',e.backgroundColor.source.width,'" height="',e.backgroundColor.source.height,'" patternUnits="userSpaceOnUse">','<image x="0" y="0" ','width="',e.backgroundColor.source.width,'" height="',e.backgroundColor.source.height,'" xlink:href="',e.backgroundColor.source.src,'"></image></pattern>'].join("")}return t}var t=e.fabric||(e.fabric={}),n=t.util.object.extend,r=t.util.string.capitalize,i=t.util.object.clone;var s={cx:"left",x:"left",cy:"top",y:"top",r:"radius","fill-opacity":"opacity","fill-rule":"fillRule","stroke-width":"strokeWidth",transform:"transformMatrix","text-decoration":"textDecoration","font-size":"fontSize","font-weight":"fontWeight","font-style":"fontStyle","font-family":"fontFamily"};t.parseTransformAttribute=function(){function e(e,t){var n=t[0];e[0]=Math.cos(n);e[1]=Math.sin(n);e[2]=-Math.sin(n);e[3]=Math.cos(n)}function t(e,t){var n=t[0],r=t.length===2?t[1]:t[0];e[0]=n;e[3]=r}function n(e,t){e[2]=t[0]}function r(e,t){e[1]=t[0]}function i(e,t){e[4]=t[0];if(t.length===2){e[5]=t[1]}}var s=[1,0,0,1,0,0],o="(?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)",u="(?:\\s+,?\\s*|,\\s*)",a="(?:(skewX)\\s*\\(\\s*("+o+")\\s*\\))",f="(?:(skewY)\\s*\\(\\s*("+o+")\\s*\\))",l="(?:(rotate)\\s*\\(\\s*("+o+")(?:"+u+"("+o+")"+u+"("+o+"))?\\s*\\))",c="(?:(scale)\\s*\\(\\s*("+o+")(?:"+u+"("+o+"))?\\s*\\))",h="(?:(translate)\\s*\\(\\s*("+o+")(?:"+u+"("+o+"))?\\s*\\))",p="(?:(matrix)\\s*\\(\\s*"+"("+o+")"+u+"("+o+")"+u+"("+o+")"+u+"("+o+")"+u+"("+o+")"+u+"("+o+")"+"\\s*\\))",d="(?:"+p+"|"+h+"|"+c+"|"+l+"|"+a+"|"+f+")",v="(?:"+d+"(?:"+u+d+")*"+")",m="^\\s*(?:"+v+"?)\\s*$",g=new RegExp(m),y=new RegExp(d);return function(o){var u=s.concat();if(!o||o&&!g.test(o)){return u}o.replace(y,function(s){var o=(new RegExp(d)).exec(s).filter(function(e){return e!==""&&e!=null}),a=o[1],f=o.slice(2).map(parseFloat);switch(a){case"translate":i(u,f);break;case"rotate":e(u,f);break;case"scale":t(u,f);break;case"skewX":n(u,f);break;case"skewY":r(u,f);break;case"matrix":u=f;break}});return u}}();t.parseSVGDocument=function(){function s(e,t){while(e&&(e=e.parentNode)){if(t.test(e.nodeName)){return true}}return false}var e=/^(path|circle|polygon|polyline|ellipse|rect|line|image|text)$/;var n="(?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)";var r=new RegExp("^"+"\\s*("+n+"+)\\s*,?"+"\\s*("+n+"+)\\s*,?"+"\\s*("+n+"+)\\s*,?"+"\\s*("+n+"+)\\s*"+"$");return function(n,o,u){if(!n)return;var a=new Date,f=t.util.toArray(n.getElementsByTagName("*"));if(f.length===0){f=n.selectNodes("//*[name(.)!='svg']");var l=[];for(var c=0,p=f.length;c<p;c++){l[c]=f[c]}f=l}var d=f.filter(function(t){return e.test(t.tagName)&&!s(t,/^(?:pattern|defs)$/)});if(!d||d&&!d.length)return;var v=n.getAttribute("viewBox"),m=n.getAttribute("width"),g=n.getAttribute("height"),y=null,b=null,w,E;if(v&&(v=v.match(r))){w=parseInt(v[1],10);E=parseInt(v[2],10);y=parseInt(v[3],10);b=parseInt(v[4],10)}y=m?parseFloat(m):y;b=g?parseFloat(g):b;var S={width:y,height:b};t.gradientDefs=t.getGradientDefs(n);t.cssRules=h(n);t.parseElements(d,function(e){t.documentParsingTime=new Date-a;if(o){o(e,S)}},i(S),u)}}();var d={has:function(e,t){t(false)},get:function(){},set:function(){}};n(t,{parseAttributes:u,parseElements:c,parseStyleAttribute:f,parsePointsAttribute:a,getCSSRules:h,loadSVGFromURL:v,loadSVGFromString:g,createSVGFontFacesMarkup:y,createSVGRefElementsMarkup:b})})(typeof exports!=="undefined"?exports:this);(function(){function e(e){var t=e.getAttribute("style"),n=e.getAttribute("offset"),r,i;n=parseFloat(n)/(/%$/.test(n)?100:1);if(t){var s=t.split(/\s*;\s*/);if(s[s.length-1]===""){s.pop()}for(var o=s.length;o--;){var u=s[o].split(/\s*:\s*/),a=u[0].trim(),f=u[1].trim();if(a==="stop-color"){r=f}else if(a==="stop-opacity"){i=f}}}if(!r){r=e.getAttribute("stop-color")}if(!i){i=e.getAttribute("stop-opacity")}r=(new fabric.Color(r)).toRgb();return{offset:n,color:r,opacity:i}}function t(e,t){for(var n in t){if(typeof t[n]==="string"&&/^\d+%$/.test(t[n])){var r=parseFloat(t[n],10);if(n==="x1"||n==="x2"||n==="r2"){t[n]=fabric.util.toFixed(e.width*r/100,2)}else if(n==="y1"||n==="y2"){t[n]=fabric.util.toFixed(e.height*r/100,2)}}if(n==="x1"||n==="x2"){t[n]-=fabric.util.toFixed(e.width/2,2)}else if(n==="y1"||n==="y2"){t[n]-=fabric.util.toFixed(e.height/2,2)}}}function n(e,t){for(var n in t){if(n==="x1"||n==="x2"){t[n]+=fabric.util.toFixed(e.width/2,2)}else if(n==="y1"||n==="y2"){t[n]+=fabric.util.toFixed(e.height/2,2)}if(n==="x1"||n==="x2"||n==="r2"){t[n]=fabric.util.toFixed(t[n]/e.width*100,2)+"%"}else if(n==="y1"||n==="y2"){t[n]=fabric.util.toFixed(t[n]/e.height*100,2)+"%"}}}function r(e){var t=e.getElementsByTagName("linearGradient"),n=e.getElementsByTagName("radialGradient"),r,i,s={};i=t.length;for(;i--;){r=t[i];s[r.getAttribute("id")]=r}i=n.length;for(;i--;){r=n[i];s[r.getAttribute("id")]=r}return s}fabric.Gradient=fabric.util.createClass({initialize:function(e){e||(e={});var t={};this.id=fabric.Object.__uid++;this.type=e.type||"linear";t={x1:e.coords.x1||0,y1:e.coords.y1||0,x2:e.coords.x2||0,y2:e.coords.y2||0};if(this.type==="radial"){t.r1=e.coords.r1||0;t.r2=e.coords.r2||0}this.coords=t;this.gradientUnits=e.gradientUnits||"objectBoundingBox";this.colorStops=e.colorStops.slice()},addColorStop:function(e){for(var t in e){var n=new fabric.Color(e[t]);this.colorStops.push({offset:t,color:n.toRgb(),opacity:n.getAlpha()})}return this},toObject:function(){return{type:this.type,coords:this.coords,gradientUnits:this.gradientUnits,colorStops:this.colorStops}},toLive:function(e){var t;if(!this.type)return;if(this.type==="linear"){t=e.createLinearGradient(this.coords.x1,this.coords.y1,this.coords.x2||e.canvas.width,this.coords.y2)}else if(this.type==="radial"){t=e.createRadialGradient(this.coords.x1,this.coords.y1,this.coords.r1,this.coords.x2,this.coords.y2,this.coords.r2)}for(var n=0;n<this.colorStops.length;n++){var r=this.colorStops[n].color,i=this.colorStops[n].opacity,s=this.colorStops[n].offset;if(i){r=(new fabric.Color(r)).setAlpha(i).toRgba()}t.addColorStop(parseFloat(s),r)}return t},toSVG:function(e,t){var r=fabric.util.object.clone(this.coords),i;this.colorStops.sort(function(e,t){return e.offset-t.offset});if(t&&this.gradientUnits==="userSpaceOnUse"){r.x1+=e.width/2;r.y1+=e.height/2;r.x2+=e.width/2;r.y2+=e.height/2}else if(this.gradientUnits==="objectBoundingBox"){n(e,r)}if(this.type==="linear"){i=["<linearGradient ",'id="SVGID_',this.id,'" gradientUnits="',this.gradientUnits,'" x1="',r.x1,'" y1="',r.y1,'" x2="',r.x2,'" y2="',r.y2,'">']}else if(this.type==="radial"){i=["<radialGradient ",'id="SVGID_',this.id,'" gradientUnits="',this.gradientUnits,'" cx="',r.x2,'" cy="',r.y2,'" r="',r.r2,'" fx="',r.x1,'" fy="',r.y1,'">']}for(var s=0;s<this.colorStops.length;s++){i.push("<stop ",'offset="',this.colorStops[s].offset*100+"%",'" style="stop-color:',this.colorStops[s].color,this.colorStops[s].opacity?";stop-opacity: "+this.colorStops[s].opacity:";",'"/>')}i.push(this.type==="linear"?"</linearGradient>":"</radialGradient>");return i.join("")}});fabric.util.object.extend(fabric.Gradient,{fromElement:function(n,r){var i=n.getElementsByTagName("stop"),s=n.nodeName==="linearGradient"?"linear":"radial",o=n.getAttribute("gradientUnits")||"objectBoundingBox",u=[],a={};if(s==="linear"){a={x1:n.getAttribute("x1")||0,y1:n.getAttribute("y1")||0,x2:n.getAttribute("x2")||"100%",y2:n.getAttribute("y2")||0}}else if(s==="radial"){a={x1:n.getAttribute("fx")||n.getAttribute("cx")||"50%",y1:n.getAttribute("fy")||n.getAttribute("cy")||"50%",r1:0,x2:n.getAttribute("cx")||"50%",y2:n.getAttribute("cy")||"50%",r2:n.getAttribute("r")||"50%"}}for(var f=i.length;f--;){u.push(e(i[f]))}t(r,a);return new fabric.Gradient({type:s,coords:a,gradientUnits:o,colorStops:u})},forObject:function(e,n){n||(n={});t(e,n);return new fabric.Gradient(n)}});fabric.getGradientDefs=r})();fabric.Pattern=fabric.util.createClass({repeat:"repeat",initialize:function(e){e||(e={});if(e.source){this.source=typeof e.source==="string"?new Function(e.source):e.source}if(e.repeat){this.repeat=e.repeat}},toObject:function(){var e;if(typeof this.source==="function"){e=String(this.source).match(/function\s+\w*\s*\(.*\)\s+\{([\s\S]*)\}/)[1]}else if(typeof this.source.src==="string"){e=this.source.src}return{source:e,repeat:this.repeat}},toLive:function(e){var t=typeof this.source==="function"?this.source():this.source;return e.createPattern(t,this.repeat)}});fabric.Shadow=fabric.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:false,initialize:function(e){for(var t in e){this[t]=e[t]}},toObject:function(){return{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY}},toSVG:function(){}});(function(e){"use strict";function n(e,t){if(arguments.length>0){this.init(e,t)}}var t=e.fabric||(e.fabric={});if(t.Point){t.warn("fabric.Point is already defined");return}t.Point=n;n.prototype={constructor:n,init:function(e,t){this.x=e;this.y=t},add:function(e){return new n(this.x+e.x,this.y+e.y)},addEquals:function(e){this.x+=e.x;this.y+=e.y;return this},scalarAdd:function(e){return new n(this.x+e,this.y+e)},scalarAddEquals:function(e){this.x+=e;this.y+=e;return this},subtract:function(e){return new n(this.x-e.x,this.y-e.y)},subtractEquals:function(e){this.x-=e.x;this.y-=e.y;return this},scalarSubtract:function(e){return new n(this.x-e,this.y-e)},scalarSubtractEquals:function(e){this.x-=e;this.y-=e;return this},multiply:function(e){return new n(this.x*e,this.y*e)},multiplyEquals:function(e){this.x*=e;this.y*=e;return this},divide:function(e){return new n(this.x/e,this.y/e)},divideEquals:function(e){this.x/=e;this.y/=e;return this},eq:function(e){return this.x===e.x&&this.y===e.y},lt:function(e){return this.x<e.x&&this.y<e.y},lte:function(e){return this.x<=e.x&&this.y<=e.y},gt:function(e){return this.x>e.x&&this.y>e.y},gte:function(e){return this.x>=e.x&&this.y>=e.y},lerp:function(e,t){return new n(this.x+(e.x-this.x)*t,this.y+(e.y-this.y)*t)},distanceFrom:function(e){var t=this.x-e.x,n=this.y-e.y;return Math.sqrt(t*t+n*n)},midPointFrom:function(e){return new n(this.x+(e.x-this.x)/2,this.y+(e.y-this.y)/2)},min:function(e){return new n(Math.min(this.x,e.x),Math.min(this.y,e.y))},max:function(e){return new n(Math.max(this.x,e.x),Math.max(this.y,e.y))},toString:function(){return this.x+","+this.y},setXY:function(e,t){this.x=e;this.y=t},setFromPoint:function(e){this.x=e.x;this.y=e.y},swap:function(e){var t=this.x,n=this.y;this.x=e.x;this.y=e.y;e.x=t;e.y=n}}})(typeof exports!=="undefined"?exports:this);(function(e){"use strict";function n(e){if(arguments.length>0){this.init(e)}}var t=e.fabric||(e.fabric={});if(t.Intersection){t.warn("fabric.Intersection is already defined");return}t.Intersection=n;t.Intersection.prototype={init:function(e){this.status=e;this.points=[]},appendPoint:function(e){this.points.push(e)},appendPoints:function(e){this.points=this.points.concat(e)}};t.Intersection.intersectLineLine=function(e,r,i,s){var o,u=(s.x-i.x)*(e.y-i.y)-(s.y-i.y)*(e.x-i.x),a=(r.x-e.x)*(e.y-i.y)-(r.y-e.y)*(e.x-i.x),f=(s.y-i.y)*(r.x-e.x)-(s.x-i.x)*(r.y-e.y);if(f!==0){var l=u/f,c=a/f;if(0<=l&&l<=1&&0<=c&&c<=1){o=new n("Intersection");o.points.push(new t.Point(e.x+l*(r.x-e.x),e.y+l*(r.y-e.y)))}else{o=new n("No Intersection")}}else{if(u===0||a===0){o=new n("Coincident")}else{o=new n("Parallel")}}return o};t.Intersection.intersectLinePolygon=function(e,t,r){var i=new n("No Intersection"),s=r.length;for(var o=0;o<s;o++){var u=r[o],a=r[(o+1)%s],f=n.intersectLineLine(e,t,u,a);i.appendPoints(f.points)}if(i.points.length>0){i.status="Intersection"}return i};t.Intersection.intersectPolygonPolygon=function(e,t){var r=new n("No Intersection"),i=e.length;for(var s=0;s<i;s++){var o=e[s],u=e[(s+1)%i],a=n.intersectLinePolygon(o,u,t);r.appendPoints(a.points)}if(r.points.length>0){r.status="Intersection"}return r};t.Intersection.intersectPolygonRectangle=function(e,r,i){var s=r.min(i),o=r.max(i),u=new t.Point(o.x,s.y),a=new t.Point(s.x,o.y),f=n.intersectLinePolygon(s,u,e),l=n.intersectLinePolygon(u,o,e),c=n.intersectLinePolygon(o,a,e),h=n.intersectLinePolygon(a,s,e),p=new n("No Intersection");p.appendPoints(f.points);p.appendPoints(l.points);p.appendPoints(c.points);p.appendPoints(h.points);if(p.points.length>0){p.status="Intersection"}return p}})(typeof exports!=="undefined"?exports:this);(function(e){"use strict";function n(e){if(!e){this.setSource([0,0,0,1])}else{this._tryParsingColor(e)}}var t=e.fabric||(e.fabric={});if(t.Color){t.warn("fabric.Color is already defined.");return}t.Color=n;t.Color.prototype={_tryParsingColor:function(e){var t;if(e in n.colorNameMap){e=n.colorNameMap[e]}t=n.sourceFromHex(e);if(!t){t=n.sourceFromRgb(e)}if(t){this.setSource(t)}},getSource:function(){return this._source},setSource:function(e){this._source=e},toRgb:function(){var e=this.getSource();return"rgb("+e[0]+","+e[1]+","+e[2]+")"},toRgba:function(){var e=this.getSource();return"rgba("+e[0]+","+e[1]+","+e[2]+","+e[3]+")"},toHex:function(){var e=this.getSource();var t=e[0].toString(16);t=t.length===1?"0"+t:t;var n=e[1].toString(16);n=n.length===1?"0"+n:n;var r=e[2].toString(16);r=r.length===1?"0"+r:r;return t.toUpperCase()+n.toUpperCase()+r.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(e){var t=this.getSource();t[3]=e;this.setSource(t);return this},toGrayscale:function(){var e=this.getSource(),t=parseInt((e[0]*.3+e[1]*.59+e[2]*.11).toFixed(0),10),n=e[3];this.setSource([t,t,t,n]);return this},toBlackWhite:function(e){var t=this.getSource(),n=(t[0]*.3+t[1]*.59+t[2]*.11).toFixed(0),r=t[3];e=e||127;n=Number(n)<Number(e)?0:255;this.setSource([n,n,n,r]);return this},overlayWith:function(e){if(!(e instanceof n)){e=new n(e)}var t=[],r=this.getAlpha(),i=.5,s=this.getSource(),o=e.getSource();for(var u=0;u<3;u++){t.push(Math.round(s[u]*(1-i)+o[u]*i))}t[3]=r;this.setSource(t);return this}};t.Color.reRGBa=/^rgba?\((\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})(?:\s*,\s*(\d+(?:\.\d+)?))?\)$/;t.Color.reHex=/^#?([0-9a-f]{6}|[0-9a-f]{3})$/i;t.Color.colorNameMap={aqua:"#00FFFF",black:"#000000",blue:"#0000FF",fuchsia:"#FF00FF",gray:"#808080",green:"#008000",lime:"#00FF00",maroon:"#800000",navy:"#000080",olive:"#808000",purple:"#800080",red:"#FF0000",silver:"#C0C0C0",teal:"#008080",white:"#FFFFFF",yellow:"#FFFF00"};t.Color.fromRgb=function(e){return n.fromSource(n.sourceFromRgb(e))};t.Color.sourceFromRgb=function(e){var t=e.match(n.reRGBa);if(t){return[parseInt(t[1],10),parseInt(t[2],10),parseInt(t[3],10),t[4]?parseFloat(t[4]):1]}};t.Color.fromRgba=n.fromRgb;t.Color.fromHex=function(e){return n.fromSource(n.sourceFromHex(e))};t.Color.sourceFromHex=function(e){if(e.match(n.reHex)){var t=e.slice(e.indexOf("#")+1),r=t.length===3,i=r?t.charAt(0)+t.charAt(0):t.substring(0,2),s=r?t.charAt(1)+t.charAt(1):t.substring(2,4),o=r?t.charAt(2)+t.charAt(2):t.substring(4,6);return[parseInt(i,16),parseInt(s,16),parseInt(o,16),1]}};t.Color.fromSource=function(e){var t=new n;t.setSource(e);return t}})(typeof exports!=="undefined"?exports:this);(function(){"use strict";if(fabric.StaticCanvas){fabric.warn("fabric.StaticCanvas is already defined.");return}var e=fabric.util.object.extend,t=fabric.util.getElementOffset,n=fabric.util.removeFromArray,r=fabric.util.removeListener,i=new Error("Could not initialize `canvas` element");fabric.StaticCanvas=function(e,t){t||(t={});this._initStatic(e,t);fabric.StaticCanvas.activeInstance=this};e(fabric.StaticCanvas.prototype,fabric.Observable);e(fabric.StaticCanvas.prototype,fabric.Collection);e(fabric.StaticCanvas.prototype,{backgroundColor:"",backgroundImage:"",backgroundImageOpacity:1,backgroundImageStretch:true,overlayImage:"",overlayImageLeft:0,overlayImageTop:0,includeDefaultValues:true,stateful:true,renderOnAddition:true,clipTo:null,controlsAboveOverlay:false,onBeforeScaleRotate:function(){},_initStatic:function(e,t){this._objects=[];this._createLowerCanvas(e);this._initOptions(t);if(t.overlayImage){this.setOverlayImage(t.overlayImage,this.renderAll.bind(this))}if(t.backgroundImage){this.setBackgroundImage(t.backgroundImage,this.renderAll.bind(this))}if(t.backgroundColor){this.setBackgroundColor(t.backgroundColor,this.renderAll.bind(this))}this.calcOffset()},calcOffset:function(){this._offset=t(this.lowerCanvasEl);return this},setOverlayImage:function(e,t,n){fabric.util.loadImage(e,function(e){this.overlayImage=e;if(n&&"overlayImageLeft"in n){this.overlayImageLeft=n.overlayImageLeft}if(n&&"overlayImageTop"in n){this.overlayImageTop=n.overlayImageTop}t&&t()},this);return this},setBackgroundImage:function(e,t,n){fabric.util.loadImage(e,function(e){this.backgroundImage=e;if(n&&"backgroundImageOpacity"in n){this.backgroundImageOpacity=n.backgroundImageOpacity}if(n&&"backgroundImageStretch"in n){this.backgroundImageStretch=n.backgroundImageStretch}t&&t()},this);return this},setBackgroundColor:function(e,t){if(e.source){var n=this;fabric.util.loadImage(e.source,function(r){n.backgroundColor=new fabric.Pattern({source:r,repeat:e.repeat});t&&t()})}else{this.backgroundColor=e;t&&t()}return this},_createCanvasElement:function(){var e=fabric.document.createElement("canvas");if(!e.style){e.style={}}if(!e){throw i}this._initCanvasElement(e);return e},_initCanvasElement:function(e){fabric.util.createCanvasElement(e);if(typeof e.getContext==="undefined"){throw i}},_initOptions:function(e){for(var t in e){this[t]=e[t]}this.width=parseInt(this.lowerCanvasEl.width,10)||0;this.height=parseInt(this.lowerCanvasEl.height,10)||0;if(!this.lowerCanvasEl.style)return;this.lowerCanvasEl.style.width=this.width+"px";this.lowerCanvasEl.style.height=this.height+"px"},_createLowerCanvas:function(e){this.lowerCanvasEl=fabric.util.getById(e)||this._createCanvasElement();this._initCanvasElement(this.lowerCanvasEl);fabric.util.addClass(this.lowerCanvasEl,"lower-canvas");if(this.interactive){this._applyCanvasStyle(this.lowerCanvasEl)}this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(e){return this._setDimension("width",e)},setHeight:function(e){return this._setDimension("height",e)},setDimensions:function(e){for(var t in e){this._setDimension(t,e[t])}return this},_setDimension:function(e,t){this.lowerCanvasEl[e]=t;this.lowerCanvasEl.style[e]=t+"px";if(this.upperCanvasEl){this.upperCanvasEl[e]=t;this.upperCanvasEl.style[e]=t+"px"}if(this.cacheCanvasEl){this.cacheCanvasEl[e]=t}if(this.wrapperEl){this.wrapperEl.style[e]=t+"px"}this[e]=t;this.calcOffset();this.renderAll();return this},getElement:function(){return this.lowerCanvasEl},getActiveObject:function(){return null},getActiveGroup:function(){return null},_draw:function(e,t){if(!t)return;if(this.controlsAboveOverlay){var n=t.hasBorders,r=t.hasControls;t.hasBorders=t.hasControls=false;t.render(e);t.hasBorders=n;t.hasControls=r}else{t.render(e)}},_onObjectAdded:function(e){this.stateful&&e.setupState();e.setCoords();e.canvas=this;this.fire("object:added",{target:e});e.fire("added")},_onObjectRemoved:function(e){this.fire("object:removed",{target:e});e.fire("removed")},getObjects:function(){return this._objects},clearContext:function(e){e.clearRect(0,0,this.width,this.height);return this},getContext:function(){return this.contextContainer},clear:function(){this._objects.length=0;if(this.discardActiveGroup){this.discardActiveGroup()}if(this.discardActiveObject){this.discardActiveObject()}this.clearContext(this.contextContainer);if(this.contextTop){this.clearContext(this.contextTop)}this.fire("canvas:cleared");this.renderAll();return this},renderAll:function(e){var t=this[e===true&&this.interactive?"contextTop":"contextContainer"];if(this.contextTop&&this.selection&&!this._groupSelector){this.clearContext(this.contextTop)}if(!e){this.clearContext(t)}this.fire("before:render");if(this.clipTo){fabric.util.clipContext(this,t)}if(this.backgroundColor){t.fillStyle=this.backgroundColor.toLive?this.backgroundColor.toLive(t):this.backgroundColor;t.fillRect(0,0,this.width,this.height)}if(typeof this.backgroundImage==="object"){this._drawBackroundImage(t)}var n=this.getActiveGroup();for(var r=0,i=this._objects.length;r<i;++r){if(!n||n&&this._objects[r]&&!n.contains(this._objects[r])){this._draw(t,this._objects[r])}}if(n){var s=[];this.forEachObject(function(e){if(n.contains(e)){s.push(e)}});n._set("objects",s);this._draw(t,n)}if(this.clipTo){t.restore()}if(this.overlayImage){t.drawImage(this.overlayImage,this.overlayImageLeft,this.overlayImageTop)}if(this.controlsAboveOverlay){this.drawControls(t)}this.fire("after:render");return this},_drawBackroundImage:function(e){e.save();e.globalAlpha=this.backgroundImageOpacity;if(this.backgroundImageStretch){e.drawImage(this.backgroundImage,0,0,this.width,this.height)}else{e.drawImage(this.backgroundImage,0,0)}e.restore()},renderTop:function(){var e=this.contextTop||this.contextContainer;this.clearContext(e);if(this.selection&&this._groupSelector){this._drawSelection()}var t=this.getActiveGroup();if(t){t.render(e)}if(this.overlayImage){e.drawImage(this.overlayImage,this.overlayImageLeft,this.overlayImageTop)}this.fire("after:render");return this},drawControls:function(e){var t=this.getActiveGroup();if(t){e.save();fabric.Group.prototype.transform.call(t,e);t.drawBorders(e).drawControls(e);e.restore()}else{for(var n=0,r=this._objects.length;n<r;++n){if(!this._objects[n]||!this._objects[n].active)continue;e.save();fabric.Object.prototype.transform.call(this._objects[n],e);this._objects[n].drawBorders(e).drawControls(e);e.restore();this.lastRenderedObjectWithControlsAboveOverlay=this._objects[n]}}},toDataURL:function(e){e||(e={});var t=e.format||"png",n=e.quality||1,r=e.multiplier||1;if(r!==1){return this.__toDataURLWithMultiplier(t,n,r)}else{return this.__toDataURL(t,n)}},__toDataURL:function(e,t){this.renderAll(true);var n=this.upperCanvasEl||this.lowerCanvasEl;var r=fabric.StaticCanvas.supports("toDataURLWithQuality")?n.toDataURL("image/"+e,t):n.toDataURL("image/"+e);this.contextTop&&this.clearContext(this.contextTop);this.renderAll();return r},__toDataURLWithMultiplier:function(e,t,n){var r=this.getWidth(),i=this.getHeight(),s=r*n,o=i*n,u=this.getActiveObject(),a=this.getActiveGroup(),f=this.contextTop||this.contextContainer;this.setWidth(s).setHeight(o);f.scale(n,n);if(a){this._tempRemoveBordersControlsFromGroup(a)}else if(u&&this.deactivateAll){this.deactivateAll()}this.width=r;this.height=i;this.renderAll(true);var l=this.__toDataURL(e,t);f.scale(1/n,1/n);this.setWidth(r).setHeight(i);if(a){this._restoreBordersControlsOnGroup(a)}else if(u&&this.setActiveObject){this.setActiveObject(u)}this.contextTop&&this.clearContext(this.contextTop);this.renderAll();return l},toDataURLWithMultiplier:function(e,t,n){return this.toDataURL({format:e,multiplier:t,quality:n})},_tempRemoveBordersControlsFromGroup:function(e){e.origHasControls=e.hasControls;e.origBorderColor=e.borderColor;e.hasControls=true;e.borderColor="rgba(0,0,0,0)";e.forEachObject(function(e){e.origBorderColor=e.borderColor;e.borderColor="rgba(0,0,0,0)"})},_restoreBordersControlsOnGroup:function(e){e.hideControls=e.origHideControls;e.borderColor=e.origBorderColor;e.forEachObject(function(e){e.borderColor=e.origBorderColor;delete e.origBorderColor})},getCenter:function(){return{top:this.getHeight()/2,left:this.getWidth()/2}},centerObjectH:function(e){e.set("left",this.getCenter().left);this.renderAll();return this},centerObjectV:function(e){e.set("top",this.getCenter().top);this.renderAll();return this},centerObject:function(e){return this.centerObjectH(e).centerObjectV(e)},toDatalessJSON:function(e){return this.toDatalessObject(e)},toObject:function(e){return this._toObjectMethod("toObject",e)},toDatalessObject:function(e){return this._toObjectMethod("toDatalessObject",e)},_toObjectMethod:function(e,t){var n={objects:this._objects.map(function(n){var r;if(!this.includeDefaultValues){r=n.includeDefaultValues;n.includeDefaultValues=false}var i=n[e](t);if(!this.includeDefaultValues){n.includeDefaultValues=r}return i},this),background:this.backgroundColor&&this.backgroundColor.toObject?this.backgroundColor.toObject():this.backgroundColor};if(this.backgroundImage){n.backgroundImage=this.backgroundImage.src;n.backgroundImageOpacity=this.backgroundImageOpacity;n.backgroundImageStretch=this.backgroundImageStretch}if(this.overlayImage){n.overlayImage=this.overlayImage.src;n.overlayImageLeft=this.overlayImageLeft;n.overlayImageTop=this.overlayImageTop}fabric.util.populateWithProperties(this,n,t);return n},toSVG:function(e){e||(e={});var t=[];if(!e.suppressPreamble){t.push('<?xml version="1.0" standalone="no" ?>','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ','"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">')}t.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',e.viewBox?e.viewBox.width:this.width,'" ','height="',e.viewBox?e.viewBox.height:this.height,'" ',this.backgroundColor&&!this.backgroundColor.source?'style="background-color: '+this.backgroundColor+'" ':null,e.viewBox?'viewBox="'+e.viewBox.x+" "+e.viewBox.y+" "+e.viewBox.width+" "+e.viewBox.height+'" ':null,'xml:space="preserve">',"<desc>Created with Fabric.js ",fabric.version,"</desc>","<defs>",fabric.createSVGFontFacesMarkup(this.getObjects()),fabric.createSVGRefElementsMarkup(this),"</defs>");if(this.backgroundColor&&this.backgroundColor.source){t.push('<rect x="0" y="0" ','width="',this.backgroundColor.repeat==="repeat-y"||this.backgroundColor.repeat==="no-repeat"?this.backgroundColor.source.width:this.width,'" height="',this.backgroundColor.repeat==="repeat-x"||this.backgroundColor.repeat==="no-repeat"?this.backgroundColor.source.height:this.height,'" fill="url(#backgroundColorPattern)"',"></rect>")}if(this.backgroundImage){t.push('<image x="0" y="0" ','width="',this.backgroundImageStretch?this.width:this.backgroundImage.width,'" height="',this.backgroundImageStretch?this.height:this.backgroundImage.height,'" preserveAspectRatio="',this.backgroundImageStretch?"none":"defer",'" xlink:href="',this.backgroundImage.src,'" style="opacity:',this.backgroundImageOpacity,'"></image>')}if(this.overlayImage){t.push('<image x="',this.overlayImageLeft,'" y="',this.overlayImageTop,'" width="',this.overlayImage.width,'" height="',this.overlayImage.height,'" xlink:href="',this.overlayImage.src,'"></image>')}for(var n=0,r=this.getObjects(),i=r.length;n<i;n++){t.push(r[n].toSVG())}t.push("</svg>");return t.join("")},remove:function(e){if(this.getActiveObject()===e){this.fire("before:selection:cleared",{target:e});this.discardActiveObject();this.fire("selection:cleared")}return fabric.Collection.remove.call(this,e)},sendToBack:function(e){n(this._objects,e);this._objects.unshift(e);return this.renderAll&&this.renderAll()},bringToFront:function(e){n(this._objects,e);this._objects.push(e);return this.renderAll&&this.renderAll()},sendBackwards:function(e){var t=this._objects.indexOf(e),r=t;if(t!==0){for(var i=t-1;i>=0;--i){var s=e.intersectsWithObject(this._objects[i])||e.isContainedWithinObject(this._objects[i])||this._objects[i].isContainedWithinObject(e);if(s){r=i;break}}n(this._objects,e);this._objects.splice(r,0,e)}return this.renderAll&&this.renderAll()},bringForward:function(e){var t=this.getObjects(),r=t.indexOf(e),i=r;if(r!==t.length-1){for(var s=r+1,o=this._objects.length;s<o;++s){var u=e.intersectsWithObject(t[s])||e.isContainedWithinObject(this._objects[s])||this._objects[s].isContainedWithinObject(e);if(u){i=s;break}}n(t,e);t.splice(i,0,e)}return this.renderAll&&this.renderAll()},moveTo:function(e,t){n(this._objects,e);this._objects.splice(t,0,e);return this.renderAll&&this.renderAll()},dispose:function(){this.clear();if(!this.interactive)return this;if(fabric.isTouchSupported){r(this.upperCanvasEl,"touchstart",this._onMouseDown);r(this.upperCanvasEl,"touchmove",this._onMouseMove);if(typeof Event!=="undefined"&&"remove"in Event){Event.remove(this.upperCanvasEl,"gesture",this._onGesture)}}else{r(this.upperCanvasEl,"mousedown",this._onMouseDown);r(this.upperCanvasEl,"mousemove",this._onMouseMove);r(fabric.window,"resize",this._onResize)}return this},_resizeImageToFit:function(e){var t=e.width||e.offsetWidth,n=this.getWidth()/t;if(t){e.width=t*n}}});fabric.StaticCanvas.prototype.toString=function(){return"#<fabric.Canvas ("+this.complexity()+"): "+"{ objects: "+this.getObjects().length+" }>"};e(fabric.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',toGrayscale:function(e){var t=e.getContext("2d"),n=t.getImageData(0,0,e.width,e.height),r=n.data,i=n.width,s=n.height,o,u,a,f;for(a=0;a<i;a++){for(f=0;f<s;f++){o=a*4*s+f*4;u=(r[o]+r[o+1]+r[o+2])/3;r[o]=u;r[o+1]=u;r[o+2]=u}}t.putImageData(n,0,0)},supports:function(e){var t=fabric.util.createCanvasElement();if(!t||!t.getContext){return null}var n=t.getContext("2d");if(!n){return null}switch(e){case"getImageData":return typeof n.getImageData!=="undefined";case"toDataURL":return typeof t.toDataURL!=="undefined";case"toDataURLWithQuality":try{t.toDataURL("image/jpeg",0);return true}catch(r){}return false;default:return null}}});fabric.StaticCanvas.prototype.toJSON=fabric.StaticCanvas.prototype.toObject})();fabric.BaseBrush=fabric.util.createClass({color:"rgb(0, 0, 0)",width:1,shadowBlur:0,shadowColor:"",shadowOffsetX:0,shadowOffsetY:0,setBrushStyles:function(){var e=this.canvas.contextTop;e.strokeStyle=this.color;e.lineWidth=this.width;e.lineCap=e.lineJoin="round"},setShadowStyles:function(){var e=this.canvas.contextTop;e.shadowBlur=this.shadowBlur;e.shadowColor=this.shadowColor||this.color;e.shadowOffsetX=this.shadowOffsetX;e.shadowOffsetY=this.shadowOffsetY}});(function(){var e=fabric.util.array.min,t=fabric.util.array.max;fabric.PencilBrush=fabric.util.createClass(fabric.BaseBrush,{initialize:function(e){this.canvas=e;this._points=[]},onMouseDown:function(e){this._prepareForDrawing(e);this._captureDrawingPath(e)},onMouseMove:function(e){this._captureDrawingPath(e);this.canvas.clearContext(this.canvas.contextTop);this._render(this.canvas.contextTop)},onMouseUp:function(){this._finalizeAndAddPath()},_prepareForDrawing:function(e){var t=new fabric.Point(e.x,e.y);this._reset();this._addPoint(t);this.canvas.contextTop.moveTo(t.x,t.y)},_addPoint:function(e){this._points.push(e)},_reset:function(){this._points.length=0;this.setBrushStyles();this.setShadowStyles()},_captureDrawingPath:function(e){var t=new fabric.Point(e.x,e.y);this._addPoint(t)},_render:function(){var e=this.canvas.contextTop;e.beginPath();var t=this._points[0];var n=this._points[1];e.moveTo(t.x,t.y);for(var r=1,i=this._points.length;r<i;r++){var s=t.midPointFrom(n);e.quadraticCurveTo(t.x,t.y,s.x,s.y);t=this._points[r];n=this._points[r+1]}e.lineTo(t.x,t.y);e.stroke()},_getSVGPathData:function(){this.box=this.getPathBoundingBox(this._points);return this.convertPointsToSVGPath(this._points,this.box.minx,this.box.maxx,this.box.miny,this.box.maxy)},getPathBoundingBox:function(n){var r=[],i=[],s=n[0],o=n[1],u=s;for(var a=1,f=n.length;a<f;a++){var l=s.midPointFrom(o);r.push(u.x);r.push(l.x);i.push(u.y);i.push(l.y);s=n[a];o=n[a+1];u=l}r.push(s.x);i.push(s.y);return{minx:e(r),miny:e(i),maxx:t(r),maxy:t(i)}},convertPointsToSVGPath:function(e,t,n,r){var i=[];var s=new fabric.Point(e[0].x-t,e[0].y-r);var o=new fabric.Point(e[1].x-t,e[1].y-r);i.push("M ",e[0].x-t," ",e[0].y-r," ");for(var u=1,a=e.length;u<a;u++){var f=s.midPointFrom(o);i.push("Q ",s.x," ",s.y," ",f.x," ",f.y," ");s=new fabric.Point(e[u].x-t,e[u].y-r);if(u+1<e.length){o=new fabric.Point(e[u+1].x-t,e[u+1].y-r)}}i.push("L ",s.x," ",s.y," ");return i},createPath:function(e){var t=new fabric.Path(e);t.fill=null;t.stroke=this.color;t.strokeWidth=this.width;t.setShadow({color:this.shadowColor||this.color,blur:this.shadowBlur,offsetX:this.shadowOffsetX,offsetY:this.shadowOffsetY,affectStroke:true});return t},_finalizeAndAddPath:function(){var e=this.canvas.contextTop;e.closePath();var t=this._getSVGPathData().join("");if(t==="M 0 0 Q 0 0 0 0 L 0 0"){this.canvas.renderAll();return}var n=this.box.minx+(this.box.maxx-this.box.minx)/2;var r=this.box.miny+(this.box.maxy-this.box.miny)/2;this.canvas.contextTop.arc(n,r,3,0,Math.PI*2,false);var i=this.createPath(t);i.set({left:n,top:r});this.canvas.add(i);i.setCoords();this.canvas.contextTop&&this.canvas.clearContext(this.canvas.contextTop);this.canvas.renderAll();this.canvas.fire("path:created",{path:i})}})})();fabric.CircleBrush=fabric.util.createClass(fabric.BaseBrush,{width:10,initialize:function(e){this.canvas=e;this.points=[]},onMouseDown:function(){this.points.length=0;this.canvas.clearContext(this.canvas.contextTop);this.setShadowStyles()},onMouseMove:function(e){var t=this.addPoint(e);var n=this.canvas.contextTop;n.fillStyle=t.fill;n.beginPath();n.arc(t.x,t.y,t.radius,0,Math.PI*2,false);n.closePath();n.fill()},onMouseUp:function(){var e=this.canvas.renderOnAddition;this.canvas.renderOnAddition=false;for(var t=0,n=this.points.length;t<n;t++){var r=this.points[t];var i=new fabric.Circle({radius:r.radius,left:r.x,top:r.y,fill:r.fill,shadow:{color:this.shadowColor||this.color,blur:this.shadowBlur,offsetX:this.shadowOffsetX,offsetY:this.shadowOffsetY}});this.canvas.add(i)}this.canvas.renderOnAddition=e;this.canvas.renderAll()},addPoint:function(e){var t=new fabric.Point(e.x,e.y);var n=fabric.util.getRandomInt(Math.max(0,this.width-20),this.width+20)/2;var r=(new fabric.Color(this.color)).setAlpha(fabric.util.getRandomInt(0,100)/100).toRgba();t.radius=n;t.fill=r;this.points.push(t);return t}});fabric.SprayBrush=fabric.util.createClass(fabric.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:false,initialize:function(e){this.canvas=e;this.sprayChunks=[]},onMouseDown:function(e){this.sprayChunks.length=0;this.canvas.clearContext(this.canvas.contextTop);this.setShadowStyles();this.addSprayChunk(e);this.render()},onMouseMove:function(e){this.addSprayChunk(e);this.render()},onMouseUp:function(){var e=this.canvas.renderOnAddition;this.canvas.renderOnAddition=false;for(var t=0,n=this.sprayChunks.length;t<n;t++){var r=this.sprayChunks[t];for(var i=0,s=r.length;i<s;i++){var o=new fabric.Rect({width:r[i].width,height:r[i].width,left:r[i].x+1,top:r[i].y+1,fill:this.color,shadow:{color:this.shadowColor||this.color,blur:this.shadowBlur,offsetX:this.shadowOffsetX,offsetY:this.shadowOffsetY}});this.canvas.add(o)}}this.canvas.renderOnAddition=e;this.canvas.clearContext(this.canvas.contextTop);this.canvas.renderAll()},render:function(){var e=this.canvas.contextTop;e.fillStyle=this.color;e.save();for(var t=0,n=this.sprayChunkPoints.length;t<n;t++){var r=this.sprayChunkPoints[t];if(typeof r.opacity!=="undefined"){e.globalAlpha=r.opacity}e.fillRect(r.x,r.y,r.width,r.width)}e.restore()},addSprayChunk:function(e){this.sprayChunkPoints=[];var t,n,r,i=this.width/2;for(var s=0;s<this.density;s++){t=fabric.util.getRandomInt(e.x-i,e.x+i);n=fabric.util.getRandomInt(e.y-i,e.y+i);if(this.dotWidthVariance){r=fabric.util.getRandomInt(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance)}else{r=this.dotWidth}var o={x:t,y:n,width:r};if(this.randomOpacity){o.opacity=fabric.util.getRandomInt(0,100)/100}this.sprayChunkPoints.push(o)}this.sprayChunks.push(this.sprayChunkPoints)}});fabric.PatternBrush=fabric.util.createClass(fabric.PencilBrush,{getPatternSrc:function(){var e=20,t=5,n=fabric.document.createElement("canvas"),r=n.getContext("2d");n.width=n.height=e+t;r.fillStyle=this.color;r.beginPath();r.arc(e/2,e/2,e/2,0,Math.PI*2,false);r.closePath();r.fill();return n},getPatternSrcBody:function(){return String(this.getPatternSrc).match(/function\s+\w*\s*\(.*\)\s+\{([\s\S]*)\}/)[1].replace("this.color",'"'+this.color+'"')},getPattern:function(){return this.canvas.contextTop.createPattern(this.source||this.getPatternSrc(),"repeat")},setBrushStyles:function(){this.callSuper("setBrushStyles");this.canvas.contextTop.strokeStyle=this.getPattern()},createPath:function(e){var t=this.callSuper("createPath",e);t.stroke=new fabric.Pattern({source:this.source||this.getPatternSrcBody()});return t}});(function(){function f(){}var e=fabric.util.object.extend,t=fabric.util.getPointer,n=fabric.util.degreesToRadians,r=fabric.util.radiansToDegrees,i=Math.atan2,s=Math.abs,o=Math.min,u=Math.max,a=.5;fabric.Canvas=function(e,t){t||(t={});this._initStatic(e,t);this._initInteractive();this._createCacheCanvas();fabric.Canvas.activeInstance=this};f.prototype=fabric.StaticCanvas.prototype;fabric.Canvas.prototype=new f;var l={uniScaleTransform:false,centerTransform:false,interactive:true,selection:true,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",rotationCursor:"crosshair",containerClass:"canvas-container",perPixelTargetFind:false,targetFindTolerance:0,_initInteractive:function(){this._currentTransform=null;this._groupSelector=null;this._initWrapperElement();this._createUpperCanvas();this._initEvents();this.freeDrawingBrush=fabric.PencilBrush&&new fabric.PencilBrush(this);this.calcOffset()},_resetCurrentTransform:function(e){var t=this._currentTransform;t.target.set("scaleX",t.original.scaleX);t.target.set("scaleY",t.original.scaleY);t.target.set("left",t.original.left);t.target.set("top",t.original.top);if(e.altKey||this.centerTransform){if(t.originX!=="center"){if(t.originX==="right"){t.mouseXSign=-1}else{t.mouseXSign=1}}if(t.originY!=="center"){if(t.originY==="bottom"){t.mouseYSign=-1}else{t.mouseYSign=1}}t.originX="center";t.originY="center"}else{t.originX=t.original.originX;t.originY=t.original.originY}},containsPoint:function(e,t){var n=this.getPointer(e),r=this._normalizePointer(t,n),i=r.x,s=r.y;var o=t._getImageLines(t.oCoords),u=t._findCrossPoints(i,s,o);if(u&&u%2===1||t._findTargetCorner(e,this._offset)){return true}return false},_normalizePointer:function(e,t){var n=this.getActiveGroup(),r=t.x,i=t.y;var s=n&&e.type!=="group"&&n.contains(e);if(s){r-=n.left;i-=n.top}return{x:r,y:i}},_isTargetTransparent:function(e,t,n){var r=this.contextCache;var i=e.hasBorders,s=e.transparentCorners;e.hasBorders=e.transparentCorners=false;this._draw(r,e);e.hasBorders=i;e.transparentCorners=s;if(this.targetFindTolerance>0){if(t>this.targetFindTolerance){t-=this.targetFindTolerance}else{t=0}if(n>this.targetFindTolerance){n-=this.targetFindTolerance}else{n=0}}var o=true;var u=r.getImageData(t,n,this.targetFindTolerance*2||1,this.targetFindTolerance*2||1);for(var a=3;a<u.data.length;a+=4){var f=u.data[a];o=f<=0;if(o===false)break}u=null;this.clearContext(r);return o},_shouldClearSelection:function(e){var t=this.findTarget(e),n=this.getActiveGroup();return!t||t&&n&&!n.contains(t)&&n!==t&&!e.shiftKey},_setupCurrentTransform:function(e,r){if(!r)return;var i="drag",s,o=t(e,r.canvas.upperCanvasEl);s=r._findTargetCorner(e,this._offset);if(s){i=s==="ml"||s==="mr"?"scaleX":s==="mt"||s==="mb"?"scaleY":s==="mtr"?"rotate":"scale"}var u="center",a="center";if(s==="ml"||s==="tl"||s==="bl"){u="right"}else if(s==="mr"||s==="tr"||s==="br"){u="left"}if(s==="tl"||s==="mt"||s==="tr"){a="bottom"}else if(s==="bl"||s==="mb"||s==="br"){a="top"}if(s==="mtr"){u="center";a="center"}this._currentTransform={target:r,action:i,scaleX:r.scaleX,scaleY:r.scaleY,offsetX:o.x-r.left,offsetY:o.y-r.top,originX:u,originY:a,ex:o.x,ey:o.y,left:r.left,top:r.top,theta:n(r.angle),width:r.width*r.scaleX,mouseXSign:1,mouseYSign:1};this._currentTransform.original={left:r.left,top:r.top,scaleX:r.scaleX,scaleY:r.scaleY,originX:u,originY:a};this._resetCurrentTransform(e)},_shouldHandleGroupLogic:function(e,t){var n=this.getActiveObject();return e.shiftKey&&(this.getActiveGroup()||n&&n!==t)&&this.selection},_handleGroupLogic:function(e,t){if(t===this.getActiveGroup()){t=this.findTarget(e,true);if(!t||t.isType("group")){return}}var n=this.getActiveGroup();if(n){if(n.contains(t)){n.removeWithUpdate(t);this._resetObjectTransform(n);t.set("active",false);if(n.size()===1){this.discardActiveGroup()}}else{n.addWithUpdate(t);this._resetObjectTransform(n)}this.fire("selection:created",{target:n,e:e});n.set("active",true)}else{if(this._activeObject){if(t!==this._activeObject){var r=new fabric.Group([this._activeObject,t]);this.setActiveGroup(r);n=this.getActiveGroup()}}t.set("active",true)}if(n){n.saveCoords()}},_translateObject:function(e,t){var n=this._currentTransform.target;if(!n.get("lockMovementX")){n.set("left",e-this._currentTransform.offsetX)}if(!n.get("lockMovementY")){n.set("top",t-this._currentTransform.offsetY)}},_scaleObject:function(e,t,n){var r=this._currentTransform,i=this._offset,s=r.target;var o=s.get("lockScalingX"),u=s.get("lockScalingY");if(o&&u)return;var a=s.translateToOriginPoint(s.getCenterPoint(),r.originX,r.originY);var f=s.toLocalPoint(new fabric.Point(e-i.left,t-i.top),r.originX,r.originY);if(r.originX==="right"){f.x*=-1}else if(r.originX==="center"){f.x*=r.mouseXSign*2;if(f.x<0){r.mouseXSign=-r.mouseXSign}}if(r.originY==="bottom"){f.y*=-1}else if(r.originY==="center"){f.y*=r.mouseYSign*2;if(f.y<0){r.mouseYSign=-r.mouseYSign}}var l=s.scaleX,c=s.scaleY;if(n==="equally"&&!o&&!u){var h=f.y+f.x;var p=s.height*r.original.scaleY+s.width*r.original.scaleX+s.padding*2-s.strokeWidth*2+1;l=r.original.scaleX*h/p;c=r.original.scaleY*h/p;s.set("scaleX",l);s.set("scaleY",c)}else if(!n){l=f.x/(s.width+s.padding);c=f.y/(s.height+s.padding);o||s.set("scaleX",l);u||s.set("scaleY",c)}else if(n==="x"&&!s.get("lockUniScaling")){l=f.x/(s.width+s.padding);o||s.set("scaleX",l)}else if(n==="y"&&!s.get("lockUniScaling")){c=f.y/(s.height+s.padding);u||s.set("scaleY",c)}if(l<0){if(r.originX==="left")r.originX="right";else if(r.originX==="right")r.originX="left"}if(c<0){if(r.originY==="top")r.originY="bottom";else if(r.originY==="bottom")r.originY="top"}s.setPositionByOrigin(a,r.originX,r.originY)},_rotateObject:function(e,t){var n=this._currentTransform,s=this._offset;if(n.target.get("lockRotation"))return;var o=i(n.ey-n.top-s.top,n.ex-n.left-s.left),u=i(t-n.top-s.top,e-n.left-s.left);n.target.angle=r(u-o+n.theta)},_setCursor:function(e){this.upperCanvasEl.style.cursor=e},_resetObjectTransform:function(e){e.scaleX=1;e.scaleY=1;e.setAngle(0)},_drawSelection:function(){var e=this.contextTop,t=this._groupSelector,n=t.left,r=t.top,i=s(n),o=s(r);e.fillStyle=this.selectionColor;e.fillRect(t.ex-(n>0?0:-n),t.ey-(r>0?0:-r),i,o);e.lineWidth=this.selectionLineWidth;e.strokeStyle=this.selectionBorderColor;if(this.selectionDashArray.length>1){var u=t.ex+a-(n>0?0:i);var f=t.ey+a-(r>0?0:o);e.beginPath();fabric.util.drawDashedLine(e,u,f,u+i,f,this.selectionDashArray);fabric.util.drawDashedLine(e,u,f+o-1,u+i,f+o-1,this.selectionDashArray);fabric.util.drawDashedLine(e,u,f,u,f+o,this.selectionDashArray);fabric.util.drawDashedLine(e,u+i-1,f,u+i-1,f+o,this.selectionDashArray);e.closePath();e.stroke()}else{e.strokeRect(t.ex+a-(n>0?0:i),t.ey+a-(r>0?0:o),i,o)}},_findSelectedObjects:function(e){var t=[],n=this._groupSelector.ex,r=this._groupSelector.ey,i=n+this._groupSelector.left,s=r+this._groupSelector.top,a,f=new fabric.Point(o(n,i),o(r,s)),l=new fabric.Point(u(n,i),u(r,s));for(var c=0,h=this._objects.length;c<h;++c){a=this._objects[c];if(!a)continue;if(a.intersectsWithRect(f,l)||a.isContainedWithinRect(f,l)){if(this.selection&&a.selectable){a.set("active",true);t.push(a)}}}if(t.length===1){this.setActiveObject(t[0],e)}else if(t.length>1){t=new fabric.Group(t);this.setActiveGroup(t);t.saveCoords();this.fire("selection:created",{target:t})}this.renderAll()},findTarget:function(e,t){var n,r=this.getPointer(e);if(this.controlsAboveOverlay&&this.lastRenderedObjectWithControlsAboveOverlay&&this.lastRenderedObjectWithControlsAboveOverlay.visible&&this.containsPoint(e,this.lastRenderedObjectWithControlsAboveOverlay)&&this.lastRenderedObjectWithControlsAboveOverlay._findTargetCorner(e,this._offset)){n=this.lastRenderedObjectWithControlsAboveOverlay;return n}var i=this.getActiveGroup();if(i&&!t&&this.containsPoint(e,i)){n=i;return n}var s=[];for(var o=this._objects.length;o--;){if(this._objects[o]&&this._objects[o].visible&&this.containsPoint(e,this._objects[o])){if(this.perPixelTargetFind||this._objects[o].perPixelTargetFind){s[s.length]=this._objects[o]}else{n=this._objects[o];this.relatedTarget=n;break}}}for(var u=0,a=s.length;u<a;u++){r=this.getPointer(e);var f=this._isTargetTransparent(s[u],r.x,r.y);if(!f){n=s[u];this.relatedTarget=n;break}}if(n&&n.selectable){return n}},getPointer:function(e){var n=t(e,this.upperCanvasEl);return{x:n.x-this._offset.left,y:n.y-this._offset.top}},_createUpperCanvas:function(){this.upperCanvasEl=this._createCanvasElement();this.upperCanvasEl.className="upper-canvas";this.wrapperEl.appendChild(this.upperCanvasEl);this._applyCanvasStyle(this.upperCanvasEl);this.contextTop=this.upperCanvasEl.getContext("2d")},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement();this.cacheCanvasEl.setAttribute("width",this.width);this.cacheCanvasEl.setAttribute("height",this.height);this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=fabric.util.wrapElement(this.lowerCanvasEl,"div",{"class":this.containerClass});fabric.util.setStyle(this.wrapperEl,{width:this.getWidth()+"px",height:this.getHeight()+"px",position:"relative"});fabric.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(e){var t=this.getWidth()||e.width,n=this.getHeight()||e.height;fabric.util.setStyle(e,{position:"absolute",width:t+"px",height:n+"px",left:0,top:0});e.width=t;e.height=n;fabric.util.makeElementUnselectable(e)},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},setActiveObject:function(e,t){if(this._activeObject){this._activeObject.set("active",false)}this._activeObject=e;e.set("active",true);this.renderAll();this.fire("object:selected",{target:e,e:t});e.fire("selected",{e:t});return this},getActiveObject:function(){return this._activeObject},discardActiveObject:function(){if(this._activeObject){this._activeObject.set("active",false)}this._activeObject=null;return this},setActiveGroup:function(e){this._activeGroup=e;if(e){e.canvas=this;e.set("active",true)}return this},getActiveGroup:function(){return this._activeGroup},discardActiveGroup:function(){var e=this.getActiveGroup();if(e){e.destroy()}return this.setActiveGroup(null)},deactivateAll:function(){var e=this.getObjects(),t=0,n=e.length;for(;t<n;t++){e[t].set("active",false)}this.discardActiveGroup();this.discardActiveObject();return this},deactivateAllWithDispatch:function(){var e=this.getActiveGroup()||this.getActiveObject();if(e){this.fire("before:selection:cleared",{target:e})}this.deactivateAll();if(e){this.fire("selection:cleared")}return this}};fabric.Canvas.prototype.toString=fabric.StaticCanvas.prototype.toString;e(fabric.Canvas.prototype,l);for(var c in fabric.StaticCanvas){if(c!=="prototype"){fabric.Canvas[c]=fabric.StaticCanvas[c]}}if(fabric.isTouchSupported){fabric.Canvas.prototype._setCursorFromEvent=function(){}}fabric.Element=fabric.Canvas})();(function(){var e={tr:"ne-resize",br:"se-resize",bl:"sw-resize",tl:"nw-resize",ml:"w-resize",mt:"n-resize",mr:"e-resize",mb:"s-resize"},t=fabric.util.addListener,n=fabric.util.removeListener,r=fabric.util.getPointer;fabric.util.object.extend(fabric.Canvas.prototype,{_initEvents:function(){var e=this;this._onMouseDown=this._onMouseDown.bind(this);this._onMouseMove=this._onMouseMove.bind(this);this._onMouseUp=this._onMouseUp.bind(this);this._onResize=this._onResize.bind(this);this._onGesture=function(t,n){e.__onTransformGesture(t,n)};t(fabric.window,"resize",this._onResize);if(fabric.isTouchSupported){t(this.upperCanvasEl,"touchstart",this._onMouseDown);t(this.upperCanvasEl,"touchmove",this._onMouseMove);if(typeof Event!=="undefined"&&"add"in Event){Event.add(this.upperCanvasEl,"gesture",this._onGesture)}}else{t(this.upperCanvasEl,"mousedown",this._onMouseDown);t(this.upperCanvasEl,"mousemove",this._onMouseMove)}},_onMouseDown:function(e){this.__onMouseDown(e);!fabric.isTouchSupported&&t(fabric.document,"mouseup",this._onMouseUp);fabric.isTouchSupported&&t(fabric.document,"touchend",this._onMouseUp);!fabric.isTouchSupported&&t(fabric.document,"mousemove",this._onMouseMove);fabric.isTouchSupported&&t(fabric.document,"touchmove",this._onMouseMove);!fabric.isTouchSupported&&n(this.upperCanvasEl,"mousemove",this._onMouseMove)},_onMouseUp:function(e){this.__onMouseUp(e);!fabric.isTouchSupported&&n(fabric.document,"mouseup",this._onMouseUp);fabric.isTouchSupported&&n(fabric.document,"touchend",this._onMouseUp);!fabric.isTouchSupported&&n(fabric.document,"mousemove",this._onMouseMove);fabric.isTouchSupported&&n(fabric.document,"touchmove",this._onMouseMove);!fabric.isTouchSupported&&t(this.upperCanvasEl,"mousemove",this._onMouseMove)},_onMouseMove:function(e){e.preventDefault&&e.preventDefault();this.__onMouseMove(e)},_onResize:function(){this.calcOffset()},__onMouseUp:function(e){var t;if(this.isDrawingMode&&this._isCurrentlyDrawing){this._isCurrentlyDrawing=false;this.freeDrawingBrush.onMouseUp();this.fire("mouse:up",{e:e});return}if(this._currentTransform){var n=this._currentTransform;t=n.target;if(t._scaling){t._scaling=false}var r=this._objects.length;while(r--){this._objects[r].setCoords()}t.isMoving=false;if(this.stateful&&t.hasStateChanged()){this.fire("object:modified",{target:t});t.fire("modified")}if(this._previousOriginX){this._currentTransform.target.adjustPosition(this._previousOriginX);this._previousOriginX=null}}this._currentTransform=null;if(this._groupSelector){this._findSelectedObjects(e)}var i=this.getActiveGroup();if(i){i.setObjectsCoords();i.set("isMoving",false);this._setCursor(this.defaultCursor)}this._groupSelector=null;this.renderAll();this._setCursorFromEvent(e,t);this._setCursor("");var s=this;setTimeout(function(){s._setCursorFromEvent(e,t)},50);this.fire("mouse:up",{target:t,e:e});t&&t.fire("mouseup",{e:e})},__onMouseDown:function(e){var t;var n="which"in e?e.which===1:e.button===1;if(!n&&!fabric.isTouchSupported)return;if(this.isDrawingMode){t=this.getPointer(e);this._isCurrentlyDrawing=true;this.discardActiveObject().renderAll();this.freeDrawingBrush.onMouseDown(t);this.fire("mouse:down",{e:e});return}if(this._currentTransform)return;var r=this.findTarget(e),i;t=this.getPointer(e);if(this._shouldClearSelection(e)){this._groupSelector={ex:t.x,ey:t.y,top:0,left:0};this.deactivateAllWithDispatch();r&&this.setActiveObject(r,e)}else{this.stateful&&r.saveState();if(i=r._findTargetCorner(e,this._offset)){this.onBeforeScaleRotate(r)}if(this._shouldHandleGroupLogic(e,r)){this._handleGroupLogic(e,r);r=this.getActiveGroup()}else{if(r!==this.getActiveGroup()){this.deactivateAll();this.setActiveObject(r,e)}}this._setupCurrentTransform(e,r)}this.renderAll();this.fire("mouse:down",{target:r,e:e});r&&r.fire("mousedown",{e:e});if(i==="mtr"){this._previousOriginX=this._currentTransform.target.originX;this._currentTransform.target.adjustPosition("center");this._currentTransform.left=this._currentTransform.target.left;this._currentTransform.top=this._currentTransform.target.top}},__onMouseMove:function(e){var t,n;if(this.isDrawingMode){if(this._isCurrentlyDrawing){n=this.getPointer(e);this.freeDrawingBrush.onMouseMove(n)}this.upperCanvasEl.style.cursor=this.freeDrawingCursor;this.fire("mouse:move",{e:e});return}var i=this._groupSelector;if(i!==null){n=r(e,this.upperCanvasEl);i.left=n.x-this._offset.left-i.ex;i.top=n.y-this._offset.top-i.ey;this.renderTop()}else if(!this._currentTransform){var s=this.upperCanvasEl.style;t=this.findTarget(e);if(!t){for(var o=this._objects.length;o--;){if(this._objects[o]&&!this._objects[o].active){this._objects[o].set("active",false)}}s.cursor=this.defaultCursor}else{this._setCursorFromEvent(e,t)}}else{n=r(e,this.upperCanvasEl);var u=n.x,a=n.y;this._currentTransform.target.isMoving=true;var f=this._currentTransform,l=false;if((f.action==="scale"||f.action==="scaleX"||f.action==="scaleY")&&(e.altKey&&(f.originX!=="center"||f.originY!=="center")||!e.altKey&&f.originX==="center"&&f.originY==="center")){this._resetCurrentTransform(e);l=true}if(this._currentTransform.action==="rotate"){this._rotateObject(u,a);this.fire("object:rotating",{target:this._currentTransform.target,e:e});this._currentTransform.target.fire("rotating")}else if(this._currentTransform.action==="scale"){if(e.shiftKey||this.uniScaleTransform){this._currentTransform.currentAction="scale";this._scaleObject(u,a)}else{if(!l&&f.currentAction==="scale"){this._resetCurrentTransform(e)}this._currentTransform.currentAction="scaleEqually";this._scaleObject(u,a,"equally")}this.fire("object:scaling",{target:this._currentTransform.target,e:e});this._currentTransform.target.fire("scaling",{e:e})}else if(this._currentTransform.action==="scaleX"){this._scaleObject(u,a,"x");this.fire("object:scaling",{target:this._currentTransform.target,e:e});this._currentTransform.target.fire("scaling",{e:e})}else if(this._currentTransform.action==="scaleY"){this._scaleObject(u,a,"y");this.fire("object:scaling",{target:this._currentTransform.target,e:e});this._currentTransform.target.fire("scaling",{e:e})}else{this._translateObject(u,a);this.fire("object:moving",{target:this._currentTransform.target,e:e});this._currentTransform.target.fire("moving",{e:e});this._setCursor(this.moveCursor)}this.renderAll()}this.fire("mouse:move",{target:t,e:e});t&&t.fire("mousemove",{e:e})},_setCursorFromEvent:function(t,n){var r=this.upperCanvasEl.style;if(!n){r.cursor=this.defaultCursor;return false}else{var i=this.getActiveGroup();var s=n._findTargetCorner&&(!i||!i.contains(n))&&n._findTargetCorner(t,this._offset);if(!s){r.cursor=this.hoverCursor}else{if(s in e){r.cursor=e[s]}else if(s==="mtr"&&n.hasRotatingPoint){r.cursor=this.rotationCursor}else{r.cursor=this.defaultCursor;return false}}}return true}})})();fabric.util.object.extend(fabric.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(e,t){t=t||{};var n=function(){},r=t.onComplete||n,i=t.onChange||n,s=this;fabric.util.animate({startValue:e.get("left"),endValue:this.getCenter().left,duration:this.FX_DURATION,onChange:function(t){e.set("left",t);s.renderAll();i()},onComplete:function(){e.setCoords();r()}});return this},fxCenterObjectV:function(e,t){t=t||{};var n=function(){},r=t.onComplete||n,i=t.onChange||n,s=this;fabric.util.animate({startValue:e.get("top"),endValue:this.getCenter().top,duration:this.FX_DURATION,onChange:function(t){e.set("top",t);s.renderAll();i()},onComplete:function(){e.setCoords();r()}});return this},fxRemove:function(e,t){t=t||{};var n=function(){},r=t.onComplete||n,i=t.onChange||n,s=this;fabric.util.animate({startValue:e.get("opacity"),endValue:0,duration:this.FX_DURATION,onStart:function(){e.set("active",false)},onChange:function(t){e.set("opacity",t);s.renderAll();i()},onComplete:function(){s.remove(e);r()}});return this}});fabric.util.object.extend(fabric.StaticCanvas.prototype,{loadFromDatalessJSON:function(e,t){if(!e)return;var n=typeof e==="string"?JSON.parse(e):e;if(!n||n&&!n.objects)return;this.clear();var r=this;this._enlivenDatalessObjects(n.objects,function(){r._setBgOverlayImages(n,t)})},_enlivenDatalessObjects:function(e,t){function s(e,s){n.insertAt(e,s,true);e.setCoords();if(++r===i){t&&t()}}function o(e,t){var n=e.paths?"paths":"path";var r=e[n];delete e[n];if(typeof r!=="string"){if(e.type==="image"||e.type==="group"){fabric[fabric.util.string.capitalize(e.type)].fromObject(e,function(e){s(e,t)})}else{var i=fabric[fabric.util.string.camelize(fabric.util.string.capitalize(e.type))];if(!i||!i.fromObject)return;if(r){e[n]=r}s(i.fromObject(e),t)}}else{if(e.type==="image"){fabric.util.loadImage(r,function(n){var i=new fabric.Image(n);i.setSourcePath(r);fabric.util.object.extend(i,e);i.setAngle(e.angle);s(i,t)})}else if(e.type==="text"){if(e.useNative){s(fabric.Text.fromObject(e),t)}else{e.path=r;var o=fabric.Text.fromObject(e);var u=function(){if(Object.prototype.toString.call(fabric.window.opera)==="[object Opera]"){setTimeout(function(){s(o,t)},500)}else{s(o,t)}};fabric.util.getScript(r,u)}}else{fabric.loadSVGFromURL(r,function(n){var i=fabric.util.groupSVGElements(n,e,r);if(!(i instanceof fabric.PathGroup)){fabric.util.object.extend(i,e);if(typeof e.angle!=="undefined"){i.setAngle(e.angle)}}s(i,t)})}}}var n=this,r=0,i=e.length;if(i===0&&t){t()}try{e.forEach(o,this)}catch(u){fabric.log(u)}},loadFromJSON:function(e,t){if(!e)return;var n=typeof e==="string"?JSON.parse(e):e;var r=this;this._enlivenObjects(n.objects,function(){r._setBgOverlayImages(n,t)});return this},_setBgOverlayImages:function(e,t){var n=this,r,i,s;if(e.backgroundImage){this.setBackgroundImage(e.backgroundImage,function(){n.backgroundImageOpacity=e.backgroundImageOpacity;n.backgroundImageStretch=e.backgroundImageStretch;n.renderAll();i=true;t&&s&&r&&t()})}else{i=true}if(e.overlayImage){this.setOverlayImage(e.overlayImage,function(){n.overlayImageLeft=e.overlayImageLeft||0;n.overlayImageTop=e.overlayImageTop||0;n.renderAll();s=true;t&&i&&r&&t()})}else{s=true}if(e.background){this.setBackgroundColor(e.background,function(){n.renderAll();r=true;t&&s&&i&&t()})}else{r=true}if(!e.backgroundImage&&!e.overlayImage&&!e.background){t&&t()}},_enlivenObjects:function(e,t){var n=this;fabric.util.enlivenObjects(e,function(e){e.forEach(function(e,t){n.insertAt(e,t,true)});t&&t()})},_toDataURL:function(e,t){this.clone(function(n){t(n.toDataURL(e))})},_toDataURLWithMultiplier:function(e,t,n){this.clone(function(r){n(r.toDataURLWithMultiplier(e,t))})},clone:function(e){var t=JSON.stringify(this);this.cloneWithoutData(function(n){n.loadFromJSON(t,function(){e&&e(n)})})},cloneWithoutData:function(e){var t=fabric.document.createElement("canvas");t.width=this.getWidth();t.height=this.getHeight();var n=new fabric.Canvas(t);n.clipTo=this.clipTo;if(this.backgroundImage){n.setBackgroundImage(this.backgroundImage.src,function(){n.renderAll();e&&e(n)});n.backgroundImageOpacity=this.backgroundImageOpacity;n.backgroundImageStretch=this.backgroundImageStretch}else{e&&e(n)}}});(function(e){"use strict";var t=e.fabric||(e.fabric={}),n=t.util.object.extend,r=t.util.toFixed,i=t.util.string.capitalize,s=t.util.degreesToRadians;if(t.Object){return}var o=e.Image;try{var u=typeof require!=="undefined"&&require("canvas").Image;if(u){o=u}}catch(a){t.log(a)}t.Object=t.util.createClass({type:"object",originX:"center",originY:"center",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:false,flipY:false,opacity:1,angle:0,cornerSize:12,transparentCorners:true,padding:0,borderColor:"rgba(102,153,255,0.75)",cornerColor:"rgba(102,153,255,0.5)",fill:"rgb(0,0,0)",fillRule:"source-over",overlayFill:null,stroke:null,strokeWidth:1,strokeDashArray:null,shadow:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,transformMatrix:null,minScaleLimit:.01,selectable:true,visible:true,hasControls:true,hasBorders:true,hasRotatingPoint:true,rotatingPointOffset:40,perPixelTargetFind:false,includeDefaultValues:true,clipTo:null,lockMovementX:false,lockMovementY:false,lockRotation:false,lockScalingX:false,lockScalingY:false,lockUniScaling:false,stateProperties:("top left width height scaleX scaleY flipX flipY "+"angle opacity cornerSize fill overlayFill originX originY "+"stroke strokeWidth strokeDashArray fillRule "+"borderScaleFactor transformMatrix selectable shadow visible").split(" "),initialize:function(e){if(e){this.setOptions(e)}},_initGradient:function(e){if(e.fill&&e.fill.colorStops&&!(e.fill instanceof t.Gradient)){this.set("fill",new t.Gradient(e.fill))}},_initPattern:function(e){if(e.fill&&e.fill.source&&!(e.fill instanceof t.Pattern)){this.set("fill",new t.Pattern(e.fill))}if(e.stroke&&e.stroke.source&&!(e.stroke instanceof t.Pattern)){this.set("stroke",new t.Pattern(e.stroke))}},_initShadow:function(e){if(e.shadow&&!(e.shadow instanceof t.Shadow)){this.setShadow(e.shadow)}},setOptions:function(e){for(var t in e){this.set(t,e[t])}this._initGradient(e);this._initPattern(e);this._initShadow(e)},transform:function(e){e.globalAlpha=this.opacity;var t=this.getCenterPoint();e.translate(t.x,t.y);e.rotate(s(this.angle));e.scale(this.scaleX*(this.flipX?-1:1),this.scaleY*(this.flipY?-1:1))},toObject:function(e){var n=t.Object.NUM_FRACTION_DIGITS;var i={type:this.type,originX:this.originX,originY:this.originY,left:r(this.left,n),top:r(this.top,n),width:r(this.width,n),height:r(this.height,n),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,overlayFill:this.overlayFill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:this.strokeWidth,strokeDashArray:this.strokeDashArray,scaleX:r(this.scaleX,n),scaleY:r(this.scaleY,n),angle:r(this.getAngle(),n),flipX:this.flipX,flipY:this.flipY,opacity:r(this.opacity,n),selectable:this.selectable,hasControls:this.hasControls,hasBorders:this.hasBorders,hasRotatingPoint:this.hasRotatingPoint,transparentCorners:this.transparentCorners,perPixelTargetFind:this.perPixelTargetFind,shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible};if(!this.includeDefaultValues){i=this._removeDefaultValues(i)}t.util.populateWithProperties(this,i,e);return i},toDatalessObject:function(e){return this.toObject(e)},getSvgStyles:function(){return["stroke: ",this.stroke?this.stroke:"none","; ","stroke-width: ",this.strokeWidth?this.strokeWidth:"0","; ","stroke-dasharray: ",this.strokeDashArray?this.strokeDashArray.join(" "):"; ","fill: ",this.fill?this.fill&&this.fill.toLive?"url(#SVGID_"+this.fill.id+")":this.fill:"none","; ","opacity: ",this.opacity?this.opacity:"1",";",this.visible?"":" visibility: hidden;"].join("")},getSvgTransform:function(){var e=this.getAngle();var n=this.getCenterPoint();var i=t.Object.NUM_FRACTION_DIGITS;var s="translate("+r(n.x,i)+" "+r(n.y,i)+")";var o=e!==0?" rotate("+r(e,i)+")":"";var u=this.scaleX===1&&this.scaleY===1?"":" scale("+r(this.scaleX,i)+" "+r(this.scaleY,i)+")";var a=this.flipX?"matrix(-1 0 0 1 0 0) ":"";var f=this.flipY?"matrix(1 0 0 -1 0 0)":"";return[s,o,u,a,f].join("")},_removeDefaultValues:function(e){var n=t.Object.prototype.options;if(n){this.stateProperties.forEach(function(t){if(e[t]===n[t]){delete e[t]}})}return e},toString:function(){return"#<fabric."+i(this.type)+">"},get:function(e){return this[e]},set:function(e,t){if(typeof e==="object"){for(var n in e){this._set(n,e[n])}}else{if(typeof t==="function"){this._set(e,t(this.get(e)))}else{this._set(e,t)}}return this},_set:function(e,t){var n=e==="scaleX"||e==="scaleY";if(n){t=this._constrainScale(t)}if(e==="scaleX"&&t<0){this.flipX=!this.flipX;t*=-1}else if(e==="scaleY"&&t<0){this.flipY=!this.flipY;t*=-1}else if(e==="width"||e==="height"){this.minScaleLimit=r(Math.min(.1,1/Math.max(this.width,this.height)),2)}this[e]=t;return this},toggle:function(e){var t=this.get(e);if(typeof t==="boolean"){this.set(e,!t)}return this},setSourcePath:function(e){this.sourcePath=e;return this},render:function(e,n){if(this.width===0||this.height===0||!this.visible)return;e.save();var r=this.transformMatrix;if(r&&!this.group){e.setTransform(r[0],r[1],r[2],r[3],r[4],r[5])}if(!n){this.transform(e)}if(this.stroke||this.strokeDashArray){e.lineWidth=this.strokeWidth;if(this.stroke&&this.stroke.toLive){e.strokeStyle=this.stroke.toLive(e)}else{e.strokeStyle=this.stroke}}if(this.overlayFill){e.fillStyle=this.overlayFill}else if(this.fill){e.fillStyle=this.fill.toLive?this.fill.toLive(e):this.fill}if(r&&this.group){e.translate(-this.group.width/2,-this.group.height/2);e.transform(r[0],r[1],r[2],r[3],r[4],r[5])}this._setShadow(e);this.clipTo&&t.util.clipContext(this,e);this._render(e,n);this.clipTo&&e.restore();this._removeShadow(e);if(this.active&&!n){this.drawBorders(e);this.drawControls(e)}e.restore()},_setShadow:function(e){if(!this.shadow)return;e.shadowColor=this.shadow.color;e.shadowBlur=this.shadow.blur;e.shadowOffsetX=this.shadow.offsetX;e.shadowOffsetY=this.shadow.offsetY},_removeShadow:function(e){e.shadowColor="";e.shadowBlur=e.shadowOffsetX=e.shadowOffsetY=0},clone:function(e,n){if(this.constructor.fromObject){return this.constructor.fromObject(this.toObject(n),e)}return new t.Object(this.toObject(n))},cloneAsImage:function(e){if(t.Image){var n=new o;n.onload=function(){if(e){e(new t.Image(n),r)}n=n.onload=null};var r={angle:this.getAngle(),flipX:this.getFlipX(),flipY:this.getFlipY()};this.set({angle:0,flipX:false,flipY:false});this.toDataURL(function(e){n.src=e})}return this},toDataURL:function(e){function i(t){t.left=n.width/2;t.top=n.height/2;t.set("active",false);r.add(t);var i=r.toDataURL();r.dispose();r=t=null;e&&e(i)}var n=t.util.createCanvasElement();n.width=this.getBoundingRectWidth();n.height=this.getBoundingRectHeight();t.util.wrapElement(n,"div");var r=new t.Canvas(n);r.backgroundColor="transparent";r.renderAll();if(this.constructor.async){this.clone(i)}else{i(this.clone())}},hasStateChanged:function(){return this.stateProperties.some(function(e){return this[e]!==this.originalState[e]},this)},saveState:function(e){this.stateProperties.forEach(function(e){this.originalState[e]=this.get(e)},this);if(e&&e.stateProperties){e.stateProperties.forEach(function(e){this.originalState[e]=this.get(e)},this)}return this},setupState:function(){this.originalState={};this.saveState()},isType:function(e){return this.type===e},toGrayscale:function(){var e=this.get("fill");if(e){this.set("overlayFill",(new t.Color(e)).toGrayscale().toRgb())}return this},complexity:function(){return 0},toJSON:function(e){return this.toObject(e)},setGradient:function(e,n){n||(n={});var r={colorStops:[]};r.type=n.type||(n.r1||n.r2?"radial":"linear");r.coords={x1:n.x1,y1:n.y1,x2:n.x2,y2:n.y2};if(n.r1||n.r2){r.coords.r1=n.r1;r.coords.r2=n.r2}for(var i in n.colorStops){var s=new t.Color(n.colorStops[i]);r.colorStops.push({offset:i,color:s.toRgb(),opacity:s.getAlpha()})}this.set(e,t.Gradient.forObject(this,r))},setPatternFill:function(e){return this.set("fill",new t.Pattern(e))},setShadow:function(e){return this.set("shadow",new t.Shadow(e))},animate:function(){if(arguments[0]&&typeof arguments[0]==="object"){var e=[],t,n;for(t in arguments[0]){e.push(t)}for(var r=0,i=e.length;r<i;r++){t=e[r];n=r!==i-1;this._animate(t,arguments[0][t],arguments[1],n)}}else{this._animate.apply(this,arguments)}return this},_animate:function(e,n,r,i){var s=this,o;n=n.toString();if(!r){r={}}else{r=t.util.object.clone(r)}if(~e.indexOf(".")){o=e.split(".")}var u=o?this.get(o[0])[o[1]]:this.get(e);if(!("from"in r)){r.from=u}if(~n.indexOf("=")){n=u+parseFloat(n.replace("=",""))}else{n=parseFloat(n)}t.util.animate({startValue:r.from,endValue:n,byValue:r.by,easing:r.easing,duration:r.duration,onChange:function(t){if(o){s[o[0]][o[1]]=t}else{s.set(e,t)}if(i)return;r.onChange&&r.onChange()},onComplete:function(){if(i)return;s.setCoords();r.onComplete&&r.onComplete()}})},centerH:function(){this.canvas.centerObjectH(this);return this},centerV:function(){this.canvas.centerObjectV(this);return this},center:function(){return this.centerH().centerV()},remove:function(){return this.canvas.remove(this)},sendToBack:function(){if(this.group){t.StaticCanvas.prototype.sendToBack.call(this.group,this)}else{this.canvas.sendToBack(this)}return this},bringToFront:function(){if(this.group){t.StaticCanvas.prototype.bringToFront.call(this.group,this)}else{this.canvas.bringToFront(this)}return this},sendBackwards:function(){if(this.group){t.StaticCanvas.prototype.sendBackwards.call(this.group,this)}else{this.canvas.sendBackwards(this)}return this},bringForward:function(){if(this.group){t.StaticCanvas.prototype.bringForward.call(this.group,this)}else{this.canvas.bringForward(this)}return this},moveTo:function(e){if(this.group){t.StaticCanvas.prototype.moveTo.call(this.group,this,e)}else{this.canvas.moveTo(this,e)}return this}});t.util.createAccessors(t.Object);t.Object.prototype.rotate=t.Object.prototype.setAngle;n(t.Object.prototype,t.Observable);t.Object.NUM_FRACTION_DIGITS=2;t.Object.__uid=0})(typeof exports!=="undefined"?exports:this);(function(){var e=fabric.util.degreesToRadians;fabric.util.object.extend(fabric.Object.prototype,{translateToCenterPoint:function(t,n,r){var i=t.x,s=t.y;if(n==="left"){i=t.x+this.getWidth()/2}else if(n==="right"){i=t.x-this.getWidth()/2}if(r==="top"){s=t.y+this.getHeight()/2}else if(r==="bottom"){s=t.y-this.getHeight()/2}return fabric.util.rotatePoint(new fabric.Point(i,s),t,e(this.angle))},translateToOriginPoint:function(t,n,r){var i=t.x,s=t.y;if(n==="left"){i=t.x-this.getWidth()/2}else if(n==="right"){i=t.x+this.getWidth()/2}if(r==="top"){s=t.y-this.getHeight()/2}else if(r==="bottom"){s=t.y+this.getHeight()/2}return fabric.util.rotatePoint(new fabric.Point(i,s),t,e(this.angle))},getCenterPoint:function(){return this.translateToCenterPoint(new fabric.Point(this.left,this.top),this.originX,this.originY)},toLocalPoint:function(t,n,r){var i=this.getCenterPoint();var s,o;if(n!==undefined&&r!==undefined){if(n==="left"){s=i.x-this.getWidth()/2}else if(n==="right"){s=i.x+this.getWidth()/2}else{s=i.x}if(r==="top"){o=i.y-this.getHeight()/2}else if(r==="bottom"){o=i.y+this.getHeight()/2}else{o=i.y}}else{s=this.left;o=this.top}return fabric.util.rotatePoint(new fabric.Point(t.x,t.y),i,-e(this.angle)).subtractEquals(new fabric.Point(s,o))},setPositionByOrigin:function(e,t,n){var r=this.translateToCenterPoint(e,t,n);var i=this.translateToOriginPoint(r,this.originX,this.originY);this.set("left",i.x);this.set("top",i.y)},adjustPosition:function(t){var n=e(this.angle);var r=this.getWidth()/2;var i=Math.cos(n)*r;var s=Math.sin(n)*r;var o=this.getWidth();var u=Math.cos(n)*o;var a=Math.sin(n)*o;if(this.originX==="center"&&t==="left"||this.originX==="right"&&t==="center"){this.left-=i;this.top-=s}else if(this.originX==="left"&&t==="center"||this.originX==="center"&&t==="right"){this.left+=i;this.top+=s}else if(this.originX==="left"&&t==="right"){this.left+=u;this.top+=a}else if(this.originX==="right"&&t==="left"){this.left-=u;this.top-=a}this.setCoords();this.originX=t}})})();(function(){var e=fabric.util.degreesToRadians;fabric.util.object.extend(fabric.Object.prototype,{intersectsWithRect:function(e,t){var n=this.oCoords,r=new fabric.Point(n.tl.x,n.tl.y),i=new fabric.Point(n.tr.x,n.tr.y),s=new fabric.Point(n.bl.x,n.bl.y),o=new fabric.Point(n.br.x,n.br.y);var u=fabric.Intersection.intersectPolygonRectangle([r,i,o,s],e,t);return u.status==="Intersection"},intersectsWithObject:function(e){function t(e){return{tl:new fabric.Point(e.tl.x,e.tl.y),tr:new fabric.Point(e.tr.x,e.tr.y),bl:new fabric.Point(e.bl.x,e.bl.y),br:new fabric.Point(e.br.x,e.br.y)}}var n=t(this.oCoords),r=t(e.oCoords);var i=fabric.Intersection.intersectPolygonPolygon([n.tl,n.tr,n.br,n.bl],[r.tl,r.tr,r.br,r.bl]);return i.status==="Intersection"},isContainedWithinObject:function(e){return this.isContainedWithinRect(e.oCoords.tl,e.oCoords.br)},isContainedWithinRect:function(e,t){var n=this.oCoords,r=new fabric.Point(n.tl.x,n.tl.y),i=new fabric.Point(n.tr.x,n.tr.y),s=new fabric.Point(n.bl.x,n.bl.y);return r.x>e.x&&i.x<t.x&&r.y>e.y&&s.y<t.y},getBoundingRectWidth:function(){return this.getBoundingRect().width},getBoundingRectHeight:function(){return this.getBoundingRect().height},getBoundingRect:function(){this.oCoords||this.setCoords();var e=[this.oCoords.tl.x,this.oCoords.tr.x,this.oCoords.br.x,this.oCoords.bl.x];var t=fabric.util.array.min(e);var n=fabric.util.array.max(e);var r=Math.abs(t-n);var i=[this.oCoords.tl.y,this.oCoords.tr.y,this.oCoords.br.y,this.oCoords.bl.y];var s=fabric.util.array.min(i);var o=fabric.util.array.max(i);var u=Math.abs(s-o);return{left:t,top:s,width:r,height:u}},getWidth:function(){return this.width*this.scaleX},getHeight:function(){return this.height*this.scaleY},_constrainScale:function(e){if(Math.abs(e)<this.minScaleLimit){if(e<0)return-this.minScaleLimit;else return this.minScaleLimit}return e},scale:function(e){e=this._constrainScale(e);if(e<0){this.flipX=!this.flipX;this.flipY=!this.flipY;e*=-1}this.scaleX=e;this.scaleY=e;this.setCoords();return this},scaleToWidth:function(e){var t=this.getBoundingRectWidth()/this.getWidth();return this.scale(e/this.width/t)},scaleToHeight:function(e){var t=this.getBoundingRectHeight()/this.getHeight();return this.scale(e/this.height/t)},setCoords:function(){var t=this.strokeWidth>1?this.strokeWidth:0,n=this.padding,r=e(this.angle);this.currentWidth=(this.width+t)*this.scaleX+n*2;this.currentHeight=(this.height+t)*this.scaleY+n*2;if(this.currentWidth<0){this.currentWidth=Math.abs(this.currentWidth)}var i=Math.sqrt(Math.pow(this.currentWidth/2,2)+Math.pow(this.currentHeight/2,2));var s=Math.atan(this.currentHeight/this.currentWidth);var o=Math.cos(s+r)*i,u=Math.sin(s+r)*i,a=Math.sin(r),f=Math.cos(r);var l=this.getCenterPoint();var c={x:l.x-o,y:l.y-u};var h={x:c.x+this.currentWidth*f,y:c.y+this.currentWidth*a};var p={x:h.x-this.currentHeight*a,y:h.y+this.currentHeight*f};var d={x:c.x-this.currentHeight*a,y:c.y+this.currentHeight*f};var v={x:c.x-this.currentHeight/2*a,y:c.y+this.currentHeight/2*f};var m={x:c.x+this.currentWidth/2*f,y:c.y+this.currentWidth/2*a};var g={x:h.x-this.currentHeight/2*a,y:h.y+this.currentHeight/2*f};var y={x:d.x+this.currentWidth/2*f,y:d.y+this.currentWidth/2*a};var b={x:c.x+this.currentWidth/2*f,y:c.y+this.currentWidth/2*a};this.oCoords={tl:c,tr:h,br:p,bl:d,ml:v,mt:m,mr:g,mb:y,mtr:b};this._setCornerCoords();return this}})})();(function(){var e=fabric.util.getPointer,t=fabric.util.degreesToRadians;fabric.util.object.extend(fabric.Object.prototype,{_findTargetCorner:function(t,n){if(!this.hasControls||!this.active)return false;var r=e(t,this.canvas.upperCanvasEl),i=r.x-n.left,s=r.y-n.top,o,u;for(var a in this.oCoords){if(a==="mtr"&&!this.hasRotatingPoint){continue}if(this.get("lockUniScaling")&&(a==="mt"||a==="mr"||a==="mb"||a==="ml")){continue}u=this._getImageLines(this.oCoords[a].corner,a);o=this._findCrossPoints(i,s,u);if(o%2===1&&o!==0){this.__corner=a;return a}}return false},_findCrossPoints:function(e,t,n){var r,i,s,o,u,a,f=0,l;for(var c in n){l=n[c];if(l.o.y<t&&l.d.y<t){continue}if(l.o.y>=t&&l.d.y>=t){continue}if(l.o.x===l.d.x&&l.o.x>=e){u=l.o.x;a=t}else{r=0;i=(l.d.y-l.o.y)/(l.d.x-l.o.x);s=t-r*e;o=l.o.y-i*l.o.x;u=-(s-o)/(r-i);a=s+r*u}if(u>=e){f+=1}if(f===2){break}}return f},_getImageLines:function(e){return{topline:{o:e.tl,d:e.tr},rightline:{o:e.tr,d:e.br},bottomline:{o:e.br,d:e.bl},leftline:{o:e.bl,d:e.tl}}},_setCornerCoords:function(){var e=this.oCoords,n=t(this.angle),r=t(45-this.angle),i=Math.sqrt(2*Math.pow(this.cornerSize,2))/2,s=i*Math.cos(r),o=i*Math.sin(r),u=Math.sin(n),a=Math.cos(n);e.tl.corner={tl:{x:e.tl.x-o,y:e.tl.y-s},tr:{x:e.tl.x+s,y:e.tl.y-o},bl:{x:e.tl.x-s,y:e.tl.y+o},br:{x:e.tl.x+o,y:e.tl.y+s}};e.tr.corner={tl:{x:e.tr.x-o,y:e.tr.y-s},tr:{x:e.tr.x+s,y:e.tr.y-o},br:{x:e.tr.x+o,y:e.tr.y+s},bl:{x:e.tr.x-s,y:e.tr.y+o}};e.bl.corner={tl:{x:e.bl.x-o,y:e.bl.y-s},bl:{x:e.bl.x-s,y:e.bl.y+o},br:{x:e.bl.x+o,y:e.bl.y+s},tr:{x:e.bl.x+s,y:e.bl.y-o}};e.br.corner={tr:{x:e.br.x+s,y:e.br.y-o},bl:{x:e.br.x-s,y:e.br.y+o},br:{x:e.br.x+o,y:e.br.y+s},tl:{x:e.br.x-o,y:e.br.y-s}};e.ml.corner={tl:{x:e.ml.x-o,y:e.ml.y-s},tr:{x:e.ml.x+s,y:e.ml.y-o},bl:{x:e.ml.x-s,y:e.ml.y+o},br:{x:e.ml.x+o,y:e.ml.y+s}};e.mt.corner={tl:{x:e.mt.x-o,y:e.mt.y-s},tr:{x:e.mt.x+s,y:e.mt.y-o},bl:{x:e.mt.x-s,y:e.mt.y+o},br:{x:e.mt.x+o,y:e.mt.y+s}};e.mr.corner={tl:{x:e.mr.x-o,y:e.mr.y-s},tr:{x:e.mr.x+s,y:e.mr.y-o},bl:{x:e.mr.x-s,y:e.mr.y+o},br:{x:e.mr.x+o,y:e.mr.y+s}};e.mb.corner={tl:{x:e.mb.x-o,y:e.mb.y-s},tr:{x:e.mb.x+s,y:e.mb.y-o},bl:{x:e.mb.x-s,y:e.mb.y+o},br:{x:e.mb.x+o,y:e.mb.y+s}};e.mtr.corner={tl:{x:e.mtr.x-o+u*this.rotatingPointOffset,y:e.mtr.y-s-a*this.rotatingPointOffset},tr:{x:e.mtr.x+s+u*this.rotatingPointOffset,y:e.mtr.y-o-a*this.rotatingPointOffset},bl:{x:e.mtr.x-s+u*this.rotatingPointOffset,y:e.mtr.y+o-a*this.rotatingPointOffset},br:{x:e.mtr.x+o+u*this.rotatingPointOffset,y:e.mtr.y+s-a*this.rotatingPointOffset}}},drawBorders:function(e){if(!this.hasBorders)return;var t=this.padding,n=t*2,r=this.strokeWidth>1?this.strokeWidth:0;e.save();e.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1;e.strokeStyle=this.borderColor;var i=1/this._constrainScale(this.scaleX),s=1/this._constrainScale(this.scaleY);e.lineWidth=1/this.borderScaleFactor;e.scale(i,s);var o=this.getWidth(),u=this.getHeight();e.strokeRect(~~(-(o/2)-t-r/2*this.scaleX)+.5,~~(-(u/2)-t-r/2*this.scaleY)+.5,~~(o+n+r*this.scaleX),~~(u+n+r*this.scaleY));if(this.hasRotatingPoint&&!this.get("lockRotation")&&this.hasControls){var a=(this.flipY?u+r*this.scaleY+t*2:-u-r*this.scaleY-t*2)/2;e.beginPath();e.moveTo(0,a);e.lineTo(0,a+(this.flipY?this.rotatingPointOffset:-this.rotatingPointOffset));e.closePath();e.stroke()}e.restore();return this},drawControls:function(e){if(!this.hasControls)return;var t=this.cornerSize,n=t/2,r=this.strokeWidth/2,i=-(this.width/2),s=-(this.height/2),o,u,a=t/this.scaleX,f=t/this.scaleY,l=this.padding/this.scaleX,c=this.padding/this.scaleY,h=n/this.scaleY,p=n/this.scaleX,d=(n-t)/this.scaleX,v=(n-t)/this.scaleY,m=this.height,g=this.width,y=this.transparentCorners?"strokeRect":"fillRect",b=typeof G_vmlCanvasManager!=="undefined";e.save();e.lineWidth=1/Math.max(this.scaleX,this.scaleY);e.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1;e.strokeStyle=e.fillStyle=this.cornerColor;o=i-p-r-l;u=s-h-r-c;b||e.clearRect(o,u,a,f);e[y](o,u,a,f);o=i+g-p+r+l;u=s-h-r-c;b||e.clearRect(o,u,a,f);e[y](o,u,a,f);o=i-p-r-l;u=s+m+v+r+c;b||e.clearRect(o,u,a,f);e[y](o,u,a,f);o=i+g+d+r+l;u=s+m+v+r+c;b||e.clearRect(o,u,a,f);e[y](o,u,a,f);if(!this.get("lockUniScaling")){o=i+g/2-p;u=s-h-r-c;b||e.clearRect(o,u,a,f);e[y](o,u,a,f);o=i+g/2-p;u=s+m+v+r+c;b||e.clearRect(o,u,a,f);e[y](o,u,a,f);o=i+g+d+r+l;u=s+m/2-h;b||e.clearRect(o,u,a,f);e[y](o,u,a,f);o=i-p-r-l;u=s+m/2-h;b||e.clearRect(o,u,a,f);e[y](o,u,a,f)}if(this.hasRotatingPoint){o=i+g/2-p;u=this.flipY?s+m+this.rotatingPointOffset/this.scaleY-f/2+r+c:s-this.rotatingPointOffset/this.scaleY-f/2-r-c;b||e.clearRect(o,u,a,f);e[y](o,u,a,f)}e.restore();return this}})})();(function(e){"use strict";var t=e.fabric||(e.fabric={}),n=t.util.object.extend,r={x1:1,x2:1,y1:1,y2:1};if(t.Line){t.warn("fabric.Line is already defined");return}t.Line=t.util.createClass(t.Object,{type:"line",initialize:function(e,t){t=t||{};if(!e){e=[0,0,0,0]}this.callSuper("initialize",t);this.set("x1",e[0]);this.set("y1",e[1]);this.set("x2",e[2]);this.set("y2",e[3]);this._setWidthHeight(t)},_setWidthHeight:function(e){e||(e={});this.set("width",this.x2-this.x1||1);this.set("height",this.y2-this.y1||1);this.set("left","left"in e?e.left:this.x1+this.width/2);this.set("top","top"in e?e.top:this.y1+this.height/2)},_set:function(e,t){this[e]=t;if(e in r){this._setWidthHeight()}return this},_render:function(e){e.beginPath();var t=this.group&&this.group.type!=="group";if(t){e.translate(-this.group.width/2+this.left,-this.group.height/2+this.top)}e.moveTo(this.width===1?0:-this.width/2,this.height===1?0:-this.height/2);e.lineTo(this.width===1?0:this.width/2,this.height===1?0:this.height/2);e.lineWidth=this.strokeWidth;var n=e.strokeStyle;e.strokeStyle=e.fillStyle;e.stroke();e.strokeStyle=n},complexity:function(){return 1},toObject:function(e){return n(this.callSuper("toObject",e),{x1:this.get("x1"),y1:this.get("y1"),x2:this.get("x2"),y2:this.get("y2")})},toSVG:function(){var e=[];if(this.stroke&&this.stroke.toLive){e.push(this.stroke.toSVG(this,true))}e.push("<line ",'x1="',this.get("x1"),'" y1="',this.get("y1"),'" x2="',this.get("x2"),'" y2="',this.get("y2"),'" style="',this.getSvgStyles(),'"/>');return e.join("")}});t.Line.ATTRIBUTE_NAMES="x1 y1 x2 y2 stroke stroke-width transform".split(" ");t.Line.fromElement=function(e,r){var i=t.parseAttributes(e,t.Line.ATTRIBUTE_NAMES);var s=[i.x1||0,i.y1||0,i.x2||0,i.y2||0];return new t.Line(s,n(i,r))};t.Line.fromObject=function(e){var n=[e.x1,e.y1,e.x2,e.y2];return new t.Line(n,e)}})(typeof exports!=="undefined"?exports:this);(function(e){"use strict";function i(e){return"radius"in e&&e.radius>0}var t=e.fabric||(e.fabric={}),n=Math.PI*2,r=t.util.object.extend;if(t.Circle){t.warn("fabric.Circle is already defined.");return}t.Circle=t.util.createClass(t.Object,{type:"circle",initialize:function(e){e=e||{};this.set("radius",e.radius||0);this.callSuper("initialize",e);var t=this.get("radius")*2;this.set("width",t).set("height",t)},toObject:function(e){return r(this.callSuper("toObject",e),{radius:this.get("radius")})},toSVG:function(){var e=[];if(this.fill&&this.fill.toLive){e.push(this.fill.toSVG(this,false))}if(this.stroke&&this.stroke.toLive){e.push(this.stroke.toSVG(this,false))}e.push("<circle ",'cx="0" cy="0" ','r="',this.radius,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>');return e.join("")},_render:function(e,t){e.beginPath();e.globalAlpha=this.group?e.globalAlpha*this.opacity:this.opacity;e.arc(t?this.left:0,t?this.top:0,this.radius,0,n,false);e.closePath();if(this.fill){e.fill()}this._removeShadow(e);if(this.stroke){e.stroke()}},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(e){this.radius=e;this.set("width",e*2).set("height",e*2)},complexity:function(){return 1}});t.Circle.ATTRIBUTE_NAMES="cx cy r fill fill-opacity opacity stroke stroke-width transform".split(" ");t.Circle.fromElement=function(e,n){n||(n={});var s=t.parseAttributes(e,t.Circle.ATTRIBUTE_NAMES);if(!i(s)){throw new Error("value of `r` attribute is required and can not be negative")}if("left"in s){s.left-=n.width/2||0}if("top"in s){s.top-=n.height/2||0}var o=new t.Circle(r(s,n));o.cx=parseFloat(e.getAttribute("cx"))||0;o.cy=parseFloat(e.getAttribute("cy"))||0;return o};t.Circle.fromObject=function(e){return new t.Circle(e)}})(typeof exports!=="undefined"?exports:this);(function(e){"use strict";var t=e.fabric||(e.fabric={});if(t.Triangle){t.warn("fabric.Triangle is already defined");return}t.Triangle=t.util.createClass(t.Object,{type:"triangle",initialize:function(e){e=e||{};this.callSuper("initialize",e);this.set("width",e.width||100).set("height",e.height||100)},_render:function(e){var t=this.width/2,n=this.height/2;e.beginPath();e.moveTo(-t,n);e.lineTo(0,-n);e.lineTo(t,n);e.closePath();if(this.fill){e.fill()}if(this.stroke){e.stroke()}},complexity:function(){return 1},toSVG:function(){var e=[],t=this.width/2,n=this.height/2;var r=[-t+" "+n,"0 "+ -n,t+" "+n].join(",");if(this.fill&&this.fill.toLive){e.push(this.fill.toSVG(this,true))}if(this.stroke&&this.stroke.toLive){e.push(this.stroke.toSVG(this,true))}e.push("<polygon ",'points="',r,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>');return e.join("")}});t.Triangle.fromObject=function(e){return new t.Triangle(e)}})(typeof exports!=="undefined"?exports:this);(function(e){"use strict";var t=e.fabric||(e.fabric={}),n=Math.PI*2,r=t.util.object.extend;if(t.Ellipse){t.warn("fabric.Ellipse is already defined.");return}t.Ellipse=t.util.createClass(t.Object,{type:"ellipse",rx:0,ry:0,initialize:function(e){e=e||{};this.callSuper("initialize",e);this.set("rx",e.rx||0);this.set("ry",e.ry||0);this.set("width",this.get("rx")*2);this.set("height",this.get("ry")*2)},toObject:function(e){return r(this.callSuper("toObject",e),{rx:this.get("rx"),ry:this.get("ry")})},toSVG:function(){var e=[];if(this.fill&&this.fill.toLive){e.push(this.fill.toSVG(this,false))}if(this.stroke&&this.stroke.toLive){e.push(this.stroke.toSVG(this,false))}e.push("<ellipse ",'rx="',this.get("rx"),'" ry="',this.get("ry"),'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>');return e.join("")},render:function(e,t){if(this.rx===0||this.ry===0)return;return this.callSuper("render",e,t)},_render:function(e,t){e.beginPath();e.save();e.globalAlpha=this.group?e.globalAlpha*this.opacity:this.opacity;if(this.transformMatrix&&this.group){e.translate(this.cx,this.cy)}e.transform(1,0,0,this.ry/this.rx,0,0);e.arc(t?this.left:0,t?this.top:0,this.rx,0,n,false);if(this.stroke){e.stroke()}this._removeShadow(e);if(this.fill){e.fill()}e.restore()},complexity:function(){return 1}});t.Ellipse.ATTRIBUTE_NAMES="cx cy rx ry fill fill-opacity opacity stroke stroke-width transform".split(" ");t.Ellipse.fromElement=function(e,n){n||(n={});var i=t.parseAttributes(e,t.Ellipse.ATTRIBUTE_NAMES);var s=i.left;var o=i.top;if("left"in i){i.left-=n.width/2||0}if("top"in i){i.top-=n.height/2||0}var u=new t.Ellipse(r(i,n));u.cx=s||0;u.cy=o||0;return u};t.Ellipse.fromObject=function(e){return new t.Ellipse(e)}})(typeof exports!=="undefined"?exports:this);(function(e){"use strict";function r(e){e.left=e.left||0;e.top=e.top||0;return e}var t=e.fabric||(e.fabric={}),n=t.util.object.extend;if(t.Rect){console.warn("fabric.Rect is already defined");return}t.Rect=t.util.createClass(t.Object,{type:"rect",rx:0,ry:0,strokeDashArray:null,initialize:function(e){e=e||{};this._initStateProperties();this.callSuper("initialize",e);this._initRxRy();this.x=0;this.y=0},_initStateProperties:function(){this.stateProperties=this.stateProperties.concat(["rx","ry"])},_initRxRy:function(){if(this.rx&&!this.ry){this.ry=this.rx}else if(this.ry&&!this.rx){this.rx=this.ry}},_render:function(e){var t=this.rx||0,n=this.ry||0,r=-this.width/2,i=-this.height/2,s=this.width,o=this.height,u=this.group&&this.group.type!=="group";e.beginPath();e.globalAlpha=u?e.globalAlpha*this.opacity:this.opacity;if(this.transformMatrix&&u){e.translate(this.width/2+this.x,this.height/2+this.y)}if(!this.transformMatrix&&u){e.translate(-this.group.width/2+this.width/2+this.x,-this.group.height/2+this.height/2+this.y)}e.moveTo(r+t,i);e.lineTo(r+s-t,i);e.quadraticCurveTo(r+s,i,r+s,i+n,r+s,i+n);e.lineTo(r+s,i+o-n);e.quadraticCurveTo(r+s,i+o,r+s-t,i+o,r+s-t,i+o);e.lineTo(r+t,i+o);e.quadraticCurveTo(r,i+o,r,i+o-n,r,i+o-n);e.lineTo(r,i+n);e.quadraticCurveTo(r,i,r+t,i,r+t,i);e.closePath();if(this.fill){e.fill()}this._removeShadow(e);if(this.strokeDashArray){this._renderDashedStroke(e)}else if(this.stroke){e.stroke()}},_renderDashedStroke:function(e){function u(u,a){var f=0,l=0,c=(a?i.height:i.width)+s*2;while(f<c){var h=i.strokeDashArray[t++];f+=h;if(f>c){l=f-c}if(u){n+=h*u-(l*u||0)}else{r+=h*a-(l*a||0)}e[1&t?"moveTo":"lineTo"](n,r);if(t>=o){t=0}}}if(1&this.strokeDashArray.length){this.strokeDashArray.push.apply(this.strokeDashArray,this.strokeDashArray)}var t=0,n=-this.width/2,r=-this.height/2,i=this,s=this.padding,o=this.strokeDashArray.length;e.save();e.beginPath();u(1,0);u(0,1);u(-1,0);u(0,-1);e.stroke();e.closePath();e.restore()},_normalizeLeftTopProperties:function(e){if("left"in e){this.set("left",e.left+this.getWidth()/2)}this.set("x",e.left||0);if("top"in e){this.set("top",e.top+this.getHeight()/2)}this.set("y",e.top||0);return this},complexity:function(){return 1},toObject:function(e){return n(this.callSuper("toObject",e),{rx:this.get("rx")||0,ry:this.get("ry")||0})},toSVG:function(){var e=[];if(this.fill&&this.fill.toLive){e.push(this.fill.toSVG(this,false))}if(this.stroke&&this.stroke.toLive){e.push(this.stroke.toSVG(this,false))}e.push("<rect ",'x="',-1*this.width/2,'" y="',-1*this.height/2,'" rx="',this.get("rx"),'" ry="',this.get("ry"),'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>');return e.join("")}});t.Rect.ATTRIBUTE_NAMES="x y width height rx ry fill fill-opacity opacity stroke stroke-width transform".split(" ");t.Rect.fromElement=function(e,i){if(!e){return null}var s=t.parseAttributes(e,t.Rect.ATTRIBUTE_NAMES);s=r(s);var o=new t.Rect(n(i?t.util.object.clone(i):{},s));o._normalizeLeftTopProperties(s);return o};t.Rect.fromObject=function(e){return new t.Rect(e)}})(typeof exports!=="undefined"?exports:this);(function(e){"use strict";var t=e.fabric||(e.fabric={}),n=t.util.toFixed;if(t.Polyline){t.warn("fabric.Polyline is already defined");return}t.Polyline=t.util.createClass(t.Object,{type:"polyline",initialize:function(e,t,n){t=t||{};this.set("points",e);this.callSuper("initialize",t);this._calcDimensions(n)},_calcDimensions:function(e){return t.Polygon.prototype._calcDimensions.call(this,e)},toObject:function(e){return t.Polygon.prototype.toObject.call(this,e)},toSVG:function(){var e=[],t=[];for(var r=0,i=this.points.length;r<i;r++){e.push(n(this.points[r].x,2),",",n(this.points[r].y,2)," ")}if(this.fill&&this.fill.toLive){t.push(this.fill.toSVG(this,false))}if(this.stroke&&this.stroke.toLive){t.push(this.stroke.toSVG(this,false))}t.push("<polyline ",'points="',e.join(""),'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>');return t.join("")},_render:function(e){var t;e.beginPath();e.moveTo(this.points[0].x,this.points[0].y);for(var n=0,r=this.points.length;n<r;n++){t=this.points[n];e.lineTo(t.x,t.y)}if(this.fill){e.fill()}this._removeShadow(e);if(this.stroke){e.stroke()}},complexity:function(){return this.get("points").length}});t.Polyline.ATTRIBUTE_NAMES="fill fill-opacity opacity stroke stroke-width transform".split(" ");t.Polyline.fromElement=function(e,n){if(!e){return null}n||(n={});var r=t.parsePointsAttribute(e.getAttribute("points")),i=t.parseAttributes(e,t.Polyline.ATTRIBUTE_NAMES);for(var s=0,o=r.length;s<o;s++){r[s].x-=n.width/2||0;r[s].y-=n.height/2||0}return new t.Polyline(r,t.util.object.extend(i,n),true)};t.Polyline.fromObject=function(e){var n=e.points;return new t.Polyline(n,e,true)}})(typeof exports!=="undefined"?exports:this);(function(e){"use strict";var t=e.fabric||(e.fabric={}),n=t.util.object.extend,r=t.util.array.min,i=t.util.array.max,s=t.util.toFixed;if(t.Polygon){t.warn("fabric.Polygon is already defined");return}t.Polygon=t.util.createClass(t.Object,{type:"polygon",initialize:function(e,t,n){t=t||{};this.points=e;this.callSuper("initialize",t);this._calcDimensions(n)},_calcDimensions:function(e){var t=this.points,n=r(t,"x"),s=r(t,"y"),o=i(t,"x"),u=i(t,"y");this.width=o-n||1;this.height=u-s||1;this.minX=n;this.minY=s;if(e)return;var a=this.width/2,f=this.height/2;this.points.forEach(function(e){e.x-=a;e.y-=f},this)},toObject:function(e){return n(this.callSuper("toObject",e),{points:this.points.concat()})},toSVG:function(){var e=[],t=[];for(var n=0,r=this.points.length;n<r;n++){e.push(s(this.points[n].x,2),",",s(this.points[n].y,2)," ")}if(this.fill&&this.fill.toLive){t.push(this.fill.toSVG(this,false))}if(this.stroke&&this.stroke.toLive){t.push(this.stroke.toSVG(this,false))}t.push("<polygon ",'points="',e.join(""),'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>');return t.join("")},_render:function(e){var t;e.beginPath();e.moveTo(this.points[0].x,this.points[0].y);for(var n=0,r=this.points.length;n<r;n++){t=this.points[n];e.lineTo(t.x,t.y)}if(this.fill){e.fill()}this._removeShadow(e);if(this.stroke){e.closePath();e.stroke()}},complexity:function(){return this.points.length}});t.Polygon.ATTRIBUTE_NAMES="fill fill-opacity opacity stroke stroke-width transform".split(" ");t.Polygon.fromElement=function(e,r){if(!e){return null}r||(r={});var i=t.parsePointsAttribute(e.getAttribute("points")),s=t.parseAttributes(e,t.Polygon.ATTRIBUTE_NAMES);for(var o=0,u=i.length;o<u;o++){i[o].x-=r.width/2||0;i[o].y-=r.height/2||0}return new t.Polygon(i,n(s,r),true)};t.Polygon.fromObject=function(e){return new t.Polygon(e.points,e,true)}})(typeof exports!=="undefined"?exports:this);(function(e){function n(e,t,n,r){var i=r[0];var s=r[1];var o=r[2];var f=r[3];var l=r[4];var c=r[5];var h=r[6];var p=u(c,h,i,s,f,l,o,t,n);for(var d=0;d<p.length;d++){var v=a.apply(this,p[d]);e.bezierCurveTo.apply(e,v)}}function u(e,t,n,i,u,a,f,l,c){o=s.call(arguments);if(r[o]){return r[o]}var h=f*(Math.PI/180);var p=Math.sin(h);var d=Math.cos(h);n=Math.abs(n);i=Math.abs(i);var v=d*(l-e)*.5+p*(c-t)*.5;var m=d*(c-t)*.5-p*(l-e)*.5;var g=v*v/(n*n)+m*m/(i*i);if(g>1){g=Math.sqrt(g);n*=g;i*=g}var y=d/n;var b=p/n;var w=-p/i;var E=d/i;var S=y*l+b*c;var x=w*l+E*c;var T=y*e+b*t;var N=w*e+E*t;var C=(T-S)*(T-S)+(N-x)*(N-x);var k=1/C-.25;if(k<0)k=0;var L=Math.sqrt(k);if(a===u)L=-L;var A=.5*(S+T)-L*(N-x);var O=.5*(x+N)+L*(T-S);var M=Math.atan2(x-O,S-A);var _=Math.atan2(N-O,T-A);var D=_-M;if(D<0&&a===1){D+=2*Math.PI}else if(D>0&&a===0){D-=2*Math.PI}var P=Math.ceil(Math.abs(D/(Math.PI*.5+.001)));var H=[];for(var B=0;B<P;B++){var j=M+B*D/P;var F=M+(B+1)*D/P;H[B]=[A,O,j,F,n,i,p,d]}r[o]=H;return H}function a(e,t,n,r,u,a,f,l){o=s.call(arguments);if(i[o]){return i[o]}var c=l*u;var h=-f*a;var p=f*u;var d=l*a;var v=.5*(r-n);var m=8/3*Math.sin(v*.5)*Math.sin(v*.5)/Math.sin(v);var g=e+Math.cos(n)-m*Math.sin(n);var y=t+Math.sin(n)+m*Math.cos(n);var b=e+Math.cos(r);var w=t+Math.sin(r);var E=b+m*Math.sin(r);var S=w-m*Math.cos(r);i[o]=[c*g+h*y,p*g+d*y,c*E+h*S,p*E+d*S,c*b+h*w,p*b+d*w];return i[o]}function d(e){if(e[0]==="H"){return e[1]}return e[e.length-2]}function v(e){if(e[0]==="V"){return e[1]}return e[e.length-1]}var t={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7};var r={},i={},s=Array.prototype.join,o;"use strict";var f=e.fabric||(e.fabric={}),l=f.util.array.min,c=f.util.array.max,h=f.util.object.extend,p=Object.prototype.toString;if(f.Path){f.warn("fabric.Path is already defined");return}f.Path=f.util.createClass(f.Object,{type:"path",initialize:function(e,t){t=t||{};this.setOptions(t);if(!e){throw new Error("`path` argument is required")}var n=p.call(e)==="[object Array]";this.path=n?e:e.match&&e.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi);if(!this.path)return;if(!n){this.path=this._parsePath()}this._initializePath(t);if(t.sourcePath){this.setSourcePath(t.sourcePath)}},_initializePath:function(e){var t="width"in e,n="height"in e,r="left"in e,i="top"in e;if(!t||!n){h(this,this._parseDimensions());if(t){this.width=e.width}if(n){this.height=e.height}}else{if(!i){this.top=this.height/2}if(!r){this.left=this.width/2}}this.pathOffset=this.pathOffset||this._calculatePathOffset(i||r)},_calculatePathOffset:function(e){return{x:e?0:this.left-this.width/2,y:e?0:this.top-this.height/2}},_render:function(e){var t,r=null,i=0,s=0,o=0,u=0,a,f,l,c,h=-(this.width/2+this.pathOffset.x),p=-(this.height/2+this.pathOffset.y);for(var d=0,v=this.path.length;d<v;++d){t=this.path[d];switch(t[0]){case"l":i+=t[1];s+=t[2];e.lineTo(i+h,s+p);break;case"L":i=t[1];s=t[2];e.lineTo(i+h,s+p);break;case"h":i+=t[1];e.lineTo(i+h,s+p);break;case"H":i=t[1];e.lineTo(i+h,s+p);break;case"v":s+=t[1];e.lineTo(i+h,s+p);break;case"V":s=t[1];e.lineTo(i+h,s+p);break;case"m":i+=t[1];s+=t[2];e[r&&(r[0]==="m"||r[0]==="M")?"lineTo":"moveTo"](i+h,s+p);break;case"M":i=t[1];s=t[2];e[r&&(r[0]==="m"||r[0]==="M")?"lineTo":"moveTo"](i+h,s+p);break;case"c":a=i+t[5];f=s+t[6];o=i+t[3];u=s+t[4];e.bezierCurveTo(i+t[1]+h,s+t[2]+p,o+h,u+p,a+h,f+p);i=a;s=f;break;case"C":i=t[5];s=t[6];o=t[3];u=t[4];e.bezierCurveTo(t[1]+h,t[2]+p,o+h,u+p,i+h,s+p);break;case"s":a=i+t[3];f=s+t[4];o=o?2*i-o:i;u=u?2*s-u:s;e.bezierCurveTo(o+h,u+p,i+t[1]+h,s+t[2]+p,a+h,f+p);o=i+t[1];u=s+t[2];i=a;s=f;break;case"S":a=t[3];f=t[4];o=2*i-o;u=2*s-u;e.bezierCurveTo(o+h,u+p,t[1]+h,t[2]+p,a+h,f+p);i=a;s=f;o=t[1];u=t[2];break;case"q":a=i+t[3];f=s+t[4];o=i+t[1];u=s+t[2];e.quadraticCurveTo(o+h,u+p,a+h,f+p);i=a;s=f;break;case"Q":a=t[3];f=t[4];e.quadraticCurveTo(t[1]+h,t[2]+p,a+h,f+p);i=a;s=f;o=t[1];u=t[2];break;case"t":a=i+t[1];f=s+t[2];if(r[0].match(/[QqTt]/)===null){o=i;u=s}else if(r[0]==="t"){o=2*i-l;u=2*s-c}else if(r[0]==="q"){o=2*i-o;u=2*s-u}l=o;c=u;e.quadraticCurveTo(o+h,u+p,a+h,f+p);i=a;s=f;o=i+t[1];u=s+t[2];break;case"T":a=t[1];f=t[2];o=2*i-o;u=2*s-u;e.quadraticCurveTo(o+h,u+p,a+h,f+p);i=a;s=f;break;case"a":n(e,i+h,s+p,[t[1],t[2],t[3],t[4],t[5],t[6]+i+h,t[7]+s+p]);i+=t[6];s+=t[7];break;case"A":n(e,i+h,s+p,[t[1],t[2],t[3],t[4],t[5],t[6]+h,t[7]+p]);i=t[6];s=t[7];break;case"z":case"Z":e.closePath();break}r=t}},render:function(e,t){if(!this.visible)return;e.save();var n=this.transformMatrix;if(n){e.transform(n[0],n[1],n[2],n[3],n[4],n[5])}if(!t){this.transform(e)}if(this.overlayFill){e.fillStyle=this.overlayFill}else if(this.fill){e.fillStyle=this.fill.toLive?this.fill.toLive(e):this.fill}if(this.stroke){e.strokeStyle=this.stroke.toLive?this.stroke.toLive(e):this.stroke}this._setShadow(e);this.clipTo&&f.util.clipContext(this,e);e.beginPath();this._render(e);if(this.fill){e.fill()}this.clipTo&&e.restore();if(this.shadow&&!this.shadow.affectStroke){this._removeShadow(e)}if(this.stroke){e.strokeStyle=this.stroke;e.lineWidth=this.strokeWidth;e.lineCap=e.lineJoin="round";e.stroke()}this._removeShadow(e);if(!t&&this.active){this.drawBorders(e);this.drawControls(e)}e.restore()},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(e){var t=h(this.callSuper("toObject",e),{path:this.path});if(this.sourcePath){t.sourcePath=this.sourcePath}if(this.transformMatrix){t.transformMatrix=this.transformMatrix}return t},toDatalessObject:function(e){var t=this.toObject(e);if(this.sourcePath){t.path=this.sourcePath}delete t.sourcePath;return t},toSVG:function(){var e=[],t=[];for(var n=0,r=this.path.length;n<r;n++){e.push(this.path[n].join(" "))}var i=e.join(" ");if(this.fill&&this.fill.toLive){t.push(this.fill.toSVG(this,true))}if(this.stroke&&this.stroke.toLive){t.push(this.stroke.toSVG(this,true))}t.push('<g transform="',this.group?"":this.getSvgTransform(),'">',"<path ",'d="',i,'" style="',this.getSvgStyles(),'" transform="translate(',-this.width/2," ",-this.height/2,")",'" stroke-linecap="round" ',"/>","</g>");return t.join("")},complexity:function(){return this.path.length},_parsePath:function(){var e=[],n,r,i;for(var s=0,o,u=this.path.length;s<u;s++){n=this.path[s];r=n.slice(1).trim().replace(/(\d)-/g,"$1###-").split(/\s|,|###/);o=[n.charAt(0)];for(var a=0,f=r.length;a<f;a++){i=parseFloat(r[a]);if(!isNaN(i)){o.push(i)}}var l=o[0].toLowerCase(),c=t[l];if(o.length-1>c){for(var h=1,p=o.length;h<p;h+=c){e.push([o[0]].concat(o.slice(h,h+c)))}}else{e.push(o)}}return e},_parseDimensions:function(){var e=[],t=[],n,r,i=false,s,o;this.path.forEach(function(u,a){if(u[0]!=="H"){n=a===0?d(u):d(this.path[a-1])}if(u[0]!=="V"){r=a===0?v(u):v(this.path[a-1])}if(u[0]===u[0].toLowerCase()){i=true}s=i?n+d(u):u[0]==="V"?n:d(u);o=i?r+v(u):u[0]==="H"?r:v(u);var f=parseInt(s,10);if(!isNaN(f))e.push(f);f=parseInt(o,10);if(!isNaN(f))t.push(f)},this);var u=l(e),a=l(t),f=c(e),h=c(t),p=f-u,m=h-a;var g={top:a+m/2,left:u+p/2,bottom:c(t)-m,right:c(e)-p};g.width=p;g.height=m;return g}});f.Path.fromObject=function(e){return new f.Path(e.path,e)};f.Path.ATTRIBUTE_NAMES="d fill fill-opacity opacity fill-rule stroke stroke-width transform".split(" ");f.Path.fromElement=function(e,t){var n=f.parseAttributes(e,f.Path.ATTRIBUTE_NAMES);return new f.Path(n.d,h(n,t))}})(typeof exports!=="undefined"?exports:this);(function(e){"use strict";function u(e){for(var n=0,r=e.length;n<r;n++){if(!(e[n]instanceof t.Object)){var i=s(o(e[n].type));e[n]=t[i].fromObject(e[n])}}return e}var t=e.fabric||(e.fabric={}),n=t.util.object.extend,r=t.util.array.invoke,i=t.Object.prototype.toObject,s=t.util.string.camelize,o=t.util.string.capitalize;if(t.PathGroup){t.warn("fabric.PathGroup is already defined");return}t.PathGroup=t.util.createClass(t.Path,{type:"path-group",fill:"",initialize:function(e,t){t=t||{};this.paths=e||[];for(var n=this.paths.length;n--;){this.paths[n].group=this}this.setOptions(t);this.setCoords();if(t.sourcePath){this.setSourcePath(t.sourcePath)}},render:function(e){if(!this.visible)return;e.save();var n=this.transformMatrix;if(n){e.transform(n[0],n[1],n[2],n[3],n[4],n[5])}this.transform(e);this._setShadow(e);this.clipTo&&t.util.clipContext(this,e);for(var r=0,i=this.paths.length;r<i;++r){this.paths[r].render(e,true)}this.clipTo&&e.restore();this._removeShadow(e);if(this.active){this.drawBorders(e);this.drawControls(e)}e.restore()},_set:function(e,t){if((e==="fill"||e==="overlayFill")&&t&&this.isSameColor()){var n=this.paths.length;while(n--){this.paths[n]._set(e,t)}}return this.callSuper("_set",e,t)},toObject:function(e){return n(i.call(this,e),{paths:r(this.getObjects(),"toObject",e),sourcePath:this.sourcePath})},toDatalessObject:function(e){var t=this.toObject(e);if(this.sourcePath){t.paths=this.sourcePath}return t},toSVG:function(){var e=this.getObjects();var t=["<g ",'style="',this.getSvgStyles(),'" ','transform="',this.getSvgTransform(),'" ',">"];for(var n=0,r=e.length;n<r;n++){t.push(e[n].toSVG())}t.push("</g>");return t.join("")},toString:function(){return"#<fabric.PathGroup ("+this.complexity()+"): { top: "+this.top+", left: "+this.left+" }>"},isSameColor:function(){var e=this.getObjects()[0].get("fill");return this.getObjects().every(function(t){return t.get("fill")===e})},complexity:function(){return this.paths.reduce(function(e,t){return e+(t&&t.complexity?t.complexity():0)},0)},toGrayscale:function(){var e=this.paths.length;while(e--){this.paths[e].toGrayscale()}return this},getObjects:function(){return this.paths}});t.PathGroup.fromObject=function(e){var n=u(e.paths);return new t.PathGroup(n,e)}})(typeof exports!=="undefined"?exports:this);(function(e){"use strict";var t=e.fabric||(e.fabric={}),n=t.util.object.extend,r=t.util.array.min,i=t.util.array.max,s=t.util.array.invoke;if(t.Group){return}var o={lockMovementX:true,lockMovementY:true,lockRotation:true,lockScalingX:true,lockScalingY:true,lockUniScaling:true};t.Group=t.util.createClass(t.Object,t.Collection,{type:"group",initialize:function(e,t){t=t||{};this._objects=e||[];for(var r=this._objects.length;r--;){this._objects[r].group=this}this.originalState={};this.callSuper("initialize");this._calcBounds();this._updateObjectsCoords();if(t){n(this,t)}this._setOpacityIfSame();this.setCoords(true);this.saveCoords()},_updateObjectsCoords:function(){var e=this.left,t=this.top;this.forEachObject(function(n){var r=n.get("left"),i=n.get("top");n.set("originalLeft",r);n.set("originalTop",i);n.set("left",r-e);n.set("top",i-t);n.setCoords();n.__origHasControls=n.hasControls;n.hasControls=false},this)},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},getObjects:function(){return this._objects},addWithUpdate:function(e){this._restoreObjectsState();this._objects.push(e);e.group=this;this.forEachObject(function(e){e.set("active",true);e.group=this},this);this._calcBounds();this._updateObjectsCoords();return this},removeWithUpdate:function(e){this._restoreObjectsState();this.forEachObject(function(e){e.set("active",true);e.group=this},this);this.remove(e);this._calcBounds();this._updateObjectsCoords();return this},_onObjectAdded:function(e){e.group=this},_onObjectRemoved:function(e){delete e.group;e.set("active",false)},delegatedProperties:{fill:true,opacity:true,fontFamily:true,fontWeight:true,fontSize:true,fontStyle:true,lineHeight:true,textDecoration:true,textShadow:true,textAlign:true,backgroundColor:true},_set:function(e,t){if(e in this.delegatedProperties){var n=this._objects.length;this[e]=t;while(n--){this._objects[n].set(e,t)}}else{this[e]=t}},toObject:function(e){return n(this.callSuper("toObject",e),{objects:s(this._objects,"toObject",e)})},render:function(e,n){if(!this.visible)return;e.save();this.transform(e);var r=Math.max(this.scaleX,this.scaleY);this.clipTo&&t.util.clipContext(this,e);for(var i=0,s=this._objects.length;i<s;i++){var o=this._objects[i],u=o.borderScaleFactor,a=o.hasRotatingPoint;if(!o.visible)continue;o.borderScaleFactor=r;o.hasRotatingPoint=false;o.render(e);o.borderScaleFactor=u;o.hasRotatingPoint=a}this.clipTo&&e.restore();if(!n&&this.active){this.drawBorders(e);this.drawControls(e)}e.restore();this.setCoords()},_restoreObjectsState:function(){this._objects.forEach(this._restoreObjectState,this);return this},_restoreObjectState:function(e){var t=this.get("left"),n=this.get("top"),r=this.getAngle()*(Math.PI/180),i=Math.cos(r)*e.get("top")+Math.sin(r)*e.get("left"),s=-Math.sin(r)*e.get("top")+Math.cos(r)*e.get("left");e.setAngle(e.getAngle()+this.getAngle());e.set("left",t+s*this.get("scaleX"));e.set("top",n+i*this.get("scaleY"));e.set("scaleX",e.get("scaleX")*this.get("scaleX"));e.set("scaleY",e.get("scaleY")*this.get("scaleY"));e.setCoords();e.hasControls=e.__origHasControls;delete e.__origHasControls;e.set("active",false);e.setCoords();delete e.group;return this},destroy:function(){return this._restoreObjectsState()},saveCoords:function(){this._originalLeft=this.get("left");this._originalTop=this.get("top");return this},hasMoved:function(){return this._originalLeft!==this.get("left")||this._originalTop!==this.get("top")},setObjectsCoords:function(){this.forEachObject(function(e){e.setCoords()});return this},_setOpacityIfSame:function(){var e=this.getObjects(),t=e[0]?e[0].get("opacity"):1;var n=e.every(function(e){return e.get("opacity")===t});if(n){this.opacity=t}},_calcBounds:function(){var e=[],t=[],n,s,o,u,a,f,l,c=0,h=this._objects.length;for(;c<h;++c){a=this._objects[c];a.setCoords();for(var p in a.oCoords){e.push(a.oCoords[p].x);t.push(a.oCoords[p].y)}}n=r(e);o=i(e);s=r(t);u=i(t);f=o-n||0;l=u-s||0;this.width=f;this.height=l;this.left=n+f/2||0;this.top=s+l/2||0},containsPoint:function(e){var t=this.get("width")/2,n=this.get("height")/2,r=this.get("left"),i=this.get("top");return r-t<e.x&&r+t>e.x&&i-n<e.y&&i+n>e.y},toSVG:function(){var e=[];for(var t=this._objects.length;t--;){e.push(this._objects[t].toSVG())}return'<g transform="'+this.getSvgTransform()+'">'+e.join("")+"</g>"},get:function(e){if(e in o){if(this[e]){return this[e]}else{for(var t=0,n=this._objects.length;t<n;t++){if(this._objects[t][e]){return true}}return false}}else{if(e in this.delegatedProperties){return this._objects[0]&&this._objects[0].get(e)}return this[e]}}});t.Group.fromObject=function(e,n){t.util.enlivenObjects(e.objects,function(r){delete e.objects;n&&n(new t.Group(r,e))})};t.Group.async=true})(typeof exports!=="undefined"?exports:this);(function(e){"use strict";var t=fabric.util.object.extend;if(!e.fabric){e.fabric={}}if(e.fabric.Image){fabric.warn("fabric.Image is already defined.");return}fabric.Image=fabric.util.createClass(fabric.Object,{type:"image",initialize:function(e,t){t||(t={});this.callSuper("initialize",t);this._initElement(e);this._originalImage=this.getElement();this._initConfig(t);this.filters=[];if(t.filters){this.filters=t.filters;this.applyFilters()}},getElement:function(){return this._element},setElement:function(e){this._element=e;this._initConfig();return this},getOriginalSize:function(){var e=this.getElement();return{width:e.width,height:e.height}},render:function(e,t){if(!this.visible)return;e.save();var n=this.transformMatrix;var r=this.group&&this.group.type!=="group";if(r){e.translate(-this.group.width/2+this.width/2,-this.group.height/2+this.height/2)}if(n){e.transform(n[0],n[1],n[2],n[3],n[4],n[5])}if(!t){this.transform(e)}this._setShadow(e);this.clipTo&&fabric.util.clipContext(this,e);this._render(e);this.clipTo&&e.restore();this._removeShadow(e);if(this.stroke){this._stroke(e)}if(this.active&&!t){this.drawBorders(e);this.drawControls(e)}e.restore()},_stroke:function(e){e.save();e.lineWidth=this.strokeWidth;e.strokeStyle=this.stroke;e.strokeRect(-this.width/2,-this.height/2,this.width,this.height);e.restore()},toObject:function(e){return t(this.callSuper("toObject",e),{src:this._originalImage.src||this._originalImage._src,filters:this.filters.concat()})},toSVG:function(){return'<g transform="'+this.getSvgTransform()+'">'+'<image xlink:href="'+this.getSvgSrc()+'" '+'style="'+this.getSvgStyles()+'" '+'transform="translate('+ -this.width/2+" "+ -this.height/2+')" '+'width="'+this.width+'" '+'height="'+this.height+'"'+"></image>"+"</g>"},getSrc:function(){return this.getElement().src||this.getElement()._src},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},clone:function(e,t){this.constructor.fromObject(this.toObject(t),e)},applyFilters:function(e){if(this.filters.length===0){this.setElement(this._originalImage);e&&e();return}var t=typeof Buffer!=="undefined"&&typeof window==="undefined",n=this._originalImage,r=fabric.util.createCanvasElement(),i=t?new(require("canvas").Image):fabric.document.createElement("img"),s=this;r.width=n.width;r.height=n.height;r.getContext("2d").drawImage(n,0,0,n.width,n.height);this.filters.forEach(function(e){e&&e.applyTo(r)});i.onload=function(){s._element=i;e&&e();i.onload=r=n=null};i.width=n.width;i.height=n.height;if(t){var o=r.toDataURL("image/png").substring(22);i.src=new Buffer(o,"base64");s._element=i;e&&e()}else{i.src=r.toDataURL("image/png")}return this},_render:function(e){e.drawImage(this._element,-this.width/2,-this.height/2,this.width,this.height)},_resetWidthHeight:function(){var e=this.getElement();this.set("width",e.width);this.set("height",e.height)},_initElement:function(e){this.setElement(fabric.util.getById(e));fabric.util.addClass(this.getElement(),fabric.Image.CSS_CANVAS)},_initConfig:function(e){e||(e={});this.setOptions(e);this._setWidthHeight(e)},_initFilters:function(e){if(e.filters&&e.filters.length){this.filters=e.filters.map(function(e){return e&&fabric.Image.filters[e.type].fromObject(e)})}},_setWidthHeight:function(e){this.width="width"in e?e.width:this.getElement().width||0;this.height="height"in e?e.height:this.getElement().height||0},complexity:function(){return 1}});fabric.Image.CSS_CANVAS="canvas-img";fabric.Image.prototype.getSvgSrc=fabric.Image.prototype.getSrc;fabric.Image.fromObject=function(e,t){var n=fabric.document.createElement("img"),r=e.src;if(e.width){n.width=e.width}if(e.height){n.height=e.height}n.onload=function(){fabric.Image.prototype._initFilters.call(e,e);var r=new fabric.Image(n,e);t&&t(r);n=n.onload=n.onerror=null};n.onerror=function(){fabric.log("Error loading "+n.src);t&&t(null,true);n=n.onload=n.onerror=null};n.src=r};fabric.Image.fromURL=function(e,t,n){fabric.util.loadImage(e,function(e){t(new fabric.Image(e,n))})};fabric.Image.ATTRIBUTE_NAMES="x y width height fill fill-opacity opacity stroke stroke-width transform xlink:href".split(" ");fabric.Image.fromElement=function(e,n,r){var i=fabric.parseAttributes(e,fabric.Image.ATTRIBUTE_NAMES);fabric.Image.fromURL(i["xlink:href"],n,t(r?fabric.util.object.clone(r):{},i))};fabric.Image.async=true})(typeof exports!=="undefined"?exports:this);fabric.util.object.extend(fabric.Object.prototype,{_getAngleValueForStraighten:function(){var e=this.getAngle()%360;if(e>0){return Math.round((e-1)/90)*90}return Math.round(e/90)*90},straighten:function(){this.setAngle(this._getAngleValueForStraighten());return this},fxStraighten:function(e){e=e||{};var t=function(){},n=e.onComplete||t,r=e.onChange||t,i=this;fabric.util.animate({startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(e){i.setAngle(e);r()},onComplete:function(){i.setCoords();n()},onStart:function(){i.set("active",false)}});return this}});fabric.util.object.extend(fabric.StaticCanvas.prototype,{straightenObject:function(e){e.straighten();this.renderAll();return this},fxStraightenObject:function(e){e.fxStraighten({onChange:this.renderAll.bind(this)});return this}});fabric.Image.filters={};fabric.Image.filters.Grayscale=fabric.util.createClass({type:"Grayscale",applyTo:function(e){var t=e.getContext("2d"),n=t.getImageData(0,0,e.width,e.height),r=n.data,i=n.width,s=n.height,o,u,a,f;for(a=0;a<i;a++){for(f=0;f<s;f++){o=a*4*s+f*4;u=(r[o]+r[o+1]+r[o+2])/3;r[o]=u;r[o+1]=u;r[o+2]=u}}t.putImageData(n,0,0)},toJSON:function(){return{type:this.type}}});fabric.Image.filters.Grayscale.fromObject=function(){return new fabric.Image.filters.Grayscale};fabric.Image.filters.RemoveWhite=fabric.util.createClass({type:"RemoveWhite",initialize:function(e){e||(e={});this.threshold=e.threshold||30;this.distance=e.distance||20},applyTo:function(e){var t=e.getContext("2d"),n=t.getImageData(0,0,e.width,e.height),r=n.data,i=this.threshold,s=this.distance,o=255-i,u=Math.abs,a,f,l;for(var c=0,h=r.length;c<h;c+=4){a=r[c];f=r[c+1];l=r[c+2];if(a>o&&f>o&&l>o&&u(a-f)<s&&u(a-l)<s&&u(f-l)<s){r[c+3]=1}}t.putImageData(n,0,0)},toJSON:function(){return{type:this.type,threshold:this.threshold,distance:this.distance}}});fabric.Image.filters.RemoveWhite.fromObject=function(e){return new fabric.Image.filters.RemoveWhite(e)};fabric.Image.filters.Invert=fabric.util.createClass({type:"Invert",applyTo:function(e){var t=e.getContext("2d"),n=t.getImageData(0,0,e.width,e.height),r=n.data,i=r.length,s;for(s=0;s<i;s+=4){r[s]=255-r[s];r[s+1]=255-r[s+1];r[s+2]=255-r[s+2]}t.putImageData(n,0,0)},toJSON:function(){return{type:this.type}}});fabric.Image.filters.Invert.fromObject=function(){return new fabric.Image.filters.Invert};fabric.Image.filters.Sepia=fabric.util.createClass({type:"Sepia",applyTo:function(e){var t=e.getContext("2d"),n=t.getImageData(0,0,e.width,e.height),r=n.data,i=r.length,s,o;for(s=0;s<i;s+=4){o=.3*r[s]+.59*r[s+1]+.11*r[s+2];r[s]=o+100;r[s+1]=o+50;r[s+2]=o+255}t.putImageData(n,0,0)},toJSON:function(){return{type:this.type}}});fabric.Image.filters.Sepia.fromObject=function(){return new fabric.Image.filters.Sepia};fabric.Image.filters.Sepia2=fabric.util.createClass({type:"Sepia2",applyTo:function(e){var t=e.getContext("2d"),n=t.getImageData(0,0,e.width,e.height),r=n.data,i=r.length,s,o,u,a;for(s=0;s<i;s+=4){o=r[s];u=r[s+1];a=r[s+2];r[s]=(o*.393+u*.769+a*.189)/1.351;r[s+1]=(o*.349+u*.686+a*.168)/1.203;r[s+2]=(o*.272+u*.534+a*.131)/2.14}t.putImageData(n,0,0)},toJSON:function(){return{type:this.type}}});fabric.Image.filters.Sepia2.fromObject=function(){return new fabric.Image.filters.Sepia2};fabric.Image.filters.Brightness=fabric.util.createClass({type:"Brightness",initialize:function(e){e||(e={});this.brightness=e.brightness||100},applyTo:function(e){var t=e.getContext("2d"),n=t.getImageData(0,0,e.width,e.height),r=n.data,i=this.brightness;for(var s=0,o=r.length;s<o;s+=4){r[s]+=i;r[s+1]+=i;r[s+2]+=i}t.putImageData(n,0,0)},toJSON:function(){return{type:this.type,brightness:this.brightness}}});fabric.Image.filters.Brightness.fromObject=function(e){return new fabric.Image.filters.Brightness(e)};fabric.Image.filters.Noise=fabric.util.createClass({type:"Noise",initialize:function(e){e||(e={});this.noise=e.noise||100},applyTo:function(e){var t=e.getContext("2d"),n=t.getImageData(0,0,e.width,e.height),r=n.data,i=this.noise,s;for(var o=0,u=r.length;o<u;o+=4){s=(.5-Math.random())*i;r[o]+=s;r[o+1]+=s;r[o+2]+=s}t.putImageData(n,0,0)},toJSON:function(){return{type:this.type,noise:this.noise}}});fabric.Image.filters.Noise.fromObject=function(e){return new fabric.Image.filters.Noise(e)};fabric.Image.filters.GradientTransparency=fabric.util.createClass({type:"GradientTransparency",initialize:function(e){e||(e={});this.threshold=e.threshold||100},applyTo:function(e){var t=e.getContext("2d"),n=t.getImageData(0,0,e.width,e.height),r=n.data,i=this.threshold,s=r.length;for(var o=0,u=r.length;o<u;o+=4){r[o+3]=i+255*(s-o)/s}t.putImageData(n,0,0)},toJSON:function(){return{type:this.type,threshold:this.threshold}}});fabric.Image.filters.GradientTransparency.fromObject=function(e){return new fabric.Image.filters.GradientTransparency(e)};fabric.Image.filters.Tint=fabric.util.createClass({type:"Tint",initialize:function(e){e||(e={});this.color=e.color||0},applyTo:function(e){var t=e.getContext("2d"),n=t.getImageData(0,0,e.width,e.height),r=n.data,i=r.length,s,o;var u=parseInt(this.color,10).toString(16);var a=parseInt("0x"+u.substr(0,2),16);var f=parseInt("0x"+u.substr(2,2),16);var l=parseInt("0x"+u.substr(4,2),16);for(s=0;s<i;s+=4){o=r[s+3];if(o>0){r[s]=a;r[s+1]=f;r[s+2]=l}}t.putImageData(n,0,0)},toJSON:function(){return{type:this.type,color:this.color}}});fabric.Image.filters.Tint.fromObject=function(e){return new fabric.Image.filters.Tint(e)};fabric.Image.filters.Convolute=fabric.util.createClass({type:"Convolute",initialize:function(e){e||(e={});this.opaque=e.opaque;this.matrix=e.matrix||[0,0,0,0,1,0,0,0,0];var t=fabric.util.createCanvasElement();this.tmpCtx=t.getContext("2d")},_createImageData:function(e,t){return this.tmpCtx.createImageData(e,t)},applyTo:function(e){var t=this.matrix;var n=e.getContext("2d");var r=n.getImageData(0,0,e.width,e.height);var i=Math.round(Math.sqrt(t.length));var s=Math.floor(i/2);var o=r.data;var u=r.width;var a=r.height;var f=u;var l=a;var c=this._createImageData(f,l);var h=c.data;var p=this.opaque?1:0;for(var d=0;d<l;d++){for(var v=0;v<f;v++){var m=d;var g=v;var y=(d*f+v)*4;var b=0,w=0,E=0,S=0;for(var x=0;x<i;x++){for(var T=0;T<i;T++){var N=m+x-s;var C=g+T-s;if(N>=0&&N<a&&C>=0&&C<u){var k=(N*u+C)*4;var L=t[x*i+T];b+=o[k]*L;w+=o[k+1]*L;E+=o[k+2]*L;S+=o[k+3]*L}}}h[y]=b;h[y+1]=w;h[y+2]=E;h[y+3]=S+p*(255-S)}}n.putImageData(c,0,0)},toJSON:function(){return{type:this.type,matrix:this.matrix}}});fabric.Image.filters.Convolute.fromObject=function(e){return new fabric.Image.filters.Convolute(e)};fabric.Image.filters.Pixelate=fabric.util.createClass({type:"Pixelate",initialize:function(e){e||(e={});this.blocksize=e.blocksize||4},applyTo:function(e){var t=e.getContext("2d"),n=t.getImageData(0,0,e.width,e.height),r=n.data,i=n.height,s=n.width,o,u,a,f,l,c,h;for(u=0;u<i;u+=this.blocksize){for(a=0;a<s;a+=this.blocksize){o=u*4*s+a*4;f=r[o];l=r[o+1];c=r[o+2];h=r[o+3];for(var p=u,d=u+this.blocksize;p<d;p++){for(var v=a,m=a+this.blocksize;v<m;v++){o=p*4*s+v*4;r[o]=f;r[o+1]=l;r[o+2]=c;r[o+3]=h}}}}t.putImageData(n,0,0)},toJSON:function(){return{type:this.type,blocksize:this.blocksize}}});fabric.Image.filters.Pixelate.fromObject=function(e){return new fabric.Image.filters.Pixelate(e)};(function(e){"use strict";var t=e.fabric||(e.fabric={}),n=t.util.object.extend,r=t.util.object.clone,i=t.util.toFixed;if(t.Text){t.warn("fabric.Text is already defined");return}var s={fontSize:true,fontWeight:true,fontFamily:true,textDecoration:true,fontStyle:true,lineHeight:true,stroke:true,strokeWidth:true,text:true};var o=t.Object.prototype.stateProperties.concat();o.push("fontFamily","fontWeight","fontSize","path","text","textDecoration","textShadow","textAlign","fontStyle","lineHeight","stroke","strokeWidth","backgroundColor","textBackgroundColor","useNative");t.Text=t.util.createClass(t.Object,{fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",textDecoration:"",textShadow:"",textAlign:"left",fontStyle:"",lineHeight:1.3,stroke:"",strokeWidth:1,backgroundColor:"",textBackgroundColor:"",path:null,type:"text",useNative:true,stateProperties:o,initialize:function(e,t){t=t||{};this.text=e;this.setOptions(t);this._initDimensions();this.setCoords()},_initDimensions:function(){var e=t.util.createCanvasElement();this._render(e.getContext("2d"))},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_render:function(e){if(typeof Cufon==="undefined"||this.useNative===true){this._renderViaNative(e)}else{this._renderViaCufon(e)}},_renderViaCufon:function(e){var t=Cufon.textOptions||(Cufon.textOptions={});t.left=this.left;t.top=this.top;t.context=e;t.color=this.fill;var n=this._initDummyElementForCufon();this.transform(e);Cufon.replaceElement(n,{engine:"canvas",separate:"none",fontFamily:this.fontFamily,fontWeight:this.fontWeight,textDecoration:this.textDecoration,textShadow:this.textShadow,textAlign:this.textAlign,fontStyle:this.fontStyle,lineHeight:this.lineHeight,stroke:this.stroke,strokeWidth:this.strokeWidth,backgroundColor:this.backgroundColor,textBackgroundColor:this.textBackgroundColor});this.width=t.width;this.height=t.height;this._totalLineHeight=t.totalLineHeight;this._fontAscent=t.fontAscent;this._boundaries=t.boundaries;this._shadowOffsets=t.shadowOffsets;this._shadows=t.shadows||[];n=null;this.setCoords()},_renderViaNative:function(e){this.transform(e);this._setTextStyles(e);var n=this.text.split(/\r?\n/);this.width=this._getTextWidth(e,n);this.height=this._getTextHeight(e,n);this._renderTextBackground(e,n);if(this.textAlign!=="left"&&this.textAlign!=="justify"){e.save();e.translate(this.textAlign==="center"?this.width/2:this.width,0)}this._setTextShadow(e);this.clipTo&&t.util.clipContext(this,e);this._renderTextFill(e,n);this._renderTextStroke(e,n);this.clipTo&&e.restore();this.textShadow&&e.restore();if(this.textAlign!=="left"&&this.textAlign!=="justify"){e.restore()}this._renderTextDecoration(e,n);this._setBoundaries(e,n);this._totalLineHeight=0;this.setCoords()},_setBoundaries:function(e,t){this._boundaries=[];for(var n=0,r=t.length;n<r;n++){var i=this._getLineWidth(e,t[n]);var s=this._getLineLeftOffset(i);this._boundaries.push({height:this.fontSize*this.lineHeight,width:i,left:s})}},_setTextStyles:function(e){e.fillStyle=this.fill.toLive?this.fill.toLive(e):this.fill;e.strokeStyle=this.stroke;e.lineWidth=this.strokeWidth;e.textBaseline="alphabetic";e.textAlign=this.textAlign;e.font=this._getFontDeclaration()},_getTextHeight:function(e,t){return this.fontSize*t.length*this.lineHeight},_getTextWidth:function(e,t){var n=e.measureText(t[0]).width;for(var r=1,i=t.length;r<i;r++){var s=e.measureText(t[r]).width;if(s>n){n=s}}return n},_setTextShadow:function(e){if(this.textShadow){var t=/\s+(-?\d+)(?:px)?\s+(-?\d+)(?:px)?\s+(\d+)(?:px)?\s*/;var n=this.textShadow;var r=t.exec(this.textShadow);var i=n.replace(t,"");e.save();e.shadowColor=i;e.shadowOffsetX=parseInt(r[1],10);e.shadowOffsetY=parseInt(r[2],10);e.shadowBlur=parseInt(r[3],10);this._shadows=[{blur:e.shadowBlur,color:e.shadowColor,offX:e.shadowOffsetX,offY:e.shadowOffsetY}];this._shadowOffsets=[[parseInt(e.shadowOffsetX,10),parseInt(e.shadowOffsetY,10)]]}},_drawTextLine:function(e,t,n,r,i){if(this.textAlign!=="justify"){t[e](n,r,i);return}var s=t.measureText(n).width;var o=this.width;if(o>s){var u=n.split(/\s+/);var a=t.measureText(n.replace(/\s+/g,"")).width;var f=o-a;var l=u.length-1;var c=f/l;var h=0;for(var p=0,d=u.length;p<d;p++){t[e](u[p],r+h,i);h+=t.measureText(u[p]).width+c}}else{t[e](n,r,i)}},_renderTextFill:function(e,t){this._boundaries=[];for(var n=0,r=t.length;n<r;n++){this._drawTextLine("fillText",e,t[n],-this.width/2,-this.height/2+n*this.fontSize*this.lineHeight+this.fontSize)}},_renderTextStroke:function(e,t){if(this.stroke){e.beginPath();for(var n=0,r=t.length;n<r;n++){this._drawTextLine("strokeText",e,t[n],-this.width/2,-this.height/2+n*this.fontSize*this.lineHeight+this.fontSize)}e.closePath()}},_renderTextBackground:function(e,t){this._renderTextBoxBackground(e);this._renderTextLinesBackground(e,t)},_renderTextBoxBackground:function(e){if(this.backgroundColor){e.save();e.fillStyle=this.backgroundColor;e.fillRect(-this.width/2,-this.height/2,this.width,this.height);e.restore()}},_renderTextLinesBackground:function(e,t){if(this.textBackgroundColor){e.save();e.fillStyle=this.textBackgroundColor;for(var n=0,r=t.length;n<r;n++){if(t[n]!==""){var i=this._getLineWidth(e,t[n]);var s=this._getLineLeftOffset(i);e.fillRect(-this.width/2+s,-this.height/2+n*this.fontSize*this.lineHeight,i,this.fontSize*this.lineHeight)}}e.restore()}},_getLineLeftOffset:function(e){if(this.textAlign==="center"){return(this.width-e)/2}if(this.textAlign==="right"){return this.width-e}return 0},_getLineWidth:function(e,t){return this.textAlign==="justify"?this.width:e.measureText(t).width},_renderTextDecoration:function(e,t){function i(i){for(var s=0,o=t.length;s<o;s++){var u=r._getLineWidth(e,t[s]);var a=r._getLineLeftOffset(u);e.fillRect(-r.width/2+a,i+s*r.fontSize*r.lineHeight-n,u,1)}}var n=this._getTextHeight(e,t)/2;var r=this;if(this.textDecoration.indexOf("underline")>-1){i(this.fontSize)}if(this.textDecoration.indexOf("line-through")>-1){i(this.fontSize/2)}if(this.textDecoration.indexOf("overline")>-1){i(0)}},_getFontDeclaration:function(){return[t.isLikelyNode?this.fontWeight:this.fontStyle,t.isLikelyNode?this.fontStyle:this.fontWeight,this.fontSize+"px",t.isLikelyNode?'"'+this.fontFamily+'"':this.fontFamily].join(" ")},_initDummyElementForCufon:function(){var e=t.document.createElement("pre"),n=t.document.createElement("div");n.appendChild(e);if(typeof G_vmlCanvasManager==="undefined"){e.innerHTML=this.text}else{e.innerText=this.text.replace(/\r?\n/gi,"\r")}e.style.fontSize=this.fontSize+"px";e.style.letterSpacing="normal";return e},render:function(e,t){if(!this.visible)return;e.save();this._render(e);if(!t&&this.active){this.drawBorders(e);this.drawControls(e)}e.restore()},toObject:function(e){return n(this.callSuper("toObject",e),{text:this.text,fontSize:this.fontSize,fontWeight:this.fontWeight,fontFamily:this.fontFamily,fontStyle:this.fontStyle,lineHeight:this.lineHeight,textDecoration:this.textDecoration,textShadow:this.textShadow,textAlign:this.textAlign,path:this.path,stroke:this.stroke,strokeWidth:this.strokeWidth,backgroundColor:this.backgroundColor,textBackgroundColor:this.textBackgroundColor,useNative:this.useNative})},toSVG:function(){var e=this.text.split(/\r?\n/),t=this.useNative?this.fontSize*this.lineHeight:-this._fontAscent-this._fontAscent/5*this.lineHeight,n=-(this.width/2),r=this.useNative?this.fontSize-1:this.height/2-e.length*this.fontSize-this._totalLineHeight,s=this._getSVGTextAndBg(t,n,e),o=this._getSVGShadows(t,e);r+=this._fontAscent?this._fontAscent/5*this.lineHeight:0;return['<g transform="',this.getSvgTransform(),'">',s.textBgRects.join(""),"<text ",this.fontFamily?"font-family=\"'"+this.fontFamily+"'\" ":"",this.fontSize?'font-size="'+this.fontSize+'" ':"",this.fontStyle?'font-style="'+this.fontStyle+'" ':"",this.fontWeight?'font-weight="'+this.fontWeight+'" ':"",this.textDecoration?'text-decoration="'+this.textDecoration+'" ':"",'style="',this.getSvgStyles(),'" ','transform="translate(',i(n,2)," ",i(r,2),')">',o.join(""),s.textSpans.join(""),"</text>","</g>"].join("")},_getSVGShadows:function(e,n){var r=[],s,o,u,a,f=1;if(!this._shadows||!this._boundaries){return r}for(s=0,u=this._shadows.length;s<u;s++){for(o=0,a=n.length;o<a;o++){if(n[o]!==""){var l=this._boundaries&&this._boundaries[o]?this._boundaries[o].left:0;r.push('<tspan x="',i(l+f+this._shadowOffsets[s][0],2),o===0||this.useNative?'" y':'" dy','="',i(this.useNative?e*o-this.height/2+this._shadowOffsets[s][1]:e+(o===0?this._shadowOffsets[s][1]:0),2),'" ',this._getFillAttributes(this._shadows[s].color),">",t.util.string.escapeXml(n[o]),"</tspan>");f=1}else{f++}}}return r},_getSVGTextAndBg:function(e,n,r){var s=[],o=[],u,a,f,l=1;if(this.backgroundColor&&this._boundaries){o.push("<rect ",this._getFillAttributes(this.backgroundColor),' x="',i(-this.width/2,2),'" y="',i(-this.height/2,2),'" width="',i(this.width,2),'" height="',i(this.height,2),'"></rect>')}for(u=0,f=r.length;u<f;u++){if(r[u]!==""){a=this._boundaries&&this._boundaries[u]?i(this._boundaries[u].left,2):0;s.push('<tspan x="',a,'" ',u===0||this.useNative?"y":"dy",'="',i(this.useNative?e*u-this.height/2:e*l,2),'" ',this._getFillAttributes(this.fill),">",t.util.string.escapeXml(r[u]),"</tspan>");l=1}else{l++}if(!this.textBackgroundColor||!this._boundaries)continue;o.push("<rect ",this._getFillAttributes(this.textBackgroundColor),' x="',i(n+this._boundaries[u].left,2),'" y="',i(e*u-this.height/2,2),'" width="',i(this._boundaries[u].width,2),'" height="',i(this._boundaries[u].height,2),'"></rect>')}return{textSpans:s,textBgRects:o}},_getFillAttributes:function(e){var n=e&&typeof e==="string"?new t.Color(e):"";if(!n||!n.getSource()||n.getAlpha()===1){return'fill="'+e+'"'}return'opacity="'+n.getAlpha()+'" fill="'+n.setAlpha(1).toRgb()+'"'},setColor:function(e){this.set("fill",e);return this},getText:function(){return this.text},_set:function(e,t){if(e==="fontFamily"&&this.path){this.path=this.path.replace(/(.*?)([^\/]*)(\.font\.js)/,"$1"+t+"$3")}this.callSuper("_set",e,t);if(e in s){this._initDimensions();this.setCoords()}}});t.Text.ATTRIBUTE_NAMES=("x y fill fill-opacity opacity stroke stroke-width transform "+"font-family font-style font-weight font-size text-decoration").split(" ");t.Text.fromObject=function(e){return new t.Text(e.text,r(e))};t.Text.fromElement=function(e,n){if(!e){return null}var r=t.parseAttributes(e,t.Text.ATTRIBUTE_NAMES);n=t.util.object.extend(n?t.util.object.clone(n):{},r);var i=new t.Text(e.textContent,n);i.set({left:i.getLeft()+i.getWidth()/2,top:i.getTop()-i.getHeight()/2});return i};t.util.createAccessors(t.Text)})(typeof exports!=="undefined"?exports:this);(function(){function request(e,t,n){var r=URL.parse(e);if(!r.port){r.port=r.protocol.indexOf("https:")===0?443:80}var i=r.port===443?HTTPS:HTTP;var s=i.request({hostname:r.hostname,port:r.port,path:r.pathname,method:"GET"},function(e){var r="";if(t){e.setEncoding(t)}e.on("end",function(){n(r)});e.on("data",function(t){if(e.statusCode===200){r+=t}})});s.on("error",function(e){if(e.errno===process.ECONNREFUSED){fabric.log("ECONNREFUSED: connection refused to "+r.hostname+":"+r.port)}else{fabric.log(e.message)}});s.end()}function request_fs(e,t){var n=require("fs"),r=n.createReadStream(e),i="";r.on("data",function(e){i+=e});r.on("end",function(){t(i)})}if(typeof document!=="undefined"&&typeof window!=="undefined"){return}var DOMParser=(new require("xmldom")).DOMParser,URL=require("url"),HTTP=require("http"),HTTPS=require("https"),Canvas=require("canvas"),Image=require("canvas").Image;fabric.util.loadImage=function(e,t,n){var r=function(r){i.src=new Buffer(r,"binary");i._src=e;t&&t.call(n,i)};var i=new Image;if(e&&e.indexOf("data")===0){i.src=i._src=e;t&&t.call(n,i)}else if(e&&e.indexOf("http")!==0){request_fs(e,r)}else if(e){request(e,"binary",r)}};fabric.loadSVGFromURL=function(e,t){e=e.replace(/^\n\s*/,"").replace(/\?.*$/,"").trim();if(e.indexOf("http")!==0){request_fs(e,function(e){fabric.loadSVGFromString(e,t)})}else{request(e,"",function(e){fabric.loadSVGFromString(e,t)})}};fabric.loadSVGFromString=function(e,t){var n=(new DOMParser).parseFromString(e);fabric.parseSVGDocument(n.documentElement,function(e,n){t(e,n)})};fabric.util.getScript=function(url,callback){request(url,"",function(body){eval(body);callback&&callback()})};fabric.Image.fromObject=function(e,t){fabric.util.loadImage(e.src,function(n){var r=new fabric.Image(n);r._initConfig(e);r._initFilters(e);t(r)})};fabric.createCanvasForNode=function(e,t){var n=fabric.document.createElement("canvas"),r=new Canvas(e||600,t||600);n.style={};n.width=r.width;n.height=r.height;var i=fabric.Canvas||fabric.StaticCanvas;var s=new i(n);s.contextContainer=r.getContext("2d");s.nodeCanvas=r;s.Font=Canvas.Font;return s};fabric.StaticCanvas.prototype.createPNGStream=function(){return this.nodeCanvas.createPNGStream()};fabric.StaticCanvas.prototype.createJPEGStream=function(e){return this.nodeCanvas.createJPEGStream(e)};var origSetWidth=fabric.StaticCanvas.prototype.setWidth;fabric.StaticCanvas.prototype.setWidth=function(e){origSetWidth.call(this,e);this.nodeCanvas.width=e;return this};if(fabric.Canvas){fabric.Canvas.prototype.setWidth=fabric.StaticCanvas.prototype.setWidth}var origSetHeight=fabric.StaticCanvas.prototype.setHeight;fabric.StaticCanvas.prototype.setHeight=function(e){origSetHeight.call(this,e);this.nodeCanvas.height=e;return this};if(fabric.Canvas){fabric.Canvas.prototype.setHeight=fabric.StaticCanvas.prototype.setHeight}})()